/*!
TIFY v0.28.1
(c) 2017-2023 GÃ¶ttingen State and University Library (https://www.sub.uni-goettingen.de/)
AGPL-3.0
https://tify.rocks/
*/
(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();function _n(t,r){const e=Object.create(null),i=t.split(",");for(let n=0;n<i.length;n++)e[i[n]]=!0;return r?n=>!!e[n.toLowerCase()]:n=>!!e[n]}function xn(t){if(de(t)){const r={};for(let e=0;e<t.length;e++){const i=t[e],n=De(i)?Nr(i):xn(i);if(n)for(const s in n)r[s]=n[s]}return r}else{if(De(t))return t;if(Se(t))return t}}const Br=/;(?![^(]*\))/g,Ir=/:([^]+)/,zr=/\/\*.*?\*\//gs;function Nr(t){const r={};return t.replace(zr,"").split(Br).forEach(e=>{if(e){const i=e.split(Ir);i.length>1&&(r[i[0].trim()]=i[1].trim())}}),r}function Ee(t){let r="";if(De(t))r=t;else if(de(t))for(let e=0;e<t.length;e++){const i=Ee(t[e]);i&&(r+=i+" ")}else if(Se(t))for(const e in t)t[e]&&(r+=e+" ");return r.trim()}const Vr="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Ur=_n(Vr);function Hs(t){return!!t||t===""}const X=t=>De(t)?t:t==null?"":de(t)||Se(t)&&(t.toString===Os||!ve(t.toString))?JSON.stringify(t,Ls,2):String(t),Ls=(t,r)=>r&&r.__v_isRef?Ls(t,r.value):Gt(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((e,[i,n])=>(e[`${i} =>`]=n,e),{})}:Ds(r)?{[`Set(${r.size})`]:[...r.values()]}:Se(r)&&!de(r)&&!ks(r)?String(r):r,be={},jt=[],et=()=>{},Wr=()=>!1,jr=/^on[^a-z]/,Di=t=>jr.test(t),Tn=t=>t.startsWith("onUpdate:"),Ve=Object.assign,bn=(t,r)=>{const e=t.indexOf(r);e>-1&&t.splice(e,1)},Gr=Object.prototype.hasOwnProperty,we=(t,r)=>Gr.call(t,r),de=Array.isArray,Gt=t=>Mi(t)==="[object Map]",Ds=t=>Mi(t)==="[object Set]",ve=t=>typeof t=="function",De=t=>typeof t=="string",En=t=>typeof t=="symbol",Se=t=>t!==null&&typeof t=="object",Ms=t=>Se(t)&&ve(t.then)&&ve(t.catch),Os=Object.prototype.toString,Mi=t=>Os.call(t),qr=t=>Mi(t).slice(8,-1),ks=t=>Mi(t)==="[object Object]",Pn=t=>De(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,wi=_n(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Oi=t=>{const r=Object.create(null);return e=>r[e]||(r[e]=t(e))},Zr=/-(\w)/g,lt=Oi(t=>t.replace(Zr,(r,e)=>e?e.toUpperCase():"")),Kr=/\B([A-Z])/g,It=Oi(t=>t.replace(Kr,"-$1").toLowerCase()),ki=Oi(t=>t.charAt(0).toUpperCase()+t.slice(1)),Wi=Oi(t=>t?`on${ki(t)}`:""),ri=(t,r)=>!Object.is(t,r),_i=(t,r)=>{for(let e=0;e<t.length;e++)t[e](r)},Pi=(t,r,e)=>{Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value:e})},Yi=t=>{const r=parseFloat(t);return isNaN(r)?t:r};let Zn;const Xr=()=>Zn||(Zn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Je;class Yr{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Je,!r&&Je&&(this.index=(Je.scopes||(Je.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const e=Je;try{return Je=this,r()}finally{Je=e}}}on(){Je=this}off(){Je=this.parent}stop(r){if(this._active){let e,i;for(e=0,i=this.effects.length;e<i;e++)this.effects[e].stop();for(e=0,i=this.cleanups.length;e<i;e++)this.cleanups[e]();if(this.scopes)for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!r){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0,this._active=!1}}}function Jr(t,r=Je){r&&r.active&&r.effects.push(t)}function Qr(){return Je}const Sn=t=>{const r=new Set(t);return r.w=0,r.n=0,r},Fs=t=>(t.w&Et)>0,As=t=>(t.n&Et)>0,$r=({deps:t})=>{if(t.length)for(let r=0;r<t.length;r++)t[r].w|=Et},eo=t=>{const{deps:r}=t;if(r.length){let e=0;for(let i=0;i<r.length;i++){const n=r[i];Fs(n)&&!As(n)?n.delete(t):r[e++]=n,n.w&=~Et,n.n&=~Et}r.length=e}},Ji=new WeakMap;let ti=0,Et=1;const Qi=30;let Qe;const kt=Symbol(""),$i=Symbol("");class Cn{constructor(r,e=null,i){this.fn=r,this.scheduler=e,this.active=!0,this.deps=[],this.parent=void 0,Jr(this,i)}run(){if(!this.active)return this.fn();let r=Qe,e=Tt;for(;r;){if(r===this)return;r=r.parent}try{return this.parent=Qe,Qe=this,Tt=!0,Et=1<<++ti,ti<=Qi?$r(this):Kn(this),this.fn()}finally{ti<=Qi&&eo(this),Et=1<<--ti,Qe=this.parent,Tt=e,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Qe===this?this.deferStop=!0:this.active&&(Kn(this),this.onStop&&this.onStop(),this.active=!1)}}function Kn(t){const{deps:r}=t;if(r.length){for(let e=0;e<r.length;e++)r[e].delete(t);r.length=0}}let Tt=!0;const Bs=[];function Jt(){Bs.push(Tt),Tt=!1}function Qt(){const t=Bs.pop();Tt=t===void 0?!0:t}function qe(t,r,e){if(Tt&&Qe){let i=Ji.get(t);i||Ji.set(t,i=new Map);let n=i.get(e);n||i.set(e,n=Sn()),Is(n)}}function Is(t,r){let e=!1;ti<=Qi?As(t)||(t.n|=Et,e=!Fs(t)):e=!t.has(Qe),e&&(t.add(Qe),Qe.deps.push(t))}function pt(t,r,e,i,n,s){const l=Ji.get(t);if(!l)return;let o=[];if(r==="clear")o=[...l.values()];else if(e==="length"&&de(t)){const a=Number(i);l.forEach((c,h)=>{(h==="length"||h>=a)&&o.push(c)})}else switch(e!==void 0&&o.push(l.get(e)),r){case"add":de(t)?Pn(e)&&o.push(l.get("length")):(o.push(l.get(kt)),Gt(t)&&o.push(l.get($i)));break;case"delete":de(t)||(o.push(l.get(kt)),Gt(t)&&o.push(l.get($i)));break;case"set":Gt(t)&&o.push(l.get(kt));break}if(o.length===1)o[0]&&en(o[0]);else{const a=[];for(const c of o)c&&a.push(...c);en(Sn(a))}}function en(t,r){const e=de(t)?t:[...t];for(const i of e)i.computed&&Xn(i);for(const i of e)i.computed||Xn(i)}function Xn(t,r){(t!==Qe||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const to=_n("__proto__,__v_isRef,__isVue"),zs=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(En)),io=Rn(),no=Rn(!1,!0),so=Rn(!0),Yn=ro();function ro(){const t={};return["includes","indexOf","lastIndexOf"].forEach(r=>{t[r]=function(...e){const i=xe(this);for(let s=0,l=this.length;s<l;s++)qe(i,"get",s+"");const n=i[r](...e);return n===-1||n===!1?i[r](...e.map(xe)):n}}),["push","pop","shift","unshift","splice"].forEach(r=>{t[r]=function(...e){Jt();const i=xe(this)[r].apply(this,e);return Qt(),i}}),t}function oo(t){const r=xe(this);return qe(r,"has",t),r.hasOwnProperty(t)}function Rn(t=!1,r=!1){return function(i,n,s){if(n==="__v_isReactive")return!t;if(n==="__v_isReadonly")return t;if(n==="__v_isShallow")return r;if(n==="__v_raw"&&s===(t?r?bo:js:r?Ws:Us).get(i))return i;const l=de(i);if(!t){if(l&&we(Yn,n))return Reflect.get(Yn,n,s);if(n==="hasOwnProperty")return oo}const o=Reflect.get(i,n,s);return(En(n)?zs.has(n):to(n))||(t||qe(i,"get",n),r)?o:Ie(o)?l&&Pn(n)?o:o.value:Se(o)?t?Gs(o):Ai(o):o}}const ao=Ns(),lo=Ns(!0);function Ns(t=!1){return function(e,i,n,s){let l=e[i];if(Kt(l)&&Ie(l)&&!Ie(n))return!1;if(!t&&(!Si(n)&&!Kt(n)&&(l=xe(l),n=xe(n)),!de(e)&&Ie(l)&&!Ie(n)))return l.value=n,!0;const o=de(e)&&Pn(i)?Number(i)<e.length:we(e,i),a=Reflect.set(e,i,n,s);return e===xe(s)&&(o?ri(n,l)&&pt(e,"set",i,n):pt(e,"add",i,n)),a}}function co(t,r){const e=we(t,r);t[r];const i=Reflect.deleteProperty(t,r);return i&&e&&pt(t,"delete",r,void 0),i}function uo(t,r){const e=Reflect.has(t,r);return(!En(r)||!zs.has(r))&&qe(t,"has",r),e}function ho(t){return qe(t,"iterate",de(t)?"length":kt),Reflect.ownKeys(t)}const Vs={get:io,set:ao,deleteProperty:co,has:uo,ownKeys:ho},fo={get:so,set(t,r){return!0},deleteProperty(t,r){return!0}},po=Ve({},Vs,{get:no,set:lo}),Hn=t=>t,Fi=t=>Reflect.getPrototypeOf(t);function fi(t,r,e=!1,i=!1){t=t.__v_raw;const n=xe(t),s=xe(r);e||(r!==s&&qe(n,"get",r),qe(n,"get",s));const{has:l}=Fi(n),o=i?Hn:e?Mn:oi;if(l.call(n,r))return o(t.get(r));if(l.call(n,s))return o(t.get(s));t!==n&&t.get(r)}function pi(t,r=!1){const e=this.__v_raw,i=xe(e),n=xe(t);return r||(t!==n&&qe(i,"has",t),qe(i,"has",n)),t===n?e.has(t):e.has(t)||e.has(n)}function gi(t,r=!1){return t=t.__v_raw,!r&&qe(xe(t),"iterate",kt),Reflect.get(t,"size",t)}function Jn(t){t=xe(t);const r=xe(this);return Fi(r).has.call(r,t)||(r.add(t),pt(r,"add",t,t)),this}function Qn(t,r){r=xe(r);const e=xe(this),{has:i,get:n}=Fi(e);let s=i.call(e,t);s||(t=xe(t),s=i.call(e,t));const l=n.call(e,t);return e.set(t,r),s?ri(r,l)&&pt(e,"set",t,r):pt(e,"add",t,r),this}function $n(t){const r=xe(this),{has:e,get:i}=Fi(r);let n=e.call(r,t);n||(t=xe(t),n=e.call(r,t)),i&&i.call(r,t);const s=r.delete(t);return n&&pt(r,"delete",t,void 0),s}function es(){const t=xe(this),r=t.size!==0,e=t.clear();return r&&pt(t,"clear",void 0,void 0),e}function mi(t,r){return function(i,n){const s=this,l=s.__v_raw,o=xe(l),a=r?Hn:t?Mn:oi;return!t&&qe(o,"iterate",kt),l.forEach((c,h)=>i.call(n,a(c),a(h),s))}}function vi(t,r,e){return function(...i){const n=this.__v_raw,s=xe(n),l=Gt(s),o=t==="entries"||t===Symbol.iterator&&l,a=t==="keys"&&l,c=n[t](...i),h=e?Hn:r?Mn:oi;return!r&&qe(s,"iterate",a?$i:kt),{next(){const{value:g,done:m}=c.next();return m?{value:g,done:m}:{value:o?[h(g[0]),h(g[1])]:h(g),done:m}},[Symbol.iterator](){return this}}}}function wt(t){return function(...r){return t==="delete"?!1:this}}function go(){const t={get(s){return fi(this,s)},get size(){return gi(this)},has:pi,add:Jn,set:Qn,delete:$n,clear:es,forEach:mi(!1,!1)},r={get(s){return fi(this,s,!1,!0)},get size(){return gi(this)},has:pi,add:Jn,set:Qn,delete:$n,clear:es,forEach:mi(!1,!0)},e={get(s){return fi(this,s,!0)},get size(){return gi(this,!0)},has(s){return pi.call(this,s,!0)},add:wt("add"),set:wt("set"),delete:wt("delete"),clear:wt("clear"),forEach:mi(!0,!1)},i={get(s){return fi(this,s,!0,!0)},get size(){return gi(this,!0)},has(s){return pi.call(this,s,!0)},add:wt("add"),set:wt("set"),delete:wt("delete"),clear:wt("clear"),forEach:mi(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=vi(s,!1,!1),e[s]=vi(s,!0,!1),r[s]=vi(s,!1,!0),i[s]=vi(s,!0,!0)}),[t,e,r,i]}const[mo,vo,yo,wo]=go();function Ln(t,r){const e=r?t?wo:yo:t?vo:mo;return(i,n,s)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?i:Reflect.get(we(e,n)&&n in i?e:i,n,s)}const _o={get:Ln(!1,!1)},xo={get:Ln(!1,!0)},To={get:Ln(!0,!1)},Us=new WeakMap,Ws=new WeakMap,js=new WeakMap,bo=new WeakMap;function Eo(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Po(t){return t.__v_skip||!Object.isExtensible(t)?0:Eo(qr(t))}function Ai(t){return Kt(t)?t:Dn(t,!1,Vs,_o,Us)}function So(t){return Dn(t,!1,po,xo,Ws)}function Gs(t){return Dn(t,!0,fo,To,js)}function Dn(t,r,e,i,n){if(!Se(t)||t.__v_raw&&!(r&&t.__v_isReactive))return t;const s=n.get(t);if(s)return s;const l=Po(t);if(l===0)return t;const o=new Proxy(t,l===2?i:e);return n.set(t,o),o}function qt(t){return Kt(t)?qt(t.__v_raw):!!(t&&t.__v_isReactive)}function Kt(t){return!!(t&&t.__v_isReadonly)}function Si(t){return!!(t&&t.__v_isShallow)}function qs(t){return qt(t)||Kt(t)}function xe(t){const r=t&&t.__v_raw;return r?xe(r):t}function Zs(t){return Pi(t,"__v_skip",!0),t}const oi=t=>Se(t)?Ai(t):t,Mn=t=>Se(t)?Gs(t):t;function Ks(t){Tt&&Qe&&(t=xe(t),Is(t.dep||(t.dep=Sn())))}function Xs(t,r){t=xe(t);const e=t.dep;e&&en(e)}function Ie(t){return!!(t&&t.__v_isRef===!0)}function Ys(t){return Co(t,!1)}function Co(t,r){return Ie(t)?t:new Ro(t,r)}class Ro{constructor(r,e){this.__v_isShallow=e,this.dep=void 0,this.__v_isRef=!0,this._rawValue=e?r:xe(r),this._value=e?r:oi(r)}get value(){return Ks(this),this._value}set value(r){const e=this.__v_isShallow||Si(r)||Kt(r);r=e?r:xe(r),ri(r,this._rawValue)&&(this._rawValue=r,this._value=e?r:oi(r),Xs(this))}}function Ho(t){return Ie(t)?t.value:t}const Lo={get:(t,r,e)=>Ho(Reflect.get(t,r,e)),set:(t,r,e,i)=>{const n=t[r];return Ie(n)&&!Ie(e)?(n.value=e,!0):Reflect.set(t,r,e,i)}};function Js(t){return qt(t)?t:new Proxy(t,Lo)}var Qs;class Do{constructor(r,e,i,n){this._setter=e,this.dep=void 0,this.__v_isRef=!0,this[Qs]=!1,this._dirty=!0,this.effect=new Cn(r,()=>{this._dirty||(this._dirty=!0,Xs(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!n,this.__v_isReadonly=i}get value(){const r=xe(this);return Ks(r),(r._dirty||!r._cacheable)&&(r._dirty=!1,r._value=r.effect.run()),r._value}set value(r){this._setter(r)}}Qs="__v_isReadonly";function Mo(t,r,e=!1){let i,n;const s=ve(t);return s?(i=t,n=et):(i=t.get,n=t.set),new Do(i,n,s||!n,e)}function bt(t,r,e,i){let n;try{n=i?t(...i):t()}catch(s){Bi(s,r,e)}return n}function tt(t,r,e,i){if(ve(t)){const s=bt(t,r,e,i);return s&&Ms(s)&&s.catch(l=>{Bi(l,r,e)}),s}const n=[];for(let s=0;s<t.length;s++)n.push(tt(t[s],r,e,i));return n}function Bi(t,r,e,i=!0){const n=r?r.vnode:null;if(r){let s=r.parent;const l=r.proxy,o=e;for(;s;){const c=s.ec;if(c){for(let h=0;h<c.length;h++)if(c[h](t,l,o)===!1)return}s=s.parent}const a=r.appContext.config.errorHandler;if(a){bt(a,null,10,[t,l,o]);return}}Oo(t,e,n,i)}function Oo(t,r,e,i=!0){console.error(t)}let ai=!1,tn=!1;const Ae=[];let at=0;const Zt=[];let ft=null,Lt=0;const $s=Promise.resolve();let On=null;function er(t){const r=On||$s;return t?r.then(this?t.bind(this):t):r}function ko(t){let r=at+1,e=Ae.length;for(;r<e;){const i=r+e>>>1;li(Ae[i])<t?r=i+1:e=i}return r}function kn(t){(!Ae.length||!Ae.includes(t,ai&&t.allowRecurse?at+1:at))&&(t.id==null?Ae.push(t):Ae.splice(ko(t.id),0,t),tr())}function tr(){!ai&&!tn&&(tn=!0,On=$s.then(nr))}function Fo(t){const r=Ae.indexOf(t);r>at&&Ae.splice(r,1)}function Ao(t){de(t)?Zt.push(...t):(!ft||!ft.includes(t,t.allowRecurse?Lt+1:Lt))&&Zt.push(t),tr()}function ts(t,r=ai?at+1:0){for(;r<Ae.length;r++){const e=Ae[r];e&&e.pre&&(Ae.splice(r,1),r--,e())}}function ir(t){if(Zt.length){const r=[...new Set(Zt)];if(Zt.length=0,ft){ft.push(...r);return}for(ft=r,ft.sort((e,i)=>li(e)-li(i)),Lt=0;Lt<ft.length;Lt++)ft[Lt]();ft=null,Lt=0}}const li=t=>t.id==null?1/0:t.id,Bo=(t,r)=>{const e=li(t)-li(r);if(e===0){if(t.pre&&!r.pre)return-1;if(r.pre&&!t.pre)return 1}return e};function nr(t){tn=!1,ai=!0,Ae.sort(Bo);const r=et;try{for(at=0;at<Ae.length;at++){const e=Ae[at];e&&e.active!==!1&&bt(e,null,14)}}finally{at=0,Ae.length=0,ir(),ai=!1,On=null,(Ae.length||Zt.length)&&nr()}}function Io(t,r,...e){if(t.isUnmounted)return;const i=t.vnode.props||be;let n=e;const s=r.startsWith("update:"),l=s&&r.slice(7);if(l&&l in i){const h=`${l==="modelValue"?"model":l}Modifiers`,{number:g,trim:m}=i[h]||be;m&&(n=e.map(b=>De(b)?b.trim():b)),g&&(n=e.map(Yi))}let o,a=i[o=Wi(r)]||i[o=Wi(lt(r))];!a&&s&&(a=i[o=Wi(It(r))]),a&&tt(a,t,6,n);const c=i[o+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[o])return;t.emitted[o]=!0,tt(c,t,6,n)}}function sr(t,r,e=!1){const i=r.emitsCache,n=i.get(t);if(n!==void 0)return n;const s=t.emits;let l={},o=!1;if(!ve(t)){const a=c=>{const h=sr(c,r,!0);h&&(o=!0,Ve(l,h))};!e&&r.mixins.length&&r.mixins.forEach(a),t.extends&&a(t.extends),t.mixins&&t.mixins.forEach(a)}return!s&&!o?(Se(t)&&i.set(t,null),null):(de(s)?s.forEach(a=>l[a]=null):Ve(l,s),Se(t)&&i.set(t,l),l)}function Ii(t,r){return!t||!Di(r)?!1:(r=r.slice(2).replace(/Once$/,""),we(t,r[0].toLowerCase()+r.slice(1))||we(t,It(r))||we(t,r))}let Ye=null,rr=null;function Ci(t){const r=Ye;return Ye=t,rr=t&&t.type.__scopeId||null,r}function zo(t,r=Ye,e){if(!r||t._n)return t;const i=(...n)=>{i._d&&us(-1);const s=Ci(r);let l;try{l=t(...n)}finally{Ci(s),i._d&&us(1)}return l};return i._n=!0,i._c=!0,i._d=!0,i}function ji(t){const{type:r,vnode:e,proxy:i,withProxy:n,props:s,propsOptions:[l],slots:o,attrs:a,emit:c,render:h,renderCache:g,data:m,setupState:b,ctx:x,inheritAttrs:P}=t;let S,O;const d=Ci(t);try{if(e.shapeFlag&4){const H=n||i;S=ot(h.call(H,H,g,s,b,m,x)),O=a}else{const H=r;S=ot(H.length>1?H(s,{attrs:a,slots:o,emit:c}):H(s,null)),O=r.props?a:No(a)}}catch(H){si.length=0,Bi(H,t,1),S=ie(Bt)}let w=S;if(O&&P!==!1){const H=Object.keys(O),{shapeFlag:M}=w;H.length&&M&7&&(l&&H.some(Tn)&&(O=Vo(O,l)),w=Xt(w,O))}return e.dirs&&(w=Xt(w),w.dirs=w.dirs?w.dirs.concat(e.dirs):e.dirs),e.transition&&(w.transition=e.transition),S=w,Ci(d),S}const No=t=>{let r;for(const e in t)(e==="class"||e==="style"||Di(e))&&((r||(r={}))[e]=t[e]);return r},Vo=(t,r)=>{const e={};for(const i in t)(!Tn(i)||!(i.slice(9)in r))&&(e[i]=t[i]);return e};function Uo(t,r,e){const{props:i,children:n,component:s}=t,{props:l,children:o,patchFlag:a}=r,c=s.emitsOptions;if(r.dirs||r.transition)return!0;if(e&&a>=0){if(a&1024)return!0;if(a&16)return i?is(i,l,c):!!l;if(a&8){const h=r.dynamicProps;for(let g=0;g<h.length;g++){const m=h[g];if(l[m]!==i[m]&&!Ii(c,m))return!0}}}else return(n||o)&&(!o||!o.$stable)?!0:i===l?!1:i?l?is(i,l,c):!0:!!l;return!1}function is(t,r,e){const i=Object.keys(r);if(i.length!==Object.keys(t).length)return!0;for(let n=0;n<i.length;n++){const s=i[n];if(r[s]!==t[s]&&!Ii(e,s))return!0}return!1}function Wo({vnode:t,parent:r},e){for(;r&&r.subTree===t;)(t=r.vnode).el=e,r=r.parent}const jo=t=>t.__isSuspense;function Go(t,r){r&&r.pendingBranch?de(t)?r.effects.push(...t):r.effects.push(t):Ao(t)}function qo(t,r){if(Re){let e=Re.provides;const i=Re.parent&&Re.parent.provides;i===e&&(e=Re.provides=Object.create(i)),e[t]=r}}function xi(t,r,e=!1){const i=Re||Ye;if(i){const n=i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides;if(n&&t in n)return n[t];if(arguments.length>1)return e&&ve(r)?r.call(i.proxy):r}}const yi={};function Gi(t,r,e){return or(t,r,e)}function or(t,r,{immediate:e,deep:i,flush:n,onTrack:s,onTrigger:l}=be){const o=Qr()===(Re==null?void 0:Re.scope)?Re:null;let a,c=!1,h=!1;if(Ie(t)?(a=()=>t.value,c=Si(t)):qt(t)?(a=()=>t,i=!0):de(t)?(h=!0,c=t.some(w=>qt(w)||Si(w)),a=()=>t.map(w=>{if(Ie(w))return w.value;if(qt(w))return Mt(w);if(ve(w))return bt(w,o,2)})):ve(t)?r?a=()=>bt(t,o,2):a=()=>{if(!(o&&o.isUnmounted))return g&&g(),tt(t,o,3,[m])}:a=et,r&&i){const w=a;a=()=>Mt(w())}let g,m=w=>{g=O.onStop=()=>{bt(w,o,4)}},b;if(ui)if(m=et,r?e&&tt(r,o,3,[a(),h?[]:void 0,m]):a(),n==="sync"){const w=Na();b=w.__watcherHandles||(w.__watcherHandles=[])}else return et;let x=h?new Array(t.length).fill(yi):yi;const P=()=>{if(O.active)if(r){const w=O.run();(i||c||(h?w.some((H,M)=>ri(H,x[M])):ri(w,x)))&&(g&&g(),tt(r,o,3,[w,x===yi?void 0:h&&x[0]===yi?[]:x,m]),x=w)}else O.run()};P.allowRecurse=!!r;let S;n==="sync"?S=P:n==="post"?S=()=>je(P,o&&o.suspense):(P.pre=!0,o&&(P.id=o.uid),S=()=>kn(P));const O=new Cn(a,S);r?e?P():x=O.run():n==="post"?je(O.run.bind(O),o&&o.suspense):O.run();const d=()=>{O.stop(),o&&o.scope&&bn(o.scope.effects,O)};return b&&b.push(d),d}function Zo(t,r,e){const i=this.proxy,n=De(t)?t.includes(".")?ar(i,t):()=>i[t]:t.bind(i,i);let s;ve(r)?s=r:(s=r.handler,e=r);const l=Re;Yt(this);const o=or(n,s.bind(i),e);return l?Yt(l):Ft(),o}function ar(t,r){const e=r.split(".");return()=>{let i=t;for(let n=0;n<e.length&&i;n++)i=i[e[n]];return i}}function Mt(t,r){if(!Se(t)||t.__v_skip||(r=r||new Set,r.has(t)))return t;if(r.add(t),Ie(t))Mt(t.value,r);else if(de(t))for(let e=0;e<t.length;e++)Mt(t[e],r);else if(Ds(t)||Gt(t))t.forEach(e=>{Mt(e,r)});else if(ks(t))for(const e in t)Mt(t[e],r);return t}const Ti=t=>!!t.type.__asyncLoader,lr=t=>t.type.__isKeepAlive;function Ko(t,r){cr(t,"a",r)}function Xo(t,r){cr(t,"da",r)}function cr(t,r,e=Re){const i=t.__wdc||(t.__wdc=()=>{let n=e;for(;n;){if(n.isDeactivated)return;n=n.parent}return t()});if(zi(r,i,e),e){let n=e.parent;for(;n&&n.parent;)lr(n.parent.vnode)&&Yo(i,r,e,n),n=n.parent}}function Yo(t,r,e,i){const n=zi(r,t,i,!0);ur(()=>{bn(i[r],n)},e)}function zi(t,r,e=Re,i=!1){if(e){const n=e[t]||(e[t]=[]),s=r.__weh||(r.__weh=(...l)=>{if(e.isUnmounted)return;Jt(),Yt(e);const o=tt(r,e,t,l);return Ft(),Qt(),o});return i?n.unshift(s):n.push(s),s}}const gt=t=>(r,e=Re)=>(!ui||t==="sp")&&zi(t,(...i)=>r(...i),e),Jo=gt("bm"),Qo=gt("m"),$o=gt("bu"),ea=gt("u"),ta=gt("bum"),ur=gt("um"),ia=gt("sp"),na=gt("rtg"),sa=gt("rtc");function ra(t,r=Re){zi("ec",t,r)}function Ne(t,r){const e=Ye;if(e===null)return t;const i=Ui(e)||e.proxy,n=t.dirs||(t.dirs=[]);for(let s=0;s<r.length;s++){let[l,o,a,c=be]=r[s];l&&(ve(l)&&(l={mounted:l,updated:l}),l.deep&&Mt(o),n.push({dir:l,instance:i,value:o,oldValue:void 0,arg:a,modifiers:c}))}return t}function Ct(t,r,e,i){const n=t.dirs,s=r&&r.dirs;for(let l=0;l<n.length;l++){const o=n[l];s&&(o.oldValue=s[l].value);let a=o.dir[i];a&&(Jt(),tt(a,e,8,[t.el,o,t,r]),Qt())}}const hr="components",oa="directives";function dr(t,r){return fr(hr,t,!0,r)||t}const aa=Symbol();function Fn(t){return fr(oa,t)}function fr(t,r,e=!0,i=!1){const n=Ye||Re;if(n){const s=n.type;if(t===hr){const o=Aa(s,!1);if(o&&(o===r||o===lt(r)||o===ki(lt(r))))return s}const l=ns(n[t]||s[t],r)||ns(n.appContext[t],r);return!l&&i?s:l}}function ns(t,r){return t&&(t[r]||t[lt(r)]||t[ki(lt(r))])}function Le(t,r,e,i){let n;const s=e&&e[i];if(de(t)||De(t)){n=new Array(t.length);for(let l=0,o=t.length;l<o;l++)n[l]=r(t[l],l,void 0,s&&s[l])}else if(typeof t=="number"){n=new Array(t);for(let l=0;l<t;l++)n[l]=r(l+1,l,void 0,s&&s[l])}else if(Se(t))if(t[Symbol.iterator])n=Array.from(t,(l,o)=>r(l,o,void 0,s&&s[o]));else{const l=Object.keys(t);n=new Array(l.length);for(let o=0,a=l.length;o<a;o++){const c=l[o];n[o]=r(t[c],c,o,s&&s[o])}}else n=[];return e&&(e[i]=n),n}const nn=t=>t?Er(t)?Ui(t)||t.proxy:nn(t.parent):null,ni=Ve(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>nn(t.parent),$root:t=>nn(t.root),$emit:t=>t.emit,$options:t=>An(t),$forceUpdate:t=>t.f||(t.f=()=>kn(t.update)),$nextTick:t=>t.n||(t.n=er.bind(t.proxy)),$watch:t=>Zo.bind(t)}),qi=(t,r)=>t!==be&&!t.__isScriptSetup&&we(t,r),la={get({_:t},r){const{ctx:e,setupState:i,data:n,props:s,accessCache:l,type:o,appContext:a}=t;let c;if(r[0]!=="$"){const b=l[r];if(b!==void 0)switch(b){case 1:return i[r];case 2:return n[r];case 4:return e[r];case 3:return s[r]}else{if(qi(i,r))return l[r]=1,i[r];if(n!==be&&we(n,r))return l[r]=2,n[r];if((c=t.propsOptions[0])&&we(c,r))return l[r]=3,s[r];if(e!==be&&we(e,r))return l[r]=4,e[r];sn&&(l[r]=0)}}const h=ni[r];let g,m;if(h)return r==="$attrs"&&qe(t,"get",r),h(t);if((g=o.__cssModules)&&(g=g[r]))return g;if(e!==be&&we(e,r))return l[r]=4,e[r];if(m=a.config.globalProperties,we(m,r))return m[r]},set({_:t},r,e){const{data:i,setupState:n,ctx:s}=t;return qi(n,r)?(n[r]=e,!0):i!==be&&we(i,r)?(i[r]=e,!0):we(t.props,r)||r[0]==="$"&&r.slice(1)in t?!1:(s[r]=e,!0)},has({_:{data:t,setupState:r,accessCache:e,ctx:i,appContext:n,propsOptions:s}},l){let o;return!!e[l]||t!==be&&we(t,l)||qi(r,l)||(o=s[0])&&we(o,l)||we(i,l)||we(ni,l)||we(n.config.globalProperties,l)},defineProperty(t,r,e){return e.get!=null?t._.accessCache[r]=0:we(e,"value")&&this.set(t,r,e.value,null),Reflect.defineProperty(t,r,e)}};let sn=!0;function ca(t){const r=An(t),e=t.proxy,i=t.ctx;sn=!1,r.beforeCreate&&ss(r.beforeCreate,t,"bc");const{data:n,computed:s,methods:l,watch:o,provide:a,inject:c,created:h,beforeMount:g,mounted:m,beforeUpdate:b,updated:x,activated:P,deactivated:S,beforeDestroy:O,beforeUnmount:d,destroyed:w,unmounted:H,render:M,renderTracked:I,renderTriggered:V,errorCaptured:q,serverPrefetch:K,expose:j,inheritAttrs:oe,components:te,directives:fe,filters:ue}=r;if(c&&ua(c,i,null,t.appContext.config.unwrapInjectedRef),l)for(const ae in l){const ne=l[ae];ve(ne)&&(i[ae]=ne.bind(e))}if(n){const ae=n.call(e,e);Se(ae)&&(t.data=Ai(ae))}if(sn=!0,s)for(const ae in s){const ne=s[ae],Te=ve(ne)?ne.bind(e,e):ve(ne.get)?ne.get.bind(e,e):et,$=!ve(ne)&&ve(ne.set)?ne.set.bind(e):et,Me=ht({get:Te,set:$});Object.defineProperty(i,ae,{enumerable:!0,configurable:!0,get:()=>Me.value,set:Ue=>Me.value=Ue})}if(o)for(const ae in o)pr(o[ae],i,e,ae);if(a){const ae=ve(a)?a.call(e):a;Reflect.ownKeys(ae).forEach(ne=>{qo(ne,ae[ne])})}h&&ss(h,t,"c");function le(ae,ne){de(ne)?ne.forEach(Te=>ae(Te.bind(e))):ne&&ae(ne.bind(e))}if(le(Jo,g),le(Qo,m),le($o,b),le(ea,x),le(Ko,P),le(Xo,S),le(ra,q),le(sa,I),le(na,V),le(ta,d),le(ur,H),le(ia,K),de(j))if(j.length){const ae=t.exposed||(t.exposed={});j.forEach(ne=>{Object.defineProperty(ae,ne,{get:()=>e[ne],set:Te=>e[ne]=Te})})}else t.exposed||(t.exposed={});M&&t.render===et&&(t.render=M),oe!=null&&(t.inheritAttrs=oe),te&&(t.components=te),fe&&(t.directives=fe)}function ua(t,r,e=et,i=!1){de(t)&&(t=rn(t));for(const n in t){const s=t[n];let l;Se(s)?"default"in s?l=xi(s.from||n,s.default,!0):l=xi(s.from||n):l=xi(s),Ie(l)&&i?Object.defineProperty(r,n,{enumerable:!0,configurable:!0,get:()=>l.value,set:o=>l.value=o}):r[n]=l}}function ss(t,r,e){tt(de(t)?t.map(i=>i.bind(r.proxy)):t.bind(r.proxy),r,e)}function pr(t,r,e,i){const n=i.includes(".")?ar(e,i):()=>e[i];if(De(t)){const s=r[t];ve(s)&&Gi(n,s)}else if(ve(t))Gi(n,t.bind(e));else if(Se(t))if(de(t))t.forEach(s=>pr(s,r,e,i));else{const s=ve(t.handler)?t.handler.bind(e):r[t.handler];ve(s)&&Gi(n,s,t)}}function An(t){const r=t.type,{mixins:e,extends:i}=r,{mixins:n,optionsCache:s,config:{optionMergeStrategies:l}}=t.appContext,o=s.get(r);let a;return o?a=o:!n.length&&!e&&!i?a=r:(a={},n.length&&n.forEach(c=>Ri(a,c,l,!0)),Ri(a,r,l)),Se(r)&&s.set(r,a),a}function Ri(t,r,e,i=!1){const{mixins:n,extends:s}=r;s&&Ri(t,s,e,!0),n&&n.forEach(l=>Ri(t,l,e,!0));for(const l in r)if(!(i&&l==="expose")){const o=ha[l]||e&&e[l];t[l]=o?o(t[l],r[l]):r[l]}return t}const ha={data:rs,props:Ht,emits:Ht,methods:Ht,computed:Ht,beforeCreate:ze,created:ze,beforeMount:ze,mounted:ze,beforeUpdate:ze,updated:ze,beforeDestroy:ze,beforeUnmount:ze,destroyed:ze,unmounted:ze,activated:ze,deactivated:ze,errorCaptured:ze,serverPrefetch:ze,components:Ht,directives:Ht,watch:fa,provide:rs,inject:da};function rs(t,r){return r?t?function(){return Ve(ve(t)?t.call(this,this):t,ve(r)?r.call(this,this):r)}:r:t}function da(t,r){return Ht(rn(t),rn(r))}function rn(t){if(de(t)){const r={};for(let e=0;e<t.length;e++)r[t[e]]=t[e];return r}return t}function ze(t,r){return t?[...new Set([].concat(t,r))]:r}function Ht(t,r){return t?Ve(Ve(Object.create(null),t),r):r}function fa(t,r){if(!t)return r;if(!r)return t;const e=Ve(Object.create(null),t);for(const i in r)e[i]=ze(t[i],r[i]);return e}function pa(t,r,e,i=!1){const n={},s={};Pi(s,Vi,1),t.propsDefaults=Object.create(null),gr(t,r,n,s);for(const l in t.propsOptions[0])l in n||(n[l]=void 0);e?t.props=i?n:So(n):t.type.props?t.props=n:t.props=s,t.attrs=s}function ga(t,r,e,i){const{props:n,attrs:s,vnode:{patchFlag:l}}=t,o=xe(n),[a]=t.propsOptions;let c=!1;if((i||l>0)&&!(l&16)){if(l&8){const h=t.vnode.dynamicProps;for(let g=0;g<h.length;g++){let m=h[g];if(Ii(t.emitsOptions,m))continue;const b=r[m];if(a)if(we(s,m))b!==s[m]&&(s[m]=b,c=!0);else{const x=lt(m);n[x]=on(a,o,x,b,t,!1)}else b!==s[m]&&(s[m]=b,c=!0)}}}else{gr(t,r,n,s)&&(c=!0);let h;for(const g in o)(!r||!we(r,g)&&((h=It(g))===g||!we(r,h)))&&(a?e&&(e[g]!==void 0||e[h]!==void 0)&&(n[g]=on(a,o,g,void 0,t,!0)):delete n[g]);if(s!==o)for(const g in s)(!r||!we(r,g))&&(delete s[g],c=!0)}c&&pt(t,"set","$attrs")}function gr(t,r,e,i){const[n,s]=t.propsOptions;let l=!1,o;if(r)for(let a in r){if(wi(a))continue;const c=r[a];let h;n&&we(n,h=lt(a))?!s||!s.includes(h)?e[h]=c:(o||(o={}))[h]=c:Ii(t.emitsOptions,a)||(!(a in i)||c!==i[a])&&(i[a]=c,l=!0)}if(s){const a=xe(e),c=o||be;for(let h=0;h<s.length;h++){const g=s[h];e[g]=on(n,a,g,c[g],t,!we(c,g))}}return l}function on(t,r,e,i,n,s){const l=t[e];if(l!=null){const o=we(l,"default");if(o&&i===void 0){const a=l.default;if(l.type!==Function&&ve(a)){const{propsDefaults:c}=n;e in c?i=c[e]:(Yt(n),i=c[e]=a.call(null,r),Ft())}else i=a}l[0]&&(s&&!o?i=!1:l[1]&&(i===""||i===It(e))&&(i=!0))}return i}function mr(t,r,e=!1){const i=r.propsCache,n=i.get(t);if(n)return n;const s=t.props,l={},o=[];let a=!1;if(!ve(t)){const h=g=>{a=!0;const[m,b]=mr(g,r,!0);Ve(l,m),b&&o.push(...b)};!e&&r.mixins.length&&r.mixins.forEach(h),t.extends&&h(t.extends),t.mixins&&t.mixins.forEach(h)}if(!s&&!a)return Se(t)&&i.set(t,jt),jt;if(de(s))for(let h=0;h<s.length;h++){const g=lt(s[h]);os(g)&&(l[g]=be)}else if(s)for(const h in s){const g=lt(h);if(os(g)){const m=s[h],b=l[g]=de(m)||ve(m)?{type:m}:Object.assign({},m);if(b){const x=cs(Boolean,b.type),P=cs(String,b.type);b[0]=x>-1,b[1]=P<0||x<P,(x>-1||we(b,"default"))&&o.push(g)}}}const c=[l,o];return Se(t)&&i.set(t,c),c}function os(t){return t[0]!=="$"}function as(t){const r=t&&t.toString().match(/^\s*(function|class) (\w+)/);return r?r[2]:t===null?"null":""}function ls(t,r){return as(t)===as(r)}function cs(t,r){return de(r)?r.findIndex(e=>ls(e,t)):ve(r)&&ls(r,t)?0:-1}const vr=t=>t[0]==="_"||t==="$stable",Bn=t=>de(t)?t.map(ot):[ot(t)],ma=(t,r,e)=>{if(r._n)return r;const i=zo((...n)=>Bn(r(...n)),e);return i._c=!1,i},yr=(t,r,e)=>{const i=t._ctx;for(const n in t){if(vr(n))continue;const s=t[n];if(ve(s))r[n]=ma(n,s,i);else if(s!=null){const l=Bn(s);r[n]=()=>l}}},wr=(t,r)=>{const e=Bn(r);t.slots.default=()=>e},va=(t,r)=>{if(t.vnode.shapeFlag&32){const e=r._;e?(t.slots=xe(r),Pi(r,"_",e)):yr(r,t.slots={})}else t.slots={},r&&wr(t,r);Pi(t.slots,Vi,1)},ya=(t,r,e)=>{const{vnode:i,slots:n}=t;let s=!0,l=be;if(i.shapeFlag&32){const o=r._;o?e&&o===1?s=!1:(Ve(n,r),!e&&o===1&&delete n._):(s=!r.$stable,yr(r,n)),l=r}else r&&(wr(t,r),l={default:1});if(s)for(const o in n)!vr(o)&&!(o in l)&&delete n[o]};function _r(){return{app:null,config:{isNativeTag:Wr,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let wa=0;function _a(t,r){return function(i,n=null){ve(i)||(i=Object.assign({},i)),n!=null&&!Se(n)&&(n=null);const s=_r(),l=new Set;let o=!1;const a=s.app={_uid:wa++,_component:i,_props:n,_container:null,_context:s,_instance:null,version:Va,get config(){return s.config},set config(c){},use(c,...h){return l.has(c)||(c&&ve(c.install)?(l.add(c),c.install(a,...h)):ve(c)&&(l.add(c),c(a,...h))),a},mixin(c){return s.mixins.includes(c)||s.mixins.push(c),a},component(c,h){return h?(s.components[c]=h,a):s.components[c]},directive(c,h){return h?(s.directives[c]=h,a):s.directives[c]},mount(c,h,g){if(!o){const m=ie(i,n);return m.appContext=s,h&&r?r(m,c):t(m,c,g),o=!0,a._container=c,c.__vue_app__=a,Ui(m.component)||m.component.proxy}},unmount(){o&&(t(null,a._container),delete a._container.__vue_app__)},provide(c,h){return s.provides[c]=h,a}};return a}}function an(t,r,e,i,n=!1){if(de(t)){t.forEach((m,b)=>an(m,r&&(de(r)?r[b]:r),e,i,n));return}if(Ti(i)&&!n)return;const s=i.shapeFlag&4?Ui(i.component)||i.component.proxy:i.el,l=n?null:s,{i:o,r:a}=t,c=r&&r.r,h=o.refs===be?o.refs={}:o.refs,g=o.setupState;if(c!=null&&c!==a&&(De(c)?(h[c]=null,we(g,c)&&(g[c]=null)):Ie(c)&&(c.value=null)),ve(a))bt(a,o,12,[l,h]);else{const m=De(a),b=Ie(a);if(m||b){const x=()=>{if(t.f){const P=m?we(g,a)?g[a]:h[a]:a.value;n?de(P)&&bn(P,s):de(P)?P.includes(s)||P.push(s):m?(h[a]=[s],we(g,a)&&(g[a]=h[a])):(a.value=[s],t.k&&(h[t.k]=a.value))}else m?(h[a]=l,we(g,a)&&(g[a]=l)):b&&(a.value=l,t.k&&(h[t.k]=l))};l?(x.id=-1,je(x,e)):x()}}}const je=Go;function xa(t){return Ta(t)}function Ta(t,r){const e=Xr();e.__VUE__=!0;const{insert:i,remove:n,patchProp:s,createElement:l,createText:o,createComment:a,setText:c,setElementText:h,parentNode:g,nextSibling:m,setScopeId:b=et,insertStaticContent:x}=t,P=(E,C,u,v=null,T=null,L=null,R=!1,B=null,A=!!C.dynamicChildren)=>{if(E===C)return;E&&!$t(E,C)&&(v=dt(E),Ue(E,T,L,!0),E=null),C.patchFlag===-2&&(A=!1,C.dynamicChildren=null);const{type:N,ref:Y,shapeFlag:Z}=C;switch(N){case Ni:S(E,C,u,v);break;case Bt:O(E,C,u,v);break;case Zi:E==null&&d(C,u,v,R);break;case pe:te(E,C,u,v,T,L,R,B,A);break;default:Z&1?M(E,C,u,v,T,L,R,B,A):Z&6?fe(E,C,u,v,T,L,R,B,A):(Z&64||Z&128)&&N.process(E,C,u,v,T,L,R,B,A,nt)}Y!=null&&T&&an(Y,E&&E.ref,L,C||E,!C)},S=(E,C,u,v)=>{if(E==null)i(C.el=o(C.children),u,v);else{const T=C.el=E.el;C.children!==E.children&&c(T,C.children)}},O=(E,C,u,v)=>{E==null?i(C.el=a(C.children||""),u,v):C.el=E.el},d=(E,C,u,v)=>{[E.el,E.anchor]=x(E.children,C,u,v,E.el,E.anchor)},w=({el:E,anchor:C},u,v)=>{let T;for(;E&&E!==C;)T=m(E),i(E,u,v),E=T;i(C,u,v)},H=({el:E,anchor:C})=>{let u;for(;E&&E!==C;)u=m(E),n(E),E=u;n(C)},M=(E,C,u,v,T,L,R,B,A)=>{R=R||C.type==="svg",E==null?I(C,u,v,T,L,R,B,A):K(E,C,T,L,R,B,A)},I=(E,C,u,v,T,L,R,B)=>{let A,N;const{type:Y,props:Z,shapeFlag:W,transition:Q,dirs:J}=E;if(A=E.el=l(E.type,L,Z&&Z.is,Z),W&8?h(A,E.children):W&16&&q(E.children,A,null,v,T,L&&Y!=="foreignObject",R,B),J&&Ct(E,null,v,"created"),V(A,E,E.scopeId,R,v),Z){for(const ye in Z)ye!=="value"&&!wi(ye)&&s(A,ye,null,Z[ye],L,E.children,v,T,We);"value"in Z&&s(A,"value",null,Z.value),(N=Z.onVnodeBeforeMount)&&st(N,v,E)}J&&Ct(E,null,v,"beforeMount");const he=(!T||T&&!T.pendingBranch)&&Q&&!Q.persisted;he&&Q.beforeEnter(A),i(A,C,u),((N=Z&&Z.onVnodeMounted)||he||J)&&je(()=>{N&&st(N,v,E),he&&Q.enter(A),J&&Ct(E,null,v,"mounted")},T)},V=(E,C,u,v,T)=>{if(u&&b(E,u),v)for(let L=0;L<v.length;L++)b(E,v[L]);if(T){let L=T.subTree;if(C===L){const R=T.vnode;V(E,R,R.scopeId,R.slotScopeIds,T.parent)}}},q=(E,C,u,v,T,L,R,B,A=0)=>{for(let N=A;N<E.length;N++){const Y=E[N]=B?_t(E[N]):ot(E[N]);P(null,Y,C,u,v,T,L,R,B)}},K=(E,C,u,v,T,L,R)=>{const B=C.el=E.el;let{patchFlag:A,dynamicChildren:N,dirs:Y}=C;A|=E.patchFlag&16;const Z=E.props||be,W=C.props||be;let Q;u&&Rt(u,!1),(Q=W.onVnodeBeforeUpdate)&&st(Q,u,C,E),Y&&Ct(C,E,u,"beforeUpdate"),u&&Rt(u,!0);const J=T&&C.type!=="foreignObject";if(N?j(E.dynamicChildren,N,B,u,v,J,L):R||ne(E,C,B,null,u,v,J,L,!1),A>0){if(A&16)oe(B,C,Z,W,u,v,T);else if(A&2&&Z.class!==W.class&&s(B,"class",null,W.class,T),A&4&&s(B,"style",Z.style,W.style,T),A&8){const he=C.dynamicProps;for(let ye=0;ye<he.length;ye++){const p=he[ye],f=Z[p],y=W[p];(y!==f||p==="value")&&s(B,p,f,y,T,E.children,u,v,We)}}A&1&&E.children!==C.children&&h(B,C.children)}else!R&&N==null&&oe(B,C,Z,W,u,v,T);((Q=W.onVnodeUpdated)||Y)&&je(()=>{Q&&st(Q,u,C,E),Y&&Ct(C,E,u,"updated")},v)},j=(E,C,u,v,T,L,R)=>{for(let B=0;B<C.length;B++){const A=E[B],N=C[B],Y=A.el&&(A.type===pe||!$t(A,N)||A.shapeFlag&70)?g(A.el):u;P(A,N,Y,null,v,T,L,R,!0)}},oe=(E,C,u,v,T,L,R)=>{if(u!==v){if(u!==be)for(const B in u)!wi(B)&&!(B in v)&&s(E,B,u[B],null,R,C.children,T,L,We);for(const B in v){if(wi(B))continue;const A=v[B],N=u[B];A!==N&&B!=="value"&&s(E,B,N,A,R,C.children,T,L,We)}"value"in v&&s(E,"value",u.value,v.value)}},te=(E,C,u,v,T,L,R,B,A)=>{const N=C.el=E?E.el:o(""),Y=C.anchor=E?E.anchor:o("");let{patchFlag:Z,dynamicChildren:W,slotScopeIds:Q}=C;Q&&(B=B?B.concat(Q):Q),E==null?(i(N,u,v),i(Y,u,v),q(C.children,u,Y,T,L,R,B,A)):Z>0&&Z&64&&W&&E.dynamicChildren?(j(E.dynamicChildren,W,u,T,L,R,B),(C.key!=null||T&&C===T.subTree)&&xr(E,C,!0)):ne(E,C,u,Y,T,L,R,B,A)},fe=(E,C,u,v,T,L,R,B,A)=>{C.slotScopeIds=B,E==null?C.shapeFlag&512?T.ctx.activate(C,u,v,R,A):ue(C,u,v,T,L,R,A):_e(E,C,A)},ue=(E,C,u,v,T,L,R)=>{const B=E.component=Da(E,v,T);if(lr(E)&&(B.ctx.renderer=nt),Ma(B),B.asyncDep){if(T&&T.registerDep(B,le),!E.el){const A=B.subTree=ie(Bt);O(null,A,C,u)}return}le(B,E,C,u,T,L,R)},_e=(E,C,u)=>{const v=C.component=E.component;if(Uo(E,C,u))if(v.asyncDep&&!v.asyncResolved){ae(v,C,u);return}else v.next=C,Fo(v.update),v.update();else C.el=E.el,v.vnode=C},le=(E,C,u,v,T,L,R)=>{const B=()=>{if(E.isMounted){let{next:Y,bu:Z,u:W,parent:Q,vnode:J}=E,he=Y,ye;Rt(E,!1),Y?(Y.el=J.el,ae(E,Y,R)):Y=J,Z&&_i(Z),(ye=Y.props&&Y.props.onVnodeBeforeUpdate)&&st(ye,Q,Y,J),Rt(E,!0);const p=ji(E),f=E.subTree;E.subTree=p,P(f,p,g(f.el),dt(f),E,T,L),Y.el=p.el,he===null&&Wo(E,p.el),W&&je(W,T),(ye=Y.props&&Y.props.onVnodeUpdated)&&je(()=>st(ye,Q,Y,J),T)}else{let Y;const{el:Z,props:W}=C,{bm:Q,m:J,parent:he}=E,ye=Ti(C);if(Rt(E,!1),Q&&_i(Q),!ye&&(Y=W&&W.onVnodeBeforeMount)&&st(Y,he,C),Rt(E,!0),Z&&yt){const p=()=>{E.subTree=ji(E),yt(Z,E.subTree,E,T,null)};ye?C.type.__asyncLoader().then(()=>!E.isUnmounted&&p()):p()}else{const p=E.subTree=ji(E);P(null,p,u,v,E,T,L),C.el=p.el}if(J&&je(J,T),!ye&&(Y=W&&W.onVnodeMounted)){const p=C;je(()=>st(Y,he,p),T)}(C.shapeFlag&256||he&&Ti(he.vnode)&&he.vnode.shapeFlag&256)&&E.a&&je(E.a,T),E.isMounted=!0,C=u=v=null}},A=E.effect=new Cn(B,()=>kn(N),E.scope),N=E.update=()=>A.run();N.id=E.uid,Rt(E,!0),N()},ae=(E,C,u)=>{C.component=E;const v=E.vnode.props;E.vnode=C,E.next=null,ga(E,C.props,v,u),ya(E,C.children,u),Jt(),ts(),Qt()},ne=(E,C,u,v,T,L,R,B,A=!1)=>{const N=E&&E.children,Y=E?E.shapeFlag:0,Z=C.children,{patchFlag:W,shapeFlag:Q}=C;if(W>0){if(W&128){$(N,Z,u,v,T,L,R,B,A);return}else if(W&256){Te(N,Z,u,v,T,L,R,B,A);return}}Q&8?(Y&16&&We(N,T,L),Z!==N&&h(u,Z)):Y&16?Q&16?$(N,Z,u,v,T,L,R,B,A):We(N,T,L,!0):(Y&8&&h(u,""),Q&16&&q(Z,u,v,T,L,R,B,A))},Te=(E,C,u,v,T,L,R,B,A)=>{E=E||jt,C=C||jt;const N=E.length,Y=C.length,Z=Math.min(N,Y);let W;for(W=0;W<Z;W++){const Q=C[W]=A?_t(C[W]):ot(C[W]);P(E[W],Q,u,null,T,L,R,B,A)}N>Y?We(E,T,L,!0,!1,Z):q(C,u,v,T,L,R,B,A,Z)},$=(E,C,u,v,T,L,R,B,A)=>{let N=0;const Y=C.length;let Z=E.length-1,W=Y-1;for(;N<=Z&&N<=W;){const Q=E[N],J=C[N]=A?_t(C[N]):ot(C[N]);if($t(Q,J))P(Q,J,u,null,T,L,R,B,A);else break;N++}for(;N<=Z&&N<=W;){const Q=E[Z],J=C[W]=A?_t(C[W]):ot(C[W]);if($t(Q,J))P(Q,J,u,null,T,L,R,B,A);else break;Z--,W--}if(N>Z){if(N<=W){const Q=W+1,J=Q<Y?C[Q].el:v;for(;N<=W;)P(null,C[N]=A?_t(C[N]):ot(C[N]),u,J,T,L,R,B,A),N++}}else if(N>W)for(;N<=Z;)Ue(E[N],T,L,!0),N++;else{const Q=N,J=N,he=new Map;for(N=J;N<=W;N++){const ee=C[N]=A?_t(C[N]):ot(C[N]);ee.key!=null&&he.set(ee.key,N)}let ye,p=0;const f=W-J+1;let y=!1,_=0;const z=new Array(f);for(N=0;N<f;N++)z[N]=0;for(N=Q;N<=Z;N++){const ee=E[N];if(p>=f){Ue(ee,T,L,!0);continue}let ge;if(ee.key!=null)ge=he.get(ee.key);else for(ye=J;ye<=W;ye++)if(z[ye-J]===0&&$t(ee,C[ye])){ge=ye;break}ge===void 0?Ue(ee,T,L,!0):(z[ge-J]=N+1,ge>=_?_=ge:y=!0,P(ee,C[ge],u,null,T,L,R,B,A),p++)}const G=y?ba(z):jt;for(ye=G.length-1,N=f-1;N>=0;N--){const ee=J+N,ge=C[ee],se=ee+1<Y?C[ee+1].el:v;z[N]===0?P(null,ge,u,se,T,L,R,B,A):y&&(ye<0||N!==G[ye]?Me(ge,u,se,2):ye--)}}},Me=(E,C,u,v,T=null)=>{const{el:L,type:R,transition:B,children:A,shapeFlag:N}=E;if(N&6){Me(E.component.subTree,C,u,v);return}if(N&128){E.suspense.move(C,u,v);return}if(N&64){R.move(E,C,u,nt);return}if(R===pe){i(L,C,u);for(let Z=0;Z<A.length;Z++)Me(A[Z],C,u,v);i(E.anchor,C,u);return}if(R===Zi){w(E,C,u);return}if(v!==2&&N&1&&B)if(v===0)B.beforeEnter(L),i(L,C,u),je(()=>B.enter(L),T);else{const{leave:Z,delayLeave:W,afterLeave:Q}=B,J=()=>i(L,C,u),he=()=>{Z(L,()=>{J(),Q&&Q()})};W?W(L,J,he):he()}else i(L,C,u)},Ue=(E,C,u,v=!1,T=!1)=>{const{type:L,props:R,ref:B,children:A,dynamicChildren:N,shapeFlag:Y,patchFlag:Z,dirs:W}=E;if(B!=null&&an(B,null,u,E,!0),Y&256){C.ctx.deactivate(E);return}const Q=Y&1&&W,J=!Ti(E);let he;if(J&&(he=R&&R.onVnodeBeforeUnmount)&&st(he,C,E),Y&6)Vt(E.component,u,v);else{if(Y&128){E.suspense.unmount(u,v);return}Q&&Ct(E,null,C,"beforeUnmount"),Y&64?E.type.remove(E,C,u,T,nt,v):N&&(L!==pe||Z>0&&Z&64)?We(N,C,u,!1,!0):(L===pe&&Z&384||!T&&Y&16)&&We(A,C,u),v&&Pt(E)}(J&&(he=R&&R.onVnodeUnmounted)||Q)&&je(()=>{he&&st(he,C,E),Q&&Ct(E,null,C,"unmounted")},u)},Pt=E=>{const{type:C,el:u,anchor:v,transition:T}=E;if(C===pe){mt(u,v);return}if(C===Zi){H(E);return}const L=()=>{n(u),T&&!T.persisted&&T.afterLeave&&T.afterLeave()};if(E.shapeFlag&1&&T&&!T.persisted){const{leave:R,delayLeave:B}=T,A=()=>R(u,L);B?B(E.el,L,A):A()}else L()},mt=(E,C)=>{let u;for(;E!==C;)u=m(E),n(E),E=u;n(C)},Vt=(E,C,u)=>{const{bum:v,scope:T,update:L,subTree:R,um:B}=E;v&&_i(v),T.stop(),L&&(L.active=!1,Ue(R,E,C,u)),B&&je(B,C),je(()=>{E.isUnmounted=!0},C),C&&C.pendingBranch&&!C.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===C.pendingId&&(C.deps--,C.deps===0&&C.resolve())},We=(E,C,u,v=!1,T=!1,L=0)=>{for(let R=L;R<E.length;R++)Ue(E[R],C,u,v,T)},dt=E=>E.shapeFlag&6?dt(E.component.subTree):E.shapeFlag&128?E.suspense.next():m(E.anchor||E.el),St=(E,C,u)=>{E==null?C._vnode&&Ue(C._vnode,null,null,!0):P(C._vnode||null,E,C,null,null,null,u),ts(),ir(),C._vnode=E},nt={p:P,um:Ue,m:Me,r:Pt,mt:ue,mc:q,pc:ne,pbc:j,n:dt,o:t};let vt,yt;return r&&([vt,yt]=r(nt)),{render:St,hydrate:vt,createApp:_a(St,vt)}}function Rt({effect:t,update:r},e){t.allowRecurse=r.allowRecurse=e}function xr(t,r,e=!1){const i=t.children,n=r.children;if(de(i)&&de(n))for(let s=0;s<i.length;s++){const l=i[s];let o=n[s];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=n[s]=_t(n[s]),o.el=l.el),e||xr(l,o)),o.type===Ni&&(o.el=l.el)}}function ba(t){const r=t.slice(),e=[0];let i,n,s,l,o;const a=t.length;for(i=0;i<a;i++){const c=t[i];if(c!==0){if(n=e[e.length-1],t[n]<c){r[i]=n,e.push(i);continue}for(s=0,l=e.length-1;s<l;)o=s+l>>1,t[e[o]]<c?s=o+1:l=o;c<t[e[s]]&&(s>0&&(r[i]=e[s-1]),e[s]=i)}}for(s=e.length,l=e[s-1];s-- >0;)e[s]=l,l=r[l];return e}const Ea=t=>t.__isTeleport,pe=Symbol(void 0),Ni=Symbol(void 0),Bt=Symbol(void 0),Zi=Symbol(void 0),si=[];let $e=null;function D(t=!1){si.push($e=t?null:[])}function Pa(){si.pop(),$e=si[si.length-1]||null}let ci=1;function us(t){ci+=t}function Tr(t){return t.dynamicChildren=ci>0?$e||jt:null,Pa(),ci>0&&$e&&$e.push(t),t}function k(t,r,e,i,n,s){return Tr(F(t,r,e,i,n,s,!0))}function Be(t,r,e,i,n){return Tr(ie(t,r,e,i,n,!0))}function ln(t){return t?t.__v_isVNode===!0:!1}function $t(t,r){return t.type===r.type&&t.key===r.key}const Vi="__vInternal",br=({key:t})=>t??null,bi=({ref:t,ref_key:r,ref_for:e})=>t!=null?De(t)||Ie(t)||ve(t)?{i:Ye,r:t,k:r,f:!!e}:t:null;function F(t,r=null,e=null,i=0,n=null,s=t===pe?0:1,l=!1,o=!1){const a={__v_isVNode:!0,__v_skip:!0,type:t,props:r,key:r&&br(r),ref:r&&bi(r),scopeId:rr,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:i,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:Ye};return o?(In(a,e),s&128&&t.normalize(a)):e&&(a.shapeFlag|=De(e)?8:16),ci>0&&!l&&$e&&(a.patchFlag>0||s&6)&&a.patchFlag!==32&&$e.push(a),a}const ie=Sa;function Sa(t,r=null,e=null,i=0,n=null,s=!1){if((!t||t===aa)&&(t=Bt),ln(t)){const o=Xt(t,r,!0);return e&&In(o,e),ci>0&&!s&&$e&&(o.shapeFlag&6?$e[$e.indexOf(t)]=o:$e.push(o)),o.patchFlag|=-2,o}if(Ba(t)&&(t=t.__vccOpts),r){r=Ca(r);let{class:o,style:a}=r;o&&!De(o)&&(r.class=Ee(o)),Se(a)&&(qs(a)&&!de(a)&&(a=Ve({},a)),r.style=xn(a))}const l=De(t)?1:jo(t)?128:Ea(t)?64:Se(t)?4:ve(t)?2:0;return F(t,r,e,i,n,l,s,!0)}function Ca(t){return t?qs(t)||Vi in t?Ve({},t):t:null}function Xt(t,r,e=!1){const{props:i,ref:n,patchFlag:s,children:l}=t,o=r?Ra(i||{},r):i;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:o,key:o&&br(o),ref:r&&r.ref?e&&n?de(n)?n.concat(bi(r)):[n,bi(r)]:bi(r):n,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:l,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:r&&t.type!==pe?s===-1?16:s|16:s,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Xt(t.ssContent),ssFallback:t.ssFallback&&Xt(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function Pe(t=" ",r=0){return ie(Ni,null,t,r)}function re(t="",r=!1){return r?(D(),Be(Bt,null,t)):ie(Bt,null,t)}function ot(t){return t==null||typeof t=="boolean"?ie(Bt):de(t)?ie(pe,null,t.slice()):typeof t=="object"?_t(t):ie(Ni,null,String(t))}function _t(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Xt(t)}function In(t,r){let e=0;const{shapeFlag:i}=t;if(r==null)r=null;else if(de(r))e=16;else if(typeof r=="object")if(i&65){const n=r.default;n&&(n._c&&(n._d=!1),In(t,n()),n._c&&(n._d=!0));return}else{e=32;const n=r._;!n&&!(Vi in r)?r._ctx=Ye:n===3&&Ye&&(Ye.slots._===1?r._=1:(r._=2,t.patchFlag|=1024))}else ve(r)?(r={default:r,_ctx:Ye},e=32):(r=String(r),i&64?(e=16,r=[Pe(r)]):e=8);t.children=r,t.shapeFlag|=e}function Ra(...t){const r={};for(let e=0;e<t.length;e++){const i=t[e];for(const n in i)if(n==="class")r.class!==i.class&&(r.class=Ee([r.class,i.class]));else if(n==="style")r.style=xn([r.style,i.style]);else if(Di(n)){const s=r[n],l=i[n];l&&s!==l&&!(de(s)&&s.includes(l))&&(r[n]=s?[].concat(s,l):l)}else n!==""&&(r[n]=i[n])}return r}function st(t,r,e,i=null){tt(t,r,7,[e,i])}const Ha=_r();let La=0;function Da(t,r,e){const i=t.type,n=(r?r.appContext:t.appContext)||Ha,s={uid:La++,vnode:t,type:i,parent:r,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,scope:new Yr(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(n.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:mr(i,n),emitsOptions:sr(i,n),emit:null,emitted:null,propsDefaults:be,inheritAttrs:i.inheritAttrs,ctx:be,data:be,props:be,attrs:be,slots:be,refs:be,setupState:be,setupContext:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=r?r.root:s,s.emit=Io.bind(null,s),t.ce&&t.ce(s),s}let Re=null;const Yt=t=>{Re=t,t.scope.on()},Ft=()=>{Re&&Re.scope.off(),Re=null};function Er(t){return t.vnode.shapeFlag&4}let ui=!1;function Ma(t,r=!1){ui=r;const{props:e,children:i}=t.vnode,n=Er(t);pa(t,e,n,r),va(t,i);const s=n?Oa(t,r):void 0;return ui=!1,s}function Oa(t,r){const e=t.type;t.accessCache=Object.create(null),t.proxy=Zs(new Proxy(t.ctx,la));const{setup:i}=e;if(i){const n=t.setupContext=i.length>1?Fa(t):null;Yt(t),Jt();const s=bt(i,t,0,[t.props,n]);if(Qt(),Ft(),Ms(s)){if(s.then(Ft,Ft),r)return s.then(l=>{hs(t,l,r)}).catch(l=>{Bi(l,t,0)});t.asyncDep=s}else hs(t,s,r)}else Pr(t,r)}function hs(t,r,e){ve(r)?t.type.__ssrInlineRender?t.ssrRender=r:t.render=r:Se(r)&&(t.setupState=Js(r)),Pr(t,e)}let ds;function Pr(t,r,e){const i=t.type;if(!t.render){if(!r&&ds&&!i.render){const n=i.template||An(t).template;if(n){const{isCustomElement:s,compilerOptions:l}=t.appContext.config,{delimiters:o,compilerOptions:a}=i,c=Ve(Ve({isCustomElement:s,delimiters:o},l),a);i.render=ds(n,c)}}t.render=i.render||et}Yt(t),Jt(),ca(t),Qt(),Ft()}function ka(t){return new Proxy(t.attrs,{get(r,e){return qe(t,"get","$attrs"),r[e]}})}function Fa(t){const r=i=>{t.exposed=i||{}};let e;return{get attrs(){return e||(e=ka(t))},slots:t.slots,emit:t.emit,expose:r}}function Ui(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(Js(Zs(t.exposed)),{get(r,e){if(e in r)return r[e];if(e in ni)return ni[e](t)},has(r,e){return e in r||e in ni}}))}function Aa(t,r=!0){return ve(t)?t.displayName||t.name:t.name||r&&t.__name}function Ba(t){return ve(t)&&"__vccOpts"in t}const ht=(t,r)=>Mo(t,r,ui);function Ia(t,r,e){const i=arguments.length;return i===2?Se(r)&&!de(r)?ln(r)?ie(t,null,[r]):ie(t,r):ie(t,null,r):(i>3?e=Array.prototype.slice.call(arguments,2):i===3&&ln(e)&&(e=[e]),ie(t,r,e))}const za=Symbol(""),Na=()=>xi(za),Va="3.2.47",Ua="http://www.w3.org/2000/svg",Dt=typeof document<"u"?document:null,fs=Dt&&Dt.createElement("template"),Wa={insert:(t,r,e)=>{r.insertBefore(t,e||null)},remove:t=>{const r=t.parentNode;r&&r.removeChild(t)},createElement:(t,r,e,i)=>{const n=r?Dt.createElementNS(Ua,t):Dt.createElement(t,e?{is:e}:void 0);return t==="select"&&i&&i.multiple!=null&&n.setAttribute("multiple",i.multiple),n},createText:t=>Dt.createTextNode(t),createComment:t=>Dt.createComment(t),setText:(t,r)=>{t.nodeValue=r},setElementText:(t,r)=>{t.textContent=r},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Dt.querySelector(t),setScopeId(t,r){t.setAttribute(r,"")},insertStaticContent(t,r,e,i,n,s){const l=e?e.previousSibling:r.lastChild;if(n&&(n===s||n.nextSibling))for(;r.insertBefore(n.cloneNode(!0),e),!(n===s||!(n=n.nextSibling)););else{fs.innerHTML=i?`<svg>${t}</svg>`:t;const o=fs.content;if(i){const a=o.firstChild;for(;a.firstChild;)o.appendChild(a.firstChild);o.removeChild(a)}r.insertBefore(o,e)}return[l?l.nextSibling:r.firstChild,e?e.previousSibling:r.lastChild]}};function ja(t,r,e){const i=t._vtc;i&&(r=(r?[r,...i]:[...i]).join(" ")),r==null?t.removeAttribute("class"):e?t.setAttribute("class",r):t.className=r}function Ga(t,r,e){const i=t.style,n=De(e);if(e&&!n){if(r&&!De(r))for(const s in r)e[s]==null&&cn(i,s,"");for(const s in e)cn(i,s,e[s])}else{const s=i.display;n?r!==e&&(i.cssText=e):r&&t.removeAttribute("style"),"_vod"in t&&(i.display=s)}}const ps=/\s*!important$/;function cn(t,r,e){if(de(e))e.forEach(i=>cn(t,r,i));else if(e==null&&(e=""),r.startsWith("--"))t.setProperty(r,e);else{const i=qa(t,r);ps.test(e)?t.setProperty(It(i),e.replace(ps,""),"important"):t[i]=e}}const gs=["Webkit","Moz","ms"],Ki={};function qa(t,r){const e=Ki[r];if(e)return e;let i=lt(r);if(i!=="filter"&&i in t)return Ki[r]=i;i=ki(i);for(let n=0;n<gs.length;n++){const s=gs[n]+i;if(s in t)return Ki[r]=s}return r}const ms="http://www.w3.org/1999/xlink";function Za(t,r,e,i,n){if(i&&r.startsWith("xlink:"))e==null?t.removeAttributeNS(ms,r.slice(6,r.length)):t.setAttributeNS(ms,r,e);else{const s=Ur(r);e==null||s&&!Hs(e)?t.removeAttribute(r):t.setAttribute(r,s?"":e)}}function Ka(t,r,e,i,n,s,l){if(r==="innerHTML"||r==="textContent"){i&&l(i,n,s),t[r]=e??"";return}if(r==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=e;const a=e??"";(t.value!==a||t.tagName==="OPTION")&&(t.value=a),e==null&&t.removeAttribute(r);return}let o=!1;if(e===""||e==null){const a=typeof t[r];a==="boolean"?e=Hs(e):e==null&&a==="string"?(e="",o=!0):a==="number"&&(e=0,o=!0)}try{t[r]=e}catch{}o&&t.removeAttribute(r)}function Wt(t,r,e,i){t.addEventListener(r,e,i)}function Xa(t,r,e,i){t.removeEventListener(r,e,i)}function Ya(t,r,e,i,n=null){const s=t._vei||(t._vei={}),l=s[r];if(i&&l)l.value=i;else{const[o,a]=Ja(r);if(i){const c=s[r]=el(i,n);Wt(t,o,c,a)}else l&&(Xa(t,o,l,a),s[r]=void 0)}}const vs=/(?:Once|Passive|Capture)$/;function Ja(t){let r;if(vs.test(t)){r={};let i;for(;i=t.match(vs);)t=t.slice(0,t.length-i[0].length),r[i[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):It(t.slice(2)),r]}let Xi=0;const Qa=Promise.resolve(),$a=()=>Xi||(Qa.then(()=>Xi=0),Xi=Date.now());function el(t,r){const e=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=e.attached)return;tt(tl(i,e.value),r,5,[i])};return e.value=t,e.attached=$a(),e}function tl(t,r){if(de(r)){const e=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{e.call(t),t._stopped=!0},r.map(i=>n=>!n._stopped&&i&&i(n))}else return r}const ys=/^on[a-z]/,il=(t,r,e,i,n=!1,s,l,o,a)=>{r==="class"?ja(t,i,n):r==="style"?Ga(t,e,i):Di(r)?Tn(r)||Ya(t,r,e,i,l):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):nl(t,r,i,n))?Ka(t,r,i,s,l,o,a):(r==="true-value"?t._trueValue=i:r==="false-value"&&(t._falseValue=i),Za(t,r,i,n))};function nl(t,r,e,i){return i?!!(r==="innerHTML"||r==="textContent"||r in t&&ys.test(r)&&ve(e)):r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&t.tagName==="INPUT"||r==="type"&&t.tagName==="TEXTAREA"||ys.test(r)&&De(e)?!1:r in t}const ws=t=>{const r=t.props["onUpdate:modelValue"]||!1;return de(r)?e=>_i(r,e):r};function sl(t){t.target.composing=!0}function _s(t){const r=t.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const Sr={created(t,{modifiers:{lazy:r,trim:e,number:i}},n){t._assign=ws(n);const s=i||n.props&&n.props.type==="number";Wt(t,r?"change":"input",l=>{if(l.target.composing)return;let o=t.value;e&&(o=o.trim()),s&&(o=Yi(o)),t._assign(o)}),e&&Wt(t,"change",()=>{t.value=t.value.trim()}),r||(Wt(t,"compositionstart",sl),Wt(t,"compositionend",_s),Wt(t,"change",_s))},mounted(t,{value:r}){t.value=r??""},beforeUpdate(t,{value:r,modifiers:{lazy:e,trim:i,number:n}},s){if(t._assign=ws(s),t.composing||document.activeElement===t&&t.type!=="range"&&(e||i&&t.value.trim()===r||(n||t.type==="number")&&Yi(t.value)===r))return;const l=r??"";t.value!==l&&(t.value=l)}},rl=["ctrl","shift","alt","meta"],ol={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,r)=>rl.some(e=>t[`${e}Key`]&&!r.includes(e))},Ot=(t,r)=>(e,...i)=>{for(let n=0;n<r.length;n++){const s=ol[r[n]];if(s&&s(e,r))return}return t(e,...i)},al={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ii=(t,r)=>e=>{if(!("key"in e))return;const i=It(e.key);if(r.some(n=>n===i||al[n]===i))return t(e)},rt={beforeMount(t,{value:r},{transition:e}){t._vod=t.style.display==="none"?"":t.style.display,e&&r?e.beforeEnter(t):ei(t,r)},mounted(t,{value:r},{transition:e}){e&&r&&e.enter(t)},updated(t,{value:r,oldValue:e},{transition:i}){!r!=!e&&(i?r?(i.beforeEnter(t),ei(t,!0),i.enter(t)):i.leave(t,()=>{ei(t,!1)}):ei(t,r))},beforeUnmount(t,{value:r}){ei(t,r)}};function ei(t,r){t.style.display=r?t._vod:"none"}const ll=Ve({patchProp:il},Wa);let xs;function cl(){return xs||(xs=xa(ll))}const ul=(...t)=>{const r=cl().createApp(...t),{mount:e}=r;return r.mount=i=>{const n=hl(i);if(!n)return;const s=r._component;!ve(s)&&!s.render&&!s.template&&(s.template=n.innerHTML),n.innerHTML="";const l=e(n,!1,n instanceof SVGElement);return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),l},r};function hl(t){return De(t)?document.querySelector(t):t}var zn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},un={},dl={get exports(){return un},set exports(t){un=t}};(function(t,r){(function(e,i){t.exports=i()})(zn,function(){var e="__v-click-outside",i=typeof window<"u",n=typeof navigator<"u",s=i&&("ontouchstart"in window||n&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"],l=function(h){var g=h.event,m=h.handler;(0,h.middleware)(g)&&m(g)},o=function(h,g){var m=function(d){var w=typeof d=="function";if(!w&&typeof d!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:w?d:d.handler,middleware:d.middleware||function(H){return H},events:d.events||s,isActive:d.isActive!==!1,detectIframe:d.detectIframe!==!1,capture:!!d.capture}}(g.value),b=m.handler,x=m.middleware,P=m.detectIframe,S=m.capture;if(m.isActive){if(h[e]=m.events.map(function(d){return{event:d,srcTarget:document.documentElement,handler:function(w){return function(H){var M=H.el,I=H.event,V=H.handler,q=H.middleware,K=I.path||I.composedPath&&I.composedPath();(K?K.indexOf(M)<0:!M.contains(I.target))&&l({event:I,handler:V,middleware:q})}({el:h,event:w,handler:b,middleware:x})},capture:S}}),P){var O={event:"blur",srcTarget:window,handler:function(d){return function(w){var H=w.el,M=w.event,I=w.handler,V=w.middleware;setTimeout(function(){var q=document.activeElement;q&&q.tagName==="IFRAME"&&!H.contains(q)&&l({event:M,handler:I,middleware:V})},0)}({el:h,event:d,handler:b,middleware:x})},capture:S};h[e]=[].concat(h[e],[O])}h[e].forEach(function(d){var w=d.event,H=d.srcTarget,M=d.handler;return setTimeout(function(){h[e]&&H.addEventListener(w,M,S)},0)})}},a=function(h){(h[e]||[]).forEach(function(g){return g.srcTarget.removeEventListener(g.event,g.handler,g.capture)}),delete h[e]},c=i?{beforeMount:o,updated:function(h,g){var m=g.value,b=g.oldValue;JSON.stringify(m)!==JSON.stringify(b)&&(a(h),o(h,{value:m}))},unmounted:a}:{};return{install:function(h){h.directive("click-outside",c)},directive:c}})})(dl);const fl=un,ce=(t,r)=>{const e=t.__vccOpts||t;for(const[i,n]of r)e[i]=n;return e},pl={},gl={class:"tify-icon",viewBox:"0 0 24 24"},ml=F("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},null,-1),vl=[ml];function yl(t,r){return D(),k("svg",gl,vl)}const Cr=ce(pl,[["render",yl]]),Hi=Ys("");function it(t){Hi.value=t}let hn;const Ke=Ai({collection:{},manifest:{},options:{},translation:{}}),{collection:Fe,manifest:me,options:U,translation:dn}=Ke,Ge=ht(()=>Ke.manifest.sequences?Ke.manifest.sequences[0].canvases:[]),ct=ht(()=>Ge.value.length);function fn(){const{startCanvas:t}=Ke.manifest.sequences[0],r=Ge.value.findIndex(e=>e["@id"]===t);return r>=0?r+1:1}function Rr(t){if(!Array.isArray(t)||new Set(t).size!==t.length)return!1;for(let r=0,e=t.length;r<e;r+=1)if(!Number.isInteger(t[r])||r>0&&t[r]>0&&t[r]<=t[r-1]||t[r]<0||t[r]>ct.value)return!1;return!0}function Ce(t){Object.assign(Ke.options,t),clearTimeout(hn),Ke.options.urlQueryKey&&(hn=setTimeout(()=>{const r={};Ke.options.urlQueryParams.forEach(i=>{const n=Ke.options[i];n===null||i==="pages"&&n.length<2&&n[0]<2||typeof n=="object"&&!Object.keys(n).length?delete r[i]:r[i]=Ke.options[i]});const e=new URL(window.location);e.searchParams.set(Ke.options.urlQueryKey,JSON.stringify(r)),window.history&&(t.pages?(it(""),window.history.pushState({},"",e)):window.history.replaceState({},"",e))},100))}function wl(t){Object.assign(Ke.collection,t)}function Ts(t){Object.assign(Ke.manifest,t)}function bs(t){Object.assign(Ke.translation,t)}function zt(){return U.root.$el.offsetWidth<U.breakpoints.medium}function Li(t,r,e=120){const i=t,n=e===!0?120:e;if(!n||n<0){i.scrollTop=r;return}const l=(r-t.scrollTop)/n/.1;setTimeout(()=>{i.scrollTop+=l,i.scrollTop!==r&&Li(i,r,n-10)},10)}function pn(t,r,e=!0){const i=r.querySelectorAll(t);if(!i.length)return;let n=i[0];const s=i[i.length-1];Array.prototype.forEach.call(i,c=>{c.dataset.level>n.dataset.level&&(n=c)});const l=r.getBoundingClientRect(),o=n.getBoundingClientRect(),a=s.getBoundingClientRect();if(o.top<l.top){const c=o.top-l.top+r.scrollTop;Li(r,c-50,e)}else if(a.bottom>l.bottom){const c=a.bottom-l.bottom+r.scrollTop;Li(r,c+50,e)}}const Xe=Ys(0);async function di(...t){const[r,e]=t;if({}.TEST)return new Promise((s,l)=>{r==="/de.json"?s({}):l(new Error)});Xe.value+=1;const n=await(await fetch(r,e).catch(s=>(Xe.value=0,Promise.reject(s)))).json().catch(s=>(Xe.value=0,Promise.reject(s)));return Xe.value>0&&(Xe.value-=1),n}async function _l(...t){const[r,e]=t;Xe.value+=1;const n=await(await fetch(r,e).catch(s=>(Xe.value=0,Promise.reject(s)))).text().catch(s=>(Xe.value=0,Promise.reject(s)));return Xe.value>0&&(Xe.value-=1),n}function gn(t){let r={};try{const e=new URLSearchParams(window.location.search);r=JSON.parse(e.get(U.urlQueryKey))||{}}catch{}r.view===""&&zt()&&(r.view="scan"),r.pages&&!Rr(r.pages)&&(it("Invalid pages, reset to start page"),r.pages=null),U.childManifestUrl=r.childManifestUrl||U.childManifestUrl,U.filters=r.filters||U.filters,U.pages=t&&t.type==="popstate"?r.pages||[fn()]:r.pages||U.pages||[fn()],U.pan=r.panX||r.panY?{x:r.panX,y:r.panY}:r.pan||U.pan,U.rotation=parseInt(r.rotation,10)||U.rotation,U.view=r.view||r.view===""?r.view:U.view,U.zoom=parseFloat(r.zoom)||U.zoom}function Es(t=1){Xe.value=t}U.translationsDirUrl="";function Ps(t){let r,e;const i=new Promise((s,l)=>{r=s,e=l});if(t==="en")return U.language="en",bs(null),r(t),i;U.translationsDirUrl===null&&e(new Error("Could not determine translationsDirUrl"));const n=`${U.translationsDirUrl}/${t}.json`;return di(n).then(s=>{U.language=t,bs(s),r(t)},s=>{const l=s.response?s.response.statusText:s.message;it(`Error loading translation for "${t}": ${l}`),e(new Error(s))}),i}function He(t,r){return dn[t]?dn[t]:r||t}const xl={computed:{copyrightHtml(){return He("$copyright",'Copyright &copy; 2017&ndash;2022 <a href="https://www.uni-goettingen.de/en/">GÃ¶ttingen University</a>&nbsp;/ <a href="https://www.sub.uni-goettingen.de/en/">GÃ¶ttingen State and University Library</a>')},env(){return{version:"0.28.1",license:"AGPL-3.0",bugsUrl:"https://github.com/tify-iiif-viewer/tify/issues",contributorsUrl:"https://github.com/tify-iiif-viewer/tify/blob/v0.28.1/CONTRIBUTORS.md",docsUrl:"https://github.com/tify-iiif-viewer/tify/blob/v0.28.1/doc",docsLanguages:["de","en"],repositoryUrl:"https://github.com/tify-iiif-viewer/tify"}},infoHtml(){return He("$info",'TIFY is a slim and mobile-friendly IIIF document viewer, released under the <a href="https://www.gnu.org/licenses/agpl-3.0.html.en">GNU Affero General Public License 3.0</a>.')},userGuideUrl(){const t=this.env.docsLanguages.includes(U.language)?U.language:"en";return`${this.env.docsUrl}/user-guide.${t}.md`}},methods:{translate:He}},Tl={class:"tify-help",tabindex:"0"},bl={class:"tify-sr-only"},El=["innerHTML"],Pl=["href"],Sl=["href"],Cl=["href"],Rl=["href"],Hl={class:"tify-help-footer"},Ll=["innerHTML"];function Dl(t,r,e,i,n,s){return D(),k("section",Tl,[F("h2",bl,X(s.translate("Help")),1),F("h3",null,X(s.translate("About TIFY")),1),F("p",{innerHTML:s.infoHtml},null,8,El),F("ul",null,[F("li",null,[F("a",{href:s.userGuideUrl},X(s.translate("User guide")),9,Pl)]),F("li",null,[F("a",{href:s.env.repositoryUrl},X(s.translate("Source code")),9,Sl)]),F("li",null,[F("a",{href:s.env.contributorsUrl},X(s.translate("Contributors")),9,Cl)]),F("li",null,[F("a",{href:s.env.bugsUrl},X(s.translate("Report a bug")),9,Rl)])]),F("footer",Hl,[F("p",null,[Pe(X(s.translate("Version"))+" ",1),F("b",null,X(s.env.version),1),Pe(" Â· "),F("span",{innerHTML:s.copyrightHtml},null,8,Ll)])])])}const Ml=ce(xl,[["render",Dl]]),Ol={},kl={class:"tify-icon",viewBox:"0 0 24 24"},Fl=F("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},null,-1),Al=[Fl];function Bl(t,r){return D(),k("svg",kl,Al)}const Hr=ce(Ol,[["render",Bl]]),Il={},zl={class:"tify-icon",viewBox:"0 0 24 24"},Nl=F("path",{d:"M19,13H5V11H19V13Z"},null,-1),Vl=[Nl];function Ul(t,r){return D(),k("svg",zl,Vl)}const Lr=ce(Il,[["render",Ul]]),Wl=`tify-${Math.floor(Math.random()*Date.now())}`;function Nt(t){return Wl+(t?`-${t}`:"")}var mn={},jl={get exports(){return mn},set exports(t){mn=t}};(function(t){(function(r){if(typeof e!="function"){var e=function(x){return x};e.nonNative=!0}const i=e("plaintext"),n=e("html"),s=e("comment"),l=/<(\w*)>/g,o=/<\/?([^\s\/>]+)/;function a(x,P,S){x=x||"",P=P||[],S=S||"";let O=h(P,S);return g(x,O)}function c(x,P){x=x||[],P=P||"";let S=h(x,P);return function(d){return g(d||"",S)}}a.init_streaming_mode=c;function h(x,P){return x=m(x),{allowable_tags:x,tag_replacement:P,state:i,tag_buffer:"",depth:0,in_quote_char:""}}function g(x,P){if(typeof x!="string")throw new TypeError("'html' parameter must be a string");let S=P.allowable_tags,O=P.tag_replacement,d=P.state,w=P.tag_buffer,H=P.depth,M=P.in_quote_char,I="";for(let V=0,q=x.length;V<q;V++){let K=x[V];if(d===i)switch(K){case"<":d=n,w+=K;break;default:I+=K;break}else if(d===n)switch(K){case"<":if(M)break;H++;break;case">":if(M)break;if(H){H--;break}M="",d=i,w+=">",S.has(b(w))?I+=w:I+=O,w="";break;case'"':case"'":K===M?M="":M=M||K,w+=K;break;case"-":w==="<!-"&&(d=s),w+=K;break;case" ":case`
`:if(w==="<"){d=i,I+="< ",w="";break}w+=K;break;default:w+=K;break}else if(d===s)switch(K){case">":w.slice(-2)=="--"&&(d=i),w="";break;default:w+=K;break}}return P.state=d,P.tag_buffer=w,P.depth=H,P.in_quote_char=M,I}function m(x){let P=new Set;if(typeof x=="string"){let S;for(;S=l.exec(x);)P.add(S[1])}else!e.nonNative&&typeof x[e.iterator]=="function"?P=new Set(x):typeof x.forEach=="function"&&x.forEach(P.add,P);return P}function b(x){let P=o.exec(x);return P?P[1].toLowerCase():null}t.exports?t.exports=a:r.striptags=a})(zn)})(jl);const Gl=mn;function xt(t){const r=["a","b","br","i","img","p","span"],e={a:["href"],img:["alt","src"]};let i=Gl(t,r);const n=/<(\w+)((\s+.+?(\s*=\s*(?:".*?"|'.*?'|.*?|[\^'">\s]+))?)+\s*|\s*)>/g;return i=i.replace(n,(s,l,o)=>{if(!o)return`<${l}>`;const a=/(?:([^\s]+)=(?:"(.*?)"|'(.*?)'))|([^\s]+)/g,c=[];return o.replace(a,(h,g)=>{h!==g&&e[l]&&e[l].indexOf(g)>-1&&c.push(h)}),c.length>0?`<${l} ${c.join(" ")}>`:`<${l}>`}),i}function ke(t){if(!U.language)throw new Error("language not set");if(!(t instanceof Array)){if(typeof t=="object"){if(t["@value"])return[xt(t["@value"])];if(t["@id"]){const n=xt(t["@id"]);return[{"@id":n,label:t.label?xt(t.label):n}]}return["(Invalid value)"]}return[xt(t)]}const r=[],e={};t.forEach(n=>{typeof n=="string"||n["@id"]&&n.label?r.push(n):n&&typeof n!="object"?r.push(xt(n)):n["@language"]&&n["@value"]&&(e.fallback||(e.fallback=n["@value"]),n["@language"].indexOf("en")===0?e.en=n["@value"]:U.language&&n["@language"]===U.language&&(e.preferred=n["@value"]))});const i=e.preferred||e.en||e.fallback||null;return i&&r.push(xt(i)),r}function hi(t,r){return U.pageLabelFormat.replace("P",t).replace("L",r)}function Nn(t,r={}){let e,i;const n=new Promise((s,l)=>{e=s,i=l});return di(t).then(async s=>{if(r.expectedType&&s["@type"]!==r.expectedType)return it(`Expected manifest of type ${r.expectedType}, but got ${s["@type"]}`),i(Hi),n;if(Ts(null),await er(),s["@type"]==="sc:Manifest")return Ts(s),gn(),window.addEventListener("popstate",gn),r.reset&&Ce({childManifestUrl:t,pages:[fn()],pan:{},rotation:null,view:zt()?"scan":"collection",zoom:null}),e(),n;if(s["@type"]==="sc:Collection"){wl(s);const l=new URLSearchParams(window.location.search);let o={};try{o=JSON.parse(l.get(U.urlQueryKey))||{}}catch{}let a="";if(U.urlQueryParams.includes("childManifestUrl")&&o.childManifestUrl?a=o.childManifestUrl:Fe.manifests&&U.childManifestAutoloaded&&(a=Fe.manifests[0]["@id"]),a)await Nn(a,{expectedType:"sc:Manifest"}),Ce({childManifestUrl:a});else{const c=o.view||U.view;Ce({view:["collection","help","info"].includes(c)?c:"collection"})}return e(),n}return it("Please provide a valid IIIF Presentation API 2.x manifest"),i(Hi),n},s=>{const l=s.response&&(s.response.statusText||s.response.data)||s.message;return it(`Error loading IIIF manifest: ${l}`),i(s),n})}const ql={name:"CollectionNode",props:{item:{type:Object,default:()=>{}}},data(){return{children:null,expanded:!1,id:Nt(`collection-node-${Math.floor(Math.random()*1e12)}`),manifest:me}},computed:{label(){return this.item.label?ke(this.item.label).join(`${String.fromCharCode(160)}Â· `):""}},methods:{loadManifest:Nn,toggleChildren(){if(this.expanded){this.expanded=!1;return}if(this.children){this.expanded=!0;return}if(this.item.children){this.children=this.item.children,this.expanded=!0;return}di(this.item["@id"]).then(t=>{this.children=t.manifests||t.collections||[],this.expanded=!0},t=>{const r=t.response&&(t.response.statusText||t.response.data)||t.message;it(`Error loading IIIF manifest: ${r}`),this.children=!1})},translate:He}},Zl=["aria-controls","aria-expanded"],Kl={class:"tify-sr-only"},Xl={class:"tify-sr-only"},Yl=["id"],Jl={key:1,class:"tify-collection-error"};function Ql(t,r,e,i,n,s){const l=Lr,o=Hr,a=dr("collection-node",!0);return D(),k("li",{class:Ee(["tify-collection-item",{"-current":n.manifest["@id"]===e.item["@id"]}])},[e.item["@type"]==="sc:Collection"?(D(),k("button",{key:0,type:"button","aria-controls":n.id,"aria-expanded":n.expanded?"true":"false",class:"tify-collection-link -has-children",onClick:r[0]||(r[0]=c=>s.toggleChildren())},[n.expanded?(D(),k(pe,{key:0},[ie(l),F("span",Kl,X(s.translate("Collapse")),1)],64)):(D(),k(pe,{key:1},[ie(o),F("span",Xl,X(s.translate("Expand")),1)],64)),Pe(" "+X(s.label),1)],8,Zl)):(D(),k("a",{key:1,href:"javascript:;",class:"tify-collection-link",onClick:r[1]||(r[1]=c=>s.loadManifest(e.item["@id"],{expectedType:e.item["@type"],reset:!0},this))},X(s.label),1)),n.expanded?(D(),k(pe,{key:2},[n.expanded?(D(),k("ol",{key:0,id:n.id,class:"tify-collection-list"},[(D(!0),k(pe,null,Le(n.children,c=>(D(),Be(a,{key:c["@id"],item:c},null,8,["item"]))),128))],8,Yl)):n.children===!1?(D(),k("p",Jl,X(s.translate("Could not load child manifest")),1)):re("",!0)],64)):re("",!0)],2)}const $l=ce(ql,[["render",Ql]]),ec={data(){return{filter:""}},computed:{filteredItems(){const t=this.filter.trim().toLowerCase().split(/\s+/);return this.items.filter(r=>{const e=r.label.toLowerCase();return t.every(i=>e.includes(i))})},items(){return Fe.manifests&&Fe.collections?[{"@id":"tify-collection-manifests","@type":"sc:Collection",label:He("Documents"),children:Fe.manifests},{"@id":"tify-collection-collections","@type":"sc:Collection",label:He("Collections"),children:Fe.collections}]:Fe.manifests||Fe.collections}},methods:{translate:He}},tc={class:"tify-collection",tabindex:"0"},ic={class:"tify-sr-only"},nc={key:0,class:"tify-collection-controls"},sc=["aria-label","placeholder"],rc=["disabled"],oc={key:1,class:"tify-collection-list"},ac={key:2,class:"tify-collection-no-results"};function lc(t,r,e,i,n,s){const l=$l;return D(),k("section",tc,[F("h2",ic,X(s.translate("Collection")),1),s.items.length>5?(D(),k("p",nc,[Ne(F("input",{"onUpdate:modelValue":r[0]||(r[0]=o=>n.filter=o),"aria-label":s.translate("Filter collection"),class:"tify-collection-filter",placeholder:s.translate("Filter collection"),type:"text",onKeydown:[r[1]||(r[1]=ii(Ot(o=>n.filter?n.filter="":o.target.blur(),["prevent"]),["esc"])),r[2]||(r[2]=Ot(()=>{},["stop"]))]},null,40,sc),[[Sr,n.filter]]),F("button",{type:"button",class:"tify-collection-reset",disabled:!n.filter,onClick:r[3]||(r[3]=o=>n.filter="")},X(s.translate("Reset")),9,rc)])):re("",!0),s.filteredItems.length?(D(),k("ol",oc,[(D(!0),k(pe,null,Le(s.filteredItems,o=>(D(),Be(l,{key:o["@id"],item:o},null,8,["item"]))),128))])):(D(),k("p",ac,X(s.translate("No results")),1))])}const cc=ce(ec,[["render",lc]]),uc={},hc={class:"tify-icon",viewBox:"0 0 24 24"},dc=F("path",{d:"M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"},null,-1),fc=[dc];function pc(t,r){return D(),k("svg",hc,fc)}const gc=ce(uc,[["render",pc]]),mc={},vc={class:"tify-icon",viewBox:"0 0 24 24"},yc=F("path",{d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},null,-1),wc=[yc];function _c(t,r){return D(),k("svg",vc,wc)}const xc=ce(mc,[["render",_c]]);function Vn(t,r=["https:","http:"]){let e;try{e=new URL(t)}catch{return!1}return r.includes(e.protocol)}const Tc={props:{metadata:{type:Array,default:()=>[]}},data(){return{infoItems:[]}},watch:{metadata(){this.updateInfoItems()}},mounted(){this.updateInfoItems()},methods:{cleanLabel(t){const r=t.replace("_"," ");return r.charAt(0).toUpperCase()+r.substr(1)},convertValueToArray:ke,updateInfoItems(){this.$nextTick(()=>{this.$refs.contents&&this.$refs.contents.forEach((t,r)=>{const e=t.offsetHeight;this.infoItems[r]={collapsed:!0,exceedsHeight:!0},this.$nextTick(()=>{const i=t.offsetHeight,n=e>=i;this.infoItems[r]={collapsed:n,exceedsHeight:n}})})})},isValidUrl:Vn,translate:He}},bc={class:"tify-info-metadata"},Ec={class:"tify-info-value"},Pc=["href"],Sc=["innerHTML"],Cc=["onClick"];function Rc(t,r,e,i,n,s){const l=xc,o=gc;return D(),k("div",bc,[(D(!0),k(pe,null,Le(e.metadata,(a,c)=>(D(),k("div",{key:c},[F("h4",null,[(D(!0),k(pe,null,Le(s.convertValueToArray(a.label),(h,g)=>(D(),k("div",{key:g},X(s.cleanLabel(h)),1))),128))]),F("div",{ref_for:!0,ref:"contents",class:Ee(["tify-info-content",{"-collapsed":n.infoItems[c]&&n.infoItems[c].collapsed}])},[F("div",Ec,[(D(!0),k(pe,null,Le(s.convertValueToArray(a.value),h=>(D(),k(pe,null,[s.isValidUrl(h)?(D(),k("div",{key:"url-"+h},[F("a",{href:h},X(h),9,Pc)])):(D(),k("div",{key:"html-"+h,innerHTML:h},null,8,Sc))],64))),256))]),n.infoItems[c]&&n.infoItems[c].exceedsHeight?(D(),k("button",{key:0,type:"button",class:"tify-info-toggle",onClick:h=>n.infoItems[c].collapsed=!n.infoItems[c].collapsed},[n.infoItems[c].collapsed?(D(),k(pe,{key:0},[ie(l),Pe(" "+X(s.translate("Expand")),1)],64)):(D(),k(pe,{key:1},[ie(o),Pe(" "+X(s.translate("Collapse")),1)],64))],8,Cc)):re("",!0)],2)]))),128))])}const Hc=ce(Tc,[["render",Rc]]),Un=ht(()=>{if(!me||!Array.isArray(me.structures))return!1;const t=[];U.pages.forEach(n=>{n&&t.push(me.sequences[0].canvases[n-1]["@id"])});const{length:r}=me.structures;let e,i;for(let n=0;n<r;n+=1){const s=me.structures[n],{canvases:l}=s;if(l&&l.some(o=>t.indexOf(o)>-1)&&s.firstPage&&s.lastPage){const o=s.lastPage-s.firstPage;if((o<i||!i)&&(e=n,i=o,i===0))break}}return typeof e=="number"&&e>=0?me.structures[e]:!1}),Lc=ht(()=>{const{label:t}=Un.value;return t}),Dc=ht(()=>{const{metadata:t}=Un.value;return t}),Ei=ht(()=>{if(!me.structures)return[];const t=[],r=[],{canvases:e}=me.sequences[0],{length:i}=me.structures;for(let l=0;l<i;l+=1){const o=me.structures[l];if(o.viewingHint!=="top"){if(o.label?o.label=ke(o.label)[0].trim():o.label="â",o.canvases){const a=o.canvases[0];o.firstPage=e.findIndex(g=>g["@id"]===a)+1;const c=o.canvases[o.canvases.length-1];o.lastPage=e.findIndex(g=>g["@id"]===c)+1;const h=e[o.firstPage-1];if(!h)continue;o.pageLabel=h.label}else e[0]&&(o.firstPage=1,o.lastPage=ct.value,o.pageLabel=e[0].label);o.pageCount=o.lastPage-o.firstPage+1,o.within&&r.push(o),t.push(o)}}const n=r.length;for(let l=0;l<i;l+=1){const o=[];for(let a=0;a<n;a+=1){const c=r[a];c.within===t[l]["@id"]&&o.push(c)}o.length&&(t[l].childStructures=o.sort((a,c)=>a.firstPage-c.firstPage))}return t.filter(l=>!l.within).sort((l,o)=>l.firstPage-o.firstPage)}),Mc={data(){return{currentStructure:Un,currentStructureLabel:Lc,currentStructureMetadata:Dc,collectionDataShown:!1,options:U}},computed:{collection(){return Fe},license(){return me.license?ke(this.manifest.license):[]},logoId(){return me.logo["@id"]||me.logo},manifest(){return this.collectionDataShown?Fe:me||Fe},related(){return me.related?ke(me.related):[]}},methods:{convertValueToArray:ke,isValidUrl:Vn,translate:He}},Oc={class:"tify-info",tabindex:"0"},kc={class:"tify-sr-only"},Fc={key:0,class:"tify-info-header"},Ac={key:1,class:"tify-info-section -title"},Bc={class:"tify-info-heading"},Ic={key:2,class:"tify-info-section -metadata"},zc={key:3,class:"tify-info-section -metadata -structure"},Nc={key:0,class:"tify-info-structure"},Vc={key:4,class:"tify-info-section -description"},Uc=["innerHTML"],Wc={key:5,class:"tify-info-section -license"},jc=["href"],Gc=["href"],qc={key:6,class:"tify-info-section -related"},Zc=["href"],Kc=["href"],Xc={key:7,class:"tify-info-section -attribution"},Yc=["innerHTML"],Jc={key:8,class:"tify-info-section -logo"},Qc=["href"],$c=["src","alt"],eu=["src","alt"];function tu(t,r,e,i,n,s){const l=Hc;return D(),k("section",Oc,[F("h2",kc,X(s.translate("Info")),1),s.collection["@id"]&&s.manifest["@id"]?(D(),k("div",Fc,[F("button",{type:"button",class:Ee(["tify-info-button",{"-active":!n.collectionDataShown}]),onClick:r[0]||(r[0]=o=>n.collectionDataShown=!1)},X(s.translate("Document")),3),F("button",{type:"button",class:Ee(["tify-info-button",{"-active":n.collectionDataShown}]),onClick:r[1]||(r[1]=o=>n.collectionDataShown=!0)},X(s.translate("Collection")),3)])):re("",!0),s.manifest.label?(D(),k("div",Ac,[F("h3",Bc,X(s.translate("Title")),1),(D(!0),k(pe,null,Le(s.convertValueToArray(s.manifest.label),o=>(D(),k("div",{key:o},X(o),1))),128))])):re("",!0),s.manifest.metadata&&s.manifest.metadata.length?(D(),k("div",Ic,[F("h3",null,X(s.translate("Metadata")),1),n.options.view==="info"?(D(),Be(l,{key:0,metadata:s.manifest.metadata},null,8,["metadata"])):re("",!0)])):re("",!0),s.manifest.structures&&(n.currentStructureLabel||n.currentStructureMetadata)?(D(),k("div",zc,[F("h3",null,X(s.translate("Current Element")),1),n.currentStructureLabel?(D(),k("p",Nc,X(n.currentStructureLabel),1)):re("",!0),n.options.view==="info"&&n.currentStructureMetadata?(D(),Be(l,{key:1,class:"tify-info-section -metadata",metadata:n.currentStructureMetadata},null,8,["metadata"])):re("",!0)])):re("",!0),s.manifest.description?(D(),k("div",Vc,[F("h3",null,X(s.translate("Description")),1),(D(!0),k(pe,null,Le(s.convertValueToArray(s.manifest.description),(o,a)=>(D(),k("div",{key:a,innerHTML:o},null,8,Uc))),128))])):re("",!0),s.license.length?(D(),k("div",Wc,[F("h3",null,X(s.translate("License")),1),(D(!0),k(pe,null,Le(s.license,(o,a)=>(D(),k("div",{key:a},[typeof o=="string"?(D(),k(pe,{key:0},[s.isValidUrl(o)?(D(),k("a",{key:0,href:o},X(o),9,jc)):(D(),k(pe,{key:1},[Pe(X(o),1)],64))],64)):(D(),k(pe,{key:1},[s.isValidUrl(o["@id"])?(D(),k("a",{key:0,href:o["@id"]},X(o.label||o["@id"]),9,Gc)):(D(),k(pe,{key:1},[Pe(X(o.label||o["@id"]),1)],64))],64))]))),128))])):re("",!0),s.related.length?(D(),k("div",qc,[F("h3",null,X(s.translate("Related Resources")),1),(D(!0),k(pe,null,Le(s.related,(o,a)=>(D(),k("div",{key:a},[typeof o=="string"?(D(),k("a",{key:0,href:o},X(o),9,Zc)):(D(),k("a",{key:1,href:o["@id"]},X(o.label||o["@id"]),9,Kc))]))),128))])):re("",!0),s.manifest.attribution?(D(),k("div",Xc,[F("h3",null,X(s.translate("Provided by")),1),(D(!0),k(pe,null,Le(s.convertValueToArray(s.manifest.attribution),(o,a)=>(D(),k("div",{key:a,innerHTML:o},null,8,Yc))),128))])):re("",!0),s.manifest.logo?(D(),k("div",Jc,[s.logoId&&s.manifest.logo.service&&s.manifest.logo.service["@id"]?(D(),k("a",{key:0,href:s.manifest.logo.service["@id"]},[F("img",{class:"tify-info-logo",src:s.logoId,alt:s.translate("Logo")},null,8,$c)],8,Qc)):(D(),k("img",{key:1,class:"tify-info-logo",src:s.logoId,alt:s.translate("Logo")},null,8,eu))])):re("",!0)])}const iu=ce(Mc,[["render",tu]]),Dr=ht(()=>{if(!U.pages)return!1;const{pages:t}=U;return t.length>2||t.length===2&&(t[0]%2>0||t[1]!==t[0]+1)&&t[1]>0});function ut(t){let r=t;if(Array.isArray(t)||(r=[t]),!Rr(r))throw new RangeError("Invalid pages");if(r.length===1&&U.pages&&U.pages[0]%2<1&&(U.pages[1]===U.pages[0]+1||U.pages[1]===0)){const e=r[0]%2>0?r[0]-1:r[0];r=[e,e===ct.value?0:e+1]}return Ce({pages:r}),r}const Mr=ht(()=>U.pages[0]<2),Or=ht(()=>{const{pages:t}=U;return t[0]>=ct.value||t[t.length-1]>=ct.value});function Ss(){ut(1)}function vn(){const{pages:t}=U;let r=t[0]+1;t.length>1&&r%2>0&&r<ct.value&&(r+=1),ut(r)}function Cs(){ut(ct.value)}function yn(){const{pages:t}=U;let r=t[0]-1;t.length>1&&r%2>0&&r>0&&(r-=1),ut(r)}const nu={name:"TocList",props:{level:{type:Number,default:0},structures:{type:Array,default:()=>[]},parentStructure:{type:Object,default:()=>{}},purpose:{type:String,default:""}},data(){return{expandedStructures:[],id:Nt(`toc-list-${Math.floor(Math.random()*1e12)}`)}},methods:{checkIfPagesInStructure(t){const{pages:r}=U;return r.some(e=>e>=t.firstPage&&e<=t.lastPage)},convertValueToArray:ke,setPage(t){ut(t),zt()&&Ce({view:"scan"})},toggleAllChildren(t=null){if(this.$refs.children){for(let r=this.structures.length-1;r>=0;r-=1)this.toggleChildren(r,t);this.$refs.children.forEach(r=>{r.toggleAllChildren(t)})}},toggleChildren(t,r=null){this.structures[t].childStructures&&(this.expandedStructures[t]=r!==null?r:!this.expandedStructures[t])},translate:He}},su={class:"tify-toc-list"},ru=["data-level"],ou=["title","aria-controls","aria-expanded","onClick"],au=["href"],lu=["onClick"],cu={class:"tify-toc-label"},uu={class:"tify-toc-page"};function hu(t,r,e,i,n,s){const l=Lr,o=Hr,a=dr("toc-list",!0);return D(),k("ul",su,[(D(!0),k(pe,null,Le(e.structures,(c,h)=>(D(),k("li",{key:h,class:Ee(["tify-toc-structure",{"-current":s.checkIfPagesInStructure(c),"-expanded":n.expandedStructures[h]}]),"data-level":e.level},[c.childStructures?(D(),k("button",{key:0,type:"button",class:"tify-toc-toggle",title:s.translate(n.expandedStructures[h]?"Collapse":"Expand"),"aria-controls":`${n.id}-${h}`,"aria-expanded":n.expandedStructures[h]?"true":"false",onClick:g=>s.toggleChildren(h)},[n.expandedStructures[h]?(D(),Be(l,{key:0})):(D(),Be(o,{key:1}))],8,ou)):re("",!0),e.purpose==="pdf"?(D(),k("a",{key:1,class:"tify-toc-link",download:"",href:s.convertValueToArray(c.rendering)[0]["@id"]},X(c.label)+" ("+X(c.pageCount)+"Â "+X(s.translate(c.pageCount===1?"page":"pages"))+") ",9,au)):(D(),k("a",{key:2,class:"tify-toc-link -dots",href:"javascript:;",onClick:g=>s.setPage(c.firstPage)},[F("span",cu,X(c.label),1),F("span",uu,X(c.pageLabel),1)],8,lu)),c.childStructures?Ne((D(),Be(a,{key:3,id:`${n.id}-${h}`,ref_for:!0,ref:"children",level:e.level+1,"parent-structure":c,purpose:e.purpose,structures:c.childStructures},null,8,["id","level","parent-structure","purpose","structures"])),[[rt,n.expandedStructures[h]]]):re("",!0)],10,ru))),128))])}const kr=ce(nu,[["render",hu]]),du=[{label:"BibTex",profile:"http://www.bibtex.org/Format/",type:"literature"},{label:"EndNote",profile:"http://endnote.com/",type:"literature"},{label:"RIS",profile:"http://referencemanager.com/sites/rm/files/m/direct_export_ris.pdf",type:"literature"},{label:"METS",profile:"http://www.loc.gov/standards/mets/profile_docs/mets.profile.v2-0.xsd",type:"other"},{label:"MODS",format:"application/mods+xml",type:"other"}],fu={data(){return{collection:Fe,literatureItems:[],manifest:me,options:U,otherItems:[],perElementPdfLinksVisible:!1,structures:Ei}},computed:{canvases(){return Ge.value},pages(){return U.pages.filter(t=>t>0)},hasElementPdfLinks(){return!Array.isArray(me.structures)||!me.structures[0]||!me.structures[0].rendering?!1:ke(me.structures[0].rendering).some(r=>r.format&&r.format==="application/pdf")},imageUrls(){const t={};return U.pages.forEach(r=>{if(!r)return;const{resource:e}=this.canvases[r-1].images[0];if(e.service){const i=e.service["@context"]==="http://iiif.io/api/image/2/context.json"?"default":"native",n=e.service["@id"];t[r]=`${n}${n.slice(-1)==="/"?"":"/"}full/full/0/${i}.jpg`}else t[r]=e["@id"]}),t},renderings(){return ke(me.rendering)}},created(){const{seeAlso:t}=me;if(!t)return;JSON.parse(JSON.stringify(Array.isArray(t)?t:[t])).forEach(e=>{const i=typeof e=="object"?e:{"@id":e};let n=!1;du.some(s=>{const l=e.format&&s.format===e.format,o=e.profile&&s.profile===e.profile;return l||o?(i.label=s.label,s.type==="literature"&&(n=!0),!0):!1}),n?this.literatureItems.push(i):this.otherItems.push(i)})},methods:{convertValueToArray:ke,getId:Nt,getPageLabel:hi,translate:He}},pu={class:"tify-export",tabindex:"0"},gu={class:"tify-sr-only"},mu={class:"tify-export-section -links"},vu=["href","download"],yu={key:0,class:"tify-export-section -renderings"},wu=["href"],_u={key:0,class:"tify-export-container"},xu=["aria-controls","aria-expanded"],Tu={class:"tify-sr-only"},bu=["id"],Eu={key:1,class:"tify-export-section -literature"},Pu=["href"],Su={class:"tify-export-section -other"},Cu={key:0},Ru=["href"],Hu=["href"],Lu=["href"];function Du(t,r,e,i,n,s){const l=Cr,o=kr;return D(),k("section",pu,[F("h2",gu,X(s.translate("Export")),1),F("div",mu,[F("h3",null,X(s.translate("Download Individual Images")),1),F("ul",null,[(D(!0),k(pe,null,Le(s.pages,a=>(D(),k("li",{key:a},[F("a",{href:s.imageUrls[a],download:`${a}.jpg`},X(s.translate("Page"))+" "+X(s.getPageLabel(a,s.convertValueToArray(s.canvases[a-1].label)[0])),9,vu)]))),128))])]),n.manifest.rendering?(D(),k("div",yu,[F("h3",null,X(s.translate("Renderings")),1),F("ul",null,[(D(!0),k(pe,null,Le(s.renderings,a=>(D(),k("li",{key:a["@id"]},[F("a",{href:a["@id"]},X(a.label),9,wu)]))),128))]),s.hasElementPdfLinks?(D(),k("div",_u,[F("button",{type:"button",class:Ee(["tify-export-toggle",{"-close":n.perElementPdfLinksVisible}]),"aria-controls":s.getId("export-pdf-list"),"aria-expanded":n.perElementPdfLinksVisible?"true":"false",onClick:r[0]||(r[0]=a=>n.perElementPdfLinksVisible=!n.perElementPdfLinksVisible)},[n.perElementPdfLinksVisible?(D(),k(pe,{key:1},[ie(l),F("span",Tu,X(s.translate("Close PDF list")),1)],64)):(D(),k(pe,{key:0},[Pe(X(s.translate("PDFs for each element")),1)],64))],10,xu),n.perElementPdfLinksVisible?(D(),k("div",{key:0,id:s.getId("export-pdf-list"),class:"tify-export-toc"},[F("h4",null,X(s.translate("PDFs for each element")),1),ie(o,{ref:"children",purpose:"pdf",level:0,structures:n.structures},null,8,["structures"])],8,bu)):re("",!0)])):re("",!0)])):re("",!0),n.literatureItems.length?(D(),k("div",Eu,[F("h3",null,X(s.translate("Literature Management")),1),F("ul",null,[(D(!0),k(pe,null,Le(n.literatureItems,a=>(D(),k("li",{key:a["@id"]},[F("a",{href:a["@id"],download:""},X(a.label),9,Pu)]))),128))])])):re("",!0),F("div",Su,[F("h3",null,X(s.translate("Other Formats")),1),F("ul",null,[n.options.childManifestUrl?(D(),k("li",Cu,[F("a",{href:n.options.childManifestUrl,download:"manifest.json"},X(s.translate("IIIF manifest (current document)")),9,Ru)])):re("",!0),F("li",null,[F("a",{href:n.options.manifestUrl,download:"manifest.json"},X(s.translate(n.collection?"IIIF manifest (collection)":"IIIF manifest")),9,Hu)]),(D(!0),k(pe,null,Le(n.otherItems,a=>(D(),k("li",{key:a["@id"]},[F("a",{href:a["@id"],download:""},X(a.label||a["@id"]),9,Lu)]))),128))])])])}const Mu=ce(fu,[["render",Du]]),Rs=".tify-toc-structure.-current",Ou={data(){return{isInited:!1,options:U,structures:Ei}},computed:{hasChildStructures(){return Ei.value&&Ei.value.some(t=>t.childStructures)}},watch:{"options.pages":function(){this.$nextTick(()=>pn(Rs,this.$el))},"options.view":{handler(t){t==="toc"&&this.$nextTick(this.init)},immediate:!0}},methods:{init(){this.isInited=!0,this.$nextTick(()=>pn(Rs,this.$el,!1))},translate:He}},ku={class:"tify-toc",tabindex:"0"},Fu={class:"tify-sr-only"},Au={key:0,class:"tify-toc-header"};function Bu(t,r,e,i,n,s){const l=kr;return D(),k("section",ku,[F("h2",Fu,X(s.translate("Table of Contents")),1),s.hasChildStructures?(D(),k("div",Au,[F("button",{type:"button",class:"tify-toc-toggle-all",onClick:r[0]||(r[0]=o=>t.$refs.children.toggleAllChildren(!0))},X(s.translate("Expand all")),1),F("button",{type:"button",class:"tify-toc-toggle-all",onClick:r[1]||(r[1]=o=>t.$refs.children.toggleAllChildren(!1))},X(s.translate("Collapse all")),1)])):re("",!0),n.isInited?(D(),Be(l,{key:1,ref:"children",level:0,structures:n.structures},null,8,["structures"])):re("",!0)])}const Iu=ce(Ou,[["render",Bu]]),zu=750,Nu={data(){return{isInited:!1,itemHeight:0,itemVMargin:0,items:[{label:""}],itemsPerRow:0,knownImages:[],lastScrollTop:0,options:U,resizeTimeout:null,style:{},thumbnailWidth:0,touchTimeout:null}},watch:{"options.pages":function(t){this.$nextTick(()=>{const r=".tify-thumbnails-item.-current";t.length>2||t.length>1&&t[1]!==t[0]+1||(this.$refs.container.querySelector(r)?pn(r,this.$el):this.scrollToCurrentPage())})},"options.view":{handler(t){t==="thumbnails"&&this.$nextTick(this.init)},immediate:!0}},mounted(){this.style.flex=this.$el.style.flex},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{getPageLabel:hi,init(){this.updateDimensions(),this.scrollToCurrentPage(!1),this.isInited||(window.addEventListener("resize",this.onResize),this.isInited=!0)},onResize(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{U.view==="thumbnails"&&this.updateDimensions()},200)},updateDimensions(){const t=this.$refs.container.querySelector(".tify-thumbnails-item"),r=t.currentStyle||window.getComputedStyle(t),e=parseInt(r.marginTop,10)+parseFloat(r.marginBottom,10);this.itemHeight=t.offsetHeight+e,this.itemVerticalMargin=e;const i=parseInt(r.marginLeft,10)+parseFloat(r.marginRight,10),n=t.offsetWidth+i;this.thumbnailWidth=t.offsetWidth,this.itemsPerRow=Math.floor(this.$refs.container.clientWidth/n);const l=Math.ceil(Ge.value.length/this.itemsPerRow)*this.itemHeight;this.$refs.container.style.height=`${l}px`,this.redrawThumbnails(),this.scrollToCurrentPage(!1)},redrawThumbnails(){const t=this.$el.scrollTop,r=Math.floor(t/this.itemHeight)*this.itemsPerRow+1,i=Math.ceil(this.$el.offsetHeight/this.itemHeight)*this.itemsPerRow,n=r+this.itemsPerRow+i,s=Math.min(Ge.value.length,n),l=[];for(let o=r-1;o<s;o+=1){const{resource:a}=Ge.value[o].images[0];if(a.service){const c=a.service["@context"]==="http://iiif.io/api/image/2/context.json"?"default":"native",h=a.service["@id"];l.push({label:ke(Ge.value[o].label)[0],imgUrl:`${h}${h.slice(-1)==="/"?"":"/"}full/${this.thumbnailWidth},/0/${c}.jpg`,page:o+1})}else l.push({label:ke(Ge.value[o].label)[0],imgUrl:a["@id"],page:o+1})}this.items=l,this.$nextTick(()=>{const o=Math.floor(r/this.itemsPerRow);this.$refs.container.style.paddingTop=`${o*this.itemHeight}px`})},scrollToCurrentPage(t=!0){const e=Math.floor((U.pages[0]-1)/this.itemsPerRow)*this.itemHeight+(this.itemVMargin-50);t?Li(this.$el,e):this.$el.scrollTop=e},setPageAndSwitchView(t,r=!1){if(r){const e=U.pages.slice(0),i=e.indexOf(t);i<0?(e.push(t),e.sort((n,s)=>n-s),e[0]===0&&e.shift()):e.length>1&&e.splice(i,1),Ce({pages:e});return}ut(t),zt()&&Ce({view:"scan"})},touchStartTogglePage(t){this.lastScrollTop=this.$el.scrollTop,this.touchTimeout=setTimeout(()=>{this.$el.scrollTop===this.lastScrollTop&&this.setPageAndSwitchView(t,!0)},zu)},touchEnd(){clearTimeout(this.touchTimeout)},translate:He}},Vu={class:"tify-sr-only"},Uu={ref:"container",class:"tify-thumbnails-list"},Wu=["onClick","onTouchstart"],ju=["src"],Gu={class:"tify-thumbnails-page"};function qu(t,r,e,i,n,s){return D(),k("section",{class:"tify-thumbnails",tabindex:"0",onScroll:r[1]||(r[1]=(...l)=>s.redrawThumbnails&&s.redrawThumbnails(...l))},[F("h2",Vu,X(s.translate("Pages")),1),F("div",Uu,[(D(!0),k(pe,null,Le(n.items,l=>(D(),k("a",{key:l.page,class:Ee(["tify-thumbnails-item",{"-current":n.options.pages.indexOf(l.page)>-1}]),href:"javascript:;",onClick:Ot(o=>s.setPageAndSwitchView(l.page,o.ctrlKey),["prevent"]),onTouchstart:o=>s.touchStartTogglePage(l.page),onTouchend:r[0]||(r[0]=(...o)=>s.touchEnd&&s.touchEnd(...o))},[F("img",{alt:"",src:l.imgUrl},null,8,ju),F("span",Gu,X(s.getPageLabel(l.page,l.label)),1)],42,Wu))),128))],512)],32)}const Zu=ce(Nu,[["render",qu]]),Ku={data(){return{canvases:Ge,fulltextAvailable:!1,fulltexts:[],options:U}},computed:{pages(){return U.pages.filter(t=>!!t)}},watch:{"options.pages":function(){this.loadFulltexts()}},mounted(){this.loadFulltexts()},methods:{getPageLabel:hi,loadFulltexts(){this.fulltextAvailable=!1,this.fulltexts=[],U.pages.forEach(t=>{if(t<1||this.fulltexts[t])return;const r=me.sequences[0].canvases[t-1];if(!("otherContent"in r))return;const e=r.otherContent[0]["@id"];di(e).then(i=>{const{resources:n}=i;Array.isArray(n)&&n.forEach((s,l)=>{const o=s.resource;if(o)if(this.fulltexts[t]||(this.fulltexts[t]=[]),o&&o.chars){const a=xt(o.chars);a&&(this.fulltextAvailable=!0),this.fulltexts[t][l]=a}else o["@id"]&&this.loadRemoteFulltext(t,l,o["@id"])})},i=>{const n=i.response?i.response.statusText:i.message;console.warn(`Could not load annotations: ${n}`)})})},loadRemoteFulltext(t,r,e){Vn(e)&&_l(e).then(i=>{const n=xt(i);n&&(this.fulltextAvailable=!0),this.fulltexts[t]||(this.fulltexts[t]=[]),this.fulltexts[t][r]=n},i=>{const n=i.response?i.response.statusText:i.message;console.warn(`Could not load fulltext: ${n}`)})},translate:He}},Xu={class:"tify-fulltext",tabindex:"0"},Yu={class:"tify-sr-only"},Ju={key:0,class:"tify-fulltext-texts"},Qu=["innerHTML"],$u={key:1,class:"tify-fulltext-none"};function eh(t,r,e,i,n,s){return D(),k("section",Xu,[F("h2",Yu,X(s.translate("Fulltext")),1),n.fulltextAvailable?(D(),k("div",Ju,[(D(!0),k(pe,null,Le(s.pages,l=>(D(),k("div",{key:l,class:"tify-fulltext-page"},[F("h3",null,X(s.translate("Page"))+" "+X(s.getPageLabel(l,n.canvases[l-1].label)),1),(D(!0),k(pe,null,Le(n.fulltexts[l],(o,a)=>(D(),k("div",{key:`${l}-${a}`,class:"tify-fulltext-text",innerHTML:o},null,8,Qu))),128))]))),128))])):(D(),k("div",$u,X(s.translate("Fulltext not available for this page")),1))])}const th=ce(Ku,[["render",eh]]),ih={},nh={class:"tify-icon",viewBox:"0 0 24 24"},sh=F("path",{d:"M12,3A9,9 0 0,0 3,12H0L4,16L8,12H5A7,7 0 0,1 12,5A7,7 0 0,1 19,12A7,7 0 0,1 12,19C10.5,19 9.09,18.5 7.94,17.7L6.5,19.14C8.04,20.3 9.94,21 12,21A9,9 0 0,0 21,12A9,9 0 0,0 12,3M14,12A2,2 0 0,0 12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12Z"},null,-1),rh=[sh];function oh(t,r){return D(),k("svg",nh,rh)}const ah=ce(ih,[["render",oh]]),lh={},ch={class:"tify-icon",viewBox:"0 0 24 24"},uh=F("path",{d:"M17.5,12A1.5,1.5 0 0,1 16,10.5A1.5,1.5 0 0,1 17.5,9A1.5,1.5 0 0,1 19,10.5A1.5,1.5 0 0,1 17.5,12M14.5,8A1.5,1.5 0 0,1 13,6.5A1.5,1.5 0 0,1 14.5,5A1.5,1.5 0 0,1 16,6.5A1.5,1.5 0 0,1 14.5,8M9.5,8A1.5,1.5 0 0,1 8,6.5A1.5,1.5 0 0,1 9.5,5A1.5,1.5 0 0,1 11,6.5A1.5,1.5 0 0,1 9.5,8M6.5,12A1.5,1.5 0 0,1 5,10.5A1.5,1.5 0 0,1 6.5,9A1.5,1.5 0 0,1 8,10.5A1.5,1.5 0 0,1 6.5,12M12,3A9,9 0 0,0 3,12A9,9 0 0,0 12,21A1.5,1.5 0 0,0 13.5,19.5C13.5,19.11 13.35,18.76 13.11,18.5C12.88,18.23 12.73,17.88 12.73,17.5A1.5,1.5 0 0,1 14.23,16H16A5,5 0 0,0 21,11C21,6.58 16.97,3 12,3Z"},null,-1),hh=[uh];function dh(t,r){return D(),k("svg",ch,hh)}const fh=ce(lh,[["render",dh]]),ph={},gh={class:"tify-icon",viewBox:"0 0 24 24"},mh=F("path",{d:"M12,18V6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,15.31L23.31,12L20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31Z"},null,-1),vh=[mh];function yh(t,r){return D(),k("svg",gh,vh)}const wh=ce(ph,[["render",yh]]),_h={},xh={class:"tify-icon",viewBox:"0 0 24 24"},Th=F("path",{d:"M3.55 19.09L4.96 20.5L6.76 18.71L5.34 17.29M12 6C8.69 6 6 8.69 6 12S8.69 18 12 18 18 15.31 18 12C18 8.68 15.31 6 12 6M20 13H23V11H20M17.24 18.71L19.04 20.5L20.45 19.09L18.66 17.29M20.45 5L19.04 3.6L17.24 5.39L18.66 6.81M13 1H11V4H13M6.76 5.39L4.96 3.6L3.55 5L5.34 6.81L6.76 5.39M1 13H4V11H1M13 20H11V23H13"},null,-1),bh=[Th];function Eh(t,r){return D(),k("svg",xh,bh)}const Ph=ce(_h,[["render",Eh]]),Sh={},Ch={class:"tify-icon",viewBox:"0 0 24 24"},Rh=F("path",{d:"M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"},null,-1),Hh=[Rh];function Lh(t,r){return D(),k("svg",Ch,Hh)}const Dh=ce(Sh,[["render",Lh]]),Mh={},Oh={class:"tify-icon",viewBox:"0 0 24 24"},kh=F("path",{d:"M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,5.55Z"},null,-1),Fh=[kh];function Ah(t,r){return D(),k("svg",Oh,Fh)}const Bh=ce(Mh,[["render",Ah]]),Ih={},zh={class:"tify-icon",viewBox:"0 0 24 24"},Nh=F("path",{d:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M5,8V10H13V8H5Z"},null,-1),Vh=[Nh];function Uh(t,r){return D(),k("svg",zh,Vh)}const Wh=ce(Ih,[["render",Uh]]),jh={},Gh={class:"tify-icon",viewBox:"0 0 24 24"},qh=F("path",{d:"M19,12H17V15H14V17H19V12M7,9H10V7H5V12H7V9M21,3H3A2,2 0 0,0 1,5V19A2,2 0 0,0 3,21H21A2,2 0 0,0 23,19V5A2,2 0 0,0 21,3M21,19H3V5H21V19Z"},null,-1),Zh=[qh];function Kh(t,r){return D(),k("svg",Gh,Zh)}const Xh=ce(jh,[["render",Kh]]),Yh={},Jh={class:"tify-icon",viewBox:"0 0 24 24"},Qh=F("path",{d:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M8,5V8H5V10H8V13H10V10H13V8H10V5H8Z"},null,-1),$h=[Qh];function ed(t,r){return D(),k("svg",Jh,$h)}const td=ce(Yh,[["render",ed]]),id={},nd={class:"tify-icon",viewBox:"0 0 24 24"},sd=F("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},null,-1),rd=[sd];function od(t,r){return D(),k("svg",nd,rd)}const Fr=ce(id,[["render",od]]),ad={},ld={class:"tify-icon",viewBox:"0 0 24 24"},cd=F("path",{d:"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"},null,-1),ud=[cd];function hd(t,r){return D(),k("svg",ld,ud)}const Ar=ce(ad,[["render",hd]]);var wn={},dd={get exports(){return wn},set exports(t){wn=t}};(function(t){//! openseadragon 3.0.0
//! Built on 2021-12-15
//! Git commit: v3.0.0-0-3eded36
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function r(e){return new r.Viewer(e)}(function(e){e.version={versionStr:"3.0.0",major:parseInt("3",10),minor:parseInt("0",10),revision:parseInt("0",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,s=Object.prototype.hasOwnProperty;e.isFunction=function(l){return e.type(l)==="function"},e.isArray=Array.isArray||function(l){return e.type(l)==="array"},e.isWindow=function(l){return l&&typeof l=="object"&&"setInterval"in l},e.type=function(l){return l==null?String(l):i[n.call(l)]||"object"},e.isPlainObject=function(l){if(!l||r.type(l)!=="object"||l.nodeType||e.isWindow(l)||l.constructor&&!s.call(l,"constructor")&&!s.call(l.constructor.prototype,"isPrototypeOf"))return!1;var o;for(var a in l)o=a;return o===void 0||s.call(l,o)},e.isEmptyObject=function(l){for(var o in l)return!1;return!0},e.freezeObject=function(l){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(o){return o},e.freezeObject(l)},e.supportsCanvas=function(){var l=document.createElement("canvas");return!!(e.isFunction(l.getContext)&&l.getContext("2d"))}(),e.isCanvasTainted=function(l){var o=!1;try{l.getContext("2d").getImageData(0,0,1,1)}catch{o=!0}return o},e.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),e.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),e.supportsEventListenerOptions=function(){var l=0;if(e.supportsAddEventListener)try{var o={get capture(){return l++,!1},get once(){return l++,!1},get passive(){return l++,!1}};window.addEventListener("test",null,o),window.removeEventListener("test",null,o)}catch{l=0}return l>=3}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var l=document.createElement("canvas").getContext("2d"),o=window.devicePixelRatio||1,a=l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1;return Math.max(o,1)/a}else return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(r),function(e){e.extend=function(){var a,c,h,g,m,b,x=arguments[0]||{},P=arguments.length,S=!1,O=1;for(typeof x=="boolean"&&(S=x,x=arguments[1]||{},O=2),typeof x!="object"&&!r.isFunction(x)&&(x={}),P===O&&(x=this,--O);O<P;O++)if(a=arguments[O],a!==null||a!==void 0)for(c in a)h=x[c],g=a[c],x!==g&&(S&&g&&(r.isPlainObject(g)||(m=r.isArray(g)))?(m?(m=!1,b=h&&r.isArray(h)?h:[]):b=h&&r.isPlainObject(h)?h:{},x[c]=r.extend(S,b,g)):g!==void 0&&(x[c]=g));return x};var i=function(){if(typeof navigator!="object")return!1;var a=navigator.userAgent;return typeof a!="string"?!1:a.indexOf("iPhone")!==-1||a.indexOf("iPad")!==-1||a.indexOf("iPod")!==-1};e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(a,c){return function(){var h=arguments;return h===void 0&&(h=[]),c.apply(a,h)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},_viewers:new Map,getViewer:function(a){return e._viewers.get(this.getElement(a))},getElement:function(a){return typeof a=="string"&&(a=document.getElementById(a)),a},getElementPosition:function(a){var c=new e.Point,h,g;for(a=e.getElement(a),h=e.getElementStyle(a).position==="fixed",g=o(a,h);g;)c.x+=a.offsetLeft,c.y+=a.offsetTop,h&&(c=c.plus(e.getPageScroll())),a=g,h=e.getElementStyle(a).position==="fixed",g=o(a,h);return c},getElementOffset:function(a){a=e.getElement(a);var c=a&&a.ownerDocument,h,g,m={top:0,left:0};return c?(h=c.documentElement,typeof a.getBoundingClientRect<"u"&&(m=a.getBoundingClientRect()),g=c===c.window?c:c.nodeType===9?c.defaultView||c.parentWindow:!1,new e.Point(m.left+(g.pageXOffset||h.scrollLeft)-(h.clientLeft||0),m.top+(g.pageYOffset||h.scrollTop)-(h.clientTop||0))):new e.Point},getElementSize:function(a){return a=e.getElement(a),new e.Point(a.clientWidth,a.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(a){return a=e.getElement(a),a.currentStyle}:function(a){return a=e.getElement(a),window.getComputedStyle(a,"")},getCssPropertyWithVendorPrefix:function(a){var c={};return e.getCssPropertyWithVendorPrefix=function(h){if(c[h]!==void 0)return c[h];var g=document.createElement("div").style,m=null;if(g[h]!==void 0)m=h;else for(var b=["Webkit","Moz","MS","O","webkit","moz","ms","o"],x=e.capitalizeFirstLetter(h),P=0;P<b.length;P++){var S=b[P]+x;if(g[S]!==void 0){m=S;break}}return c[h]=m,m},e.getCssPropertyWithVendorPrefix(a)},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},positiveModulo:function(a,c){var h=a%c;return h<0&&(h+=c),h},pointInElement:function(a,c){a=e.getElement(a);var h=e.getElementOffset(a),g=e.getElementSize(a);return c.x>=h.x&&c.x<h.x+g.x&&c.y<h.y+g.y&&c.y>=h.y},getMousePosition:function(a){if(typeof a.pageX=="number")e.getMousePosition=function(c){var h=new e.Point;return h.x=c.pageX,h.y=c.pageY,h};else if(typeof a.clientX=="number")e.getMousePosition=function(c){var h=new e.Point;return h.x=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,h.y=c.clientY+document.body.scrollTop+document.documentElement.scrollTop,h};else throw new Error("Unknown event mouse position, no known technique.");return e.getMousePosition(a)},getPageScroll:function(){var a=document.documentElement||{},c=document.body||{};if(typeof window.pageXOffset=="number")e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(c.scrollLeft||c.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else if(a.scrollLeft||a.scrollTop)e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new e.Point(0,0);return e.getPageScroll()},setPageScroll:function(a){if(typeof window.scrollTo<"u")e.setPageScroll=function(g){window.scrollTo(g.x,g.y)};else{var c=e.getPageScroll();if(c.x===a.x&&c.y===a.y)return;document.body.scrollLeft=a.x,document.body.scrollTop=a.y;var h=e.getPageScroll();if(h.x!==c.x&&h.y!==c.y){e.setPageScroll=function(g){document.body.scrollLeft=g.x,document.body.scrollTop=g.y};return}if(document.documentElement.scrollLeft=a.x,document.documentElement.scrollTop=a.y,h=e.getPageScroll(),h.x!==c.x&&h.y!==c.y){e.setPageScroll=function(g){document.documentElement.scrollLeft=g.x,document.documentElement.scrollTop=g.y};return}e.setPageScroll=function(g){}}e.setPageScroll(a)},getWindowSize:function(){var a=document.documentElement||{},c=document.body||{};if(typeof window.innerWidth=="number")e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(a.clientWidth||a.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(c.clientWidth||c.clientHeight)e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return e.getWindowSize()},makeCenteredNode:function(a){a=e.getElement(a);var c=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(c[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(c[1].style,{display:"table-row"}),e.extend(c[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),c[0].appendChild(c[1]),c[1].appendChild(c[2]),c[2].appendChild(a),c[0]},makeNeutralElement:function(a){var c=document.createElement(a),h=c.style;return h.background="transparent none",h.border="none",h.margin="0px",h.padding="0px",h.position="static",c},now:function(){return Date.now?e.now=Date.now:e.now=function(){return new Date().getTime()},e.now()},makeTransparentImage:function(a){var c=e.makeNeutralElement("img");return c.src=a,c},setElementOpacity:function(a,c,h){var g,m;a=e.getElement(a),h&&!e.Browser.alpha&&(c=Math.round(c)),e.Browser.opacity?a.style.opacity=c<1?c:"":c<1?(g=Math.round(100*c),m="alpha(opacity="+g+")",a.style.filter=m):a.style.filter=""},setElementTouchActionNone:function(a){a=e.getElement(a),typeof a.style.touchAction<"u"?a.style.touchAction="none":typeof a.style.msTouchAction<"u"&&(a.style.msTouchAction="none")},setElementPointerEvents:function(a,c){a=e.getElement(a),typeof a.style.pointerEvents<"u"&&(a.style.pointerEvents=c)},setElementPointerEventsNone:function(a){e.setElementPointerEvents(a,"none")},addClass:function(a,c){a=e.getElement(a),a.className?(" "+a.className+" ").indexOf(" "+c+" ")===-1&&(a.className+=" "+c):a.className=c},indexOf:function(a,c,h){return Array.prototype.indexOf?this.indexOf=function(g,m,b){return g.indexOf(m,b)}:this.indexOf=function(g,m,b){var x,P=b||0,S;if(!g)throw new TypeError;if(S=g.length,S===0||P>=S)return-1;for(P<0&&(P=S-Math.abs(P)),x=P;x<S;x++)if(g[x]===m)return x;return-1},this.indexOf(a,c,h)},removeClass:function(a,c){var h,g=[],m;for(a=e.getElement(a),h=a.className.split(/\s+/),m=0;m<h.length;m++)h[m]&&h[m]!==c&&g.push(h[m]);a.className=g.join(" ")},normalizeEventListenerOptions:function(a){var c;return typeof a<"u"?typeof a=="boolean"?c=e.supportsEventListenerOptions?{capture:a}:a:c=e.supportsEventListenerOptions?a:typeof a.capture<"u"?a.capture:!1:c=e.supportsEventListenerOptions?{capture:!1}:!1,c},addEvent:function(){if(e.supportsAddEventListener)return function(a,c,h,g){g=e.normalizeEventListenerOptions(g),a=e.getElement(a),a.addEventListener(c,h,g)};if(document.documentElement.attachEvent&&document.attachEvent)return function(a,c,h){a=e.getElement(a),a.attachEvent("on"+c,h)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(a,c,h,g){g=e.normalizeEventListenerOptions(g),a=e.getElement(a),a.removeEventListener(c,h,g)};if(document.documentElement.detachEvent&&document.detachEvent)return function(a,c,h){a=e.getElement(a),a.detachEvent("on"+c,h)};throw new Error("No known event model.")}(),cancelEvent:function(a){a.preventDefault()},eventIsCanceled:function(a){return a.defaultPrevented},stopEvent:function(a){a.stopPropagation()},createCallback:function(a,c){var h=[],g;for(g=2;g<arguments.length;g++)h.push(arguments[g]);return function(){var m=h.concat([]),b;for(b=0;b<arguments.length;b++)m.push(arguments[b]);return c.apply(a,m)}},getUrlParameter:function(a){var c=l[a];return c||null},getUrlProtocol:function(a){var c=a.match(/^([a-z]+:)\/\//i);return c===null?window.location.protocol:c[1].toLowerCase()},createAjaxRequest:function(a){var c;try{c=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{c=!1}if(c)window.XMLHttpRequest?e.createAjaxRequest=function(h){return h?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:e.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)e.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return e.createAjaxRequest(a)},makeAjaxRequest:function(a,c,h){var g,m,b;e.isPlainObject(a)&&(c=a.success,h=a.error,g=a.withCredentials,m=a.headers,b=a.responseType||null,a=a.url);var x=e.getUrlProtocol(a),P=e.createAjaxRequest(x==="file:");if(!e.isFunction(c))throw new Error("makeAjaxRequest requires a success callback");P.onreadystatechange=function(){P.readyState===4&&(P.onreadystatechange=function(){},P.status>=200&&P.status<300||P.status===0&&x!=="http:"&&x!=="https:"?c(P):(e.console.log("AJAX request returned %d: %s",P.status,a),e.isFunction(h)&&h(P)))};try{if(P.open("GET",a,!0),b&&(P.responseType=b),m)for(var S in m)Object.prototype.hasOwnProperty.call(m,S)&&m[S]&&P.setRequestHeader(S,m[S]);g&&(P.withCredentials=!0),P.send(null)}catch(O){e.console.log("%s while making AJAX request: %s",O.name,O.message),P.onreadystatechange=function(){},e.isFunction(h)&&h(P,O)}return P},jsonp:function(a){var c,h=a.url,g=document.head||document.getElementsByTagName("head")[0]||document.documentElement,m=a.callbackName||"openseadragon"+e.now(),b=window[m],x="$1"+m+"$2",P=a.param||"callback",S=a.callback;h=h.replace(/(=)\?(&|$)|\?\?/i,x),h+=(/\?/.test(h)?"&":"?")+P+"="+m,window[m]=function(O){if(b)window[m]=b;else try{delete window[m]}catch{}S&&e.isFunction(S)&&S(O)},c=document.createElement("script"),(a.async!==void 0||a.async!==!1)&&(c.async="async"),a.scriptCharset&&(c.charset=a.scriptCharset),c.src=h,c.onload=c.onreadystatechange=function(O,d){(d||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,g&&c.parentNode&&g.removeChild(c),c=void 0)},g.insertBefore(c,g.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(a){if(window.DOMParser)e.parseXml=function(c){var h=null,g;return g=new DOMParser,h=g.parseFromString(c,"text/xml"),h};else if(window.ActiveXObject)e.parseXml=function(c){var h=null;return h=new ActiveXObject("Microsoft.XMLDOM"),h.async=!1,h.loadXML(c),h};else throw new Error("Browser doesn't support XML DOM.");return e.parseXml(a)},parseJSON:function(a){return e.parseJSON=window.JSON.parse,e.parseJSON(a)},imageFormatSupported:function(a){return a=a||"",!!s[a.toLowerCase()]},setImageFormatsSupported:function(a){e.extend(s,a)}});var n=function(a){};e.console=window.console||{log:n,debug:n,info:n,warn:n,error:n,assert:n},e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var s={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},l={};(function(){var a=navigator.appVersion,c=navigator.userAgent,h;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(c.substring(c.indexOf("MSIE")+5,c.indexOf(";",c.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(c.indexOf("Edge")>=0?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(c.substring(c.indexOf("Edge")+5))):c.indexOf("Edg")>=0?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(c.substring(c.indexOf("Edg")+4))):c.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(c.substring(c.indexOf("Firefox")+8))):c.indexOf("Safari")>=0?(e.Browser.vendor=c.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(c.substring(c.substring(0,c.indexOf("Safari")).lastIndexOf("/")+1,c.indexOf("Safari")))):(h=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),h.exec(c)!==null&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(a);break}var g=window.location.search.substring(1),m=g.split("&"),b,x,P;for(P=0;P<m.length;P++)if(b=m[P],x=b.indexOf("="),x>0){var S=b.substring(0,x),O=b.substring(x+1);try{l[S]=decodeURIComponent(O)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",S,O)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<11&&e.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(a){var c=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,h=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame;if(c&&h)e.requestAnimationFrame=function(){return c.apply(a,arguments)},e.cancelAnimationFrame=function(){return h.apply(a,arguments)};else{var g=[],m=[],b=0,x;e.requestAnimationFrame=function(P){return g.push([++b,P]),x||(x=setInterval(function(){if(g.length){var S=e.now(),O=m;for(m=g,g=O;m.length;)m.shift()[1](S)}else clearInterval(x),x=void 0},1e3/50)),b},e.cancelAnimationFrame=function(P){var S,O;for(S=0,O=g.length;S<O;S+=1)if(g[S][0]===P){g.splice(S,1);return}for(S=0,O=m.length;S<O;S+=1)if(m[S][0]===P){m.splice(S,1);return}}}}(window);function o(a,c){return c&&a!==document.body?document.body:a.offsetParent}}(r),function(e,i){t.exports?t.exports=i():e.OpenSeadragon=i()}(zn,function(){return r}),function(e){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(n){return n.requestFullscreen()},i.exitFullScreen=function(){document.exitFullscreen()},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(n){return n.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(n){return n.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},e.extend(e,i)}(r),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(i,n,s,l){var o=this;l=l||1;var a=0,c=function(h){a++,a===l&&o.removeHandler(i,c),n(h)};this.addHandler(i,c,s)},addHandler:function(i,n,s){var l=this.events[i];l||(this.events[i]=l=[]),n&&e.isFunction(n)&&(l[l.length]={handler:n,userData:s||null})},removeHandler:function(i,n){var s=this.events[i],l=[],o;if(s&&e.isArray(s)){for(o=0;o<s.length;o++)s[o].handler!==n&&l.push(s[o]);this.events[i]=l}},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var n in this.events)this.events[n]=[]},getHandler:function(i){var n=this.events[i];return!n||!n.length?null:(n=n.length===1?[n[0]]:Array.apply(null,n),function(s,l){var o,a=n.length;for(o=0;o<a;o++)n[o]&&(l.eventSource=s,l.userData=n[o].userData,n[o].handler(l))})},raiseEvent:function(i,n){var s=this.getHandler(i);s&&(n||(n={}),s(this,n))}}}(r),function(e){var i={};e.MouseTracker=function(p){var f=arguments;e.isPlainObject(p)||(p={element:f[0],clickTimeThreshold:f[1],clickDistThreshold:f[2]}),this.hash=Math.random(),this.element=e.getElement(p.element),this.clickTimeThreshold=p.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=p.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=p.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=p.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=p.userData||null,this.stopDelay=p.stopDelay||50,this.preProcessEventHandler=p.preProcessEventHandler||null,this.contextMenuHandler=p.contextMenuHandler||null,this.enterHandler=p.enterHandler||null,this.leaveHandler=p.leaveHandler||null,this.exitHandler=p.exitHandler||null,this.overHandler=p.overHandler||null,this.outHandler=p.outHandler||null,this.pressHandler=p.pressHandler||null,this.nonPrimaryPressHandler=p.nonPrimaryPressHandler||null,this.releaseHandler=p.releaseHandler||null,this.nonPrimaryReleaseHandler=p.nonPrimaryReleaseHandler||null,this.moveHandler=p.moveHandler||null,this.scrollHandler=p.scrollHandler||null,this.clickHandler=p.clickHandler||null,this.dblClickHandler=p.dblClickHandler||null,this.dragHandler=p.dragHandler||null,this.dragEndHandler=p.dragEndHandler||null,this.pinchHandler=p.pinchHandler||null,this.stopHandler=p.stopHandler||null,this.keyDownHandler=p.keyDownHandler||null,this.keyUpHandler=p.keyUpHandler||null,this.keyHandler=p.keyHandler||null,this.focusHandler=p.focusHandler||null,this.blurHandler=p.blurHandler||null;var y=this;i[this.hash]={click:function(_){w(y,_)},dblclick:function(_){H(y,_)},keydown:function(_){M(y,_)},keyup:function(_){I(y,_)},keypress:function(_){V(y,_)},focus:function(_){q(y,_)},blur:function(_){K(y,_)},contextmenu:function(_){j(y,_)},wheel:function(_){oe(y,_)},mousewheel:function(_){te(y,_)},DOMMouseScroll:function(_){te(y,_)},MozMousePixelScroll:function(_){te(y,_)},losecapture:function(_){ue(y,_)},mouseenter:function(_){Pt(y,_)},mouseleave:function(_){mt(y,_)},mouseover:function(_){Vt(y,_)},mouseout:function(_){We(y,_)},mousedown:function(_){dt(y,_)},mouseup:function(_){St(y,_)},mousemove:function(_){yt(y,_)},touchstart:function(_){_e(y,_)},touchend:function(_){le(y,_)},touchmove:function(_){ae(y,_)},touchcancel:function(_){ne(y,_)},gesturestart:function(_){Te(y,_)},gesturechange:function(_){$(y,_)},gotpointercapture:function(_){Me(y,_)},lostpointercapture:function(_){Ue(y,_)},pointerenter:function(_){Pt(y,_)},pointerleave:function(_){mt(y,_)},pointerover:function(_){Vt(y,_)},pointerout:function(_){We(y,_)},pointerdown:function(_){dt(y,_)},pointerup:function(_){St(y,_)},pointermove:function(_){yt(y,_)},pointercancel:function(_){u(y,_)},pointerupcaptured:function(_){nt(y,_)},pointermovecaptured:function(_){E(y,_)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),p.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){a(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(p){return p?o(this):a(this),this},getActivePointersListByType:function(p){var f=i[this.hash],y,_=f.activePointersLists.length,z;for(y=0;y<_;y++)if(f.activePointersLists[y].type===p)return f.activePointersLists[y];return z=new e.MouseTracker.GesturePointList(p),f.activePointersLists.push(z),z},getActivePointerCount:function(){var p=i[this.hash],f,y=p.activePointersLists.length,_=0;for(f=0;f<y;f++)_+=p.activePointersLists[f].getLength();return _},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var n=function(){try{return window.self!==window.top}catch{return!0}}();function s(p){try{return p.addEventListener&&p.removeEventListener}catch{return!1}}e.MouseTracker.gesturePointVelocityTracker=function(){var p=[],f=0,y=0,_=function(ge,se){return ge.hash.toString()+se.type+se.id.toString()},z=function(){var ge,se=p.length,Ze,Oe,Ut=e.now(),jn,Gn,qn;for(jn=Ut-y,y=Ut,ge=0;ge<se;ge++)Ze=p[ge],Oe=Ze.gPoint,Oe.direction=Math.atan2(Oe.currentPos.y-Ze.lastPos.y,Oe.currentPos.x-Ze.lastPos.x),Gn=Ze.lastPos.distanceTo(Oe.currentPos),Ze.lastPos=Oe.currentPos,qn=1e3*Gn/(jn+1),Oe.speed=.75*qn+.25*Oe.speed},G=function(ge,se){var Ze=_(ge,se);p.push({guid:Ze,gPoint:se,lastPos:se.currentPos}),p.length===1&&(y=e.now(),f=window.setInterval(z,50))},ee=function(ge,se){var Ze=_(ge,se),Oe,Ut=p.length;for(Oe=0;Oe<Ut;Oe++)if(p[Oe].guid===Ze){p.splice(Oe,1),Ut--,Ut===0&&window.clearInterval(f);break}};return{addPoint:G,removePoint:ee}}(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],e.MouseTracker.wheelEventName==="DOMMouseScroll"&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=function(){var p=document.createElement("div");return e.isFunction(p.setPointerCapture)&&e.isFunction(p.releasePointerCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=function(){var p=document.createElement("div");return e.isFunction(p.setCapture)&&e.isFunction(p.releaseCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(p){this._gPoints=[],this.type=p,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(p){return this._gPoints.push(p)},removeById:function(p){var f,y=this._gPoints.length;for(f=0;f<y;f++)if(this._gPoints[f].id===p){this._gPoints.splice(f,1);break}return this._gPoints.length},getByIndex:function(p){return p<this._gPoints.length?this._gPoints[p]:null},getById:function(p){var f,y=this._gPoints.length;for(f=0;f<y;f++)if(this._gPoints[f].id===p)return this._gPoints[f];return null},getPrimary:function(p){var f,y=this._gPoints.length;for(f=0;f<y;f++)if(this._gPoints[f].isPrimary)return this._gPoints[f];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(e.console.warn("GesturePointList.removeContact() Implausible contacts value"),this.contacts=0)}};function l(p){var f=i[p.hash],y,_,z,G,ee,ge=f.activePointersLists.length;for(y=0;y<ge;y++)if(z=f.activePointersLists[y],z.getLength()>0){for(ee=[],G=z.asArray(),_=0;_<G.length;_++)ee.push(G[_]);for(_=0;_<ee.length;_++)T(p,z,ee[_])}for(y=0;y<ge;y++)f.activePointersLists.pop();f.sentDragEvent=!1}function o(p){var f=i[p.hash],y,_;if(!f.tracking){for(_=0;_<e.MouseTracker.subscribeEvents.length;_++)y=e.MouseTracker.subscribeEvents[_],e.addEvent(p.element,y,f[y],y===e.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);l(p),f.tracking=!0}}function a(p){var f=i[p.hash],y,_;if(f.tracking){for(_=0;_<e.MouseTracker.subscribeEvents.length;_++)y=e.MouseTracker.subscribeEvents[_],e.removeEvent(p.element,y,f[y],!1);l(p),f.tracking=!1}}function c(p,f){var y=i[p.hash];if(f==="pointerevent")return{upName:"pointerup",upHandler:y.pointerupcaptured,moveName:"pointermove",moveHandler:y.pointermovecaptured};if(f==="mouse")return{upName:"pointerup",upHandler:y.pointerupcaptured,moveName:"pointermove",moveHandler:y.pointermovecaptured};if(f==="touch")return{upName:"touchend",upHandler:y.touchendcaptured,moveName:"touchmove",moveHandler:y.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function h(p,f){var y;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{p.element.setPointerCapture(f.id)}catch{e.console.warn("setPointerCapture() called on invalid pointer ID");return}else p.element.setCapture(!0);else y=c(p,e.MouseTracker.havePointerEvents?"pointerevent":f.type),n&&s(window.top)&&e.addEvent(window.top,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.moveName,y.moveHandler,!0);B(p,f,!0)}function g(p,f){var y,_,z;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(_=p.getActivePointersListByType(f.type),z=_.getById(f.id),!z||!z.captured)return;try{p.element.releasePointerCapture(f.id)}catch{}}else p.element.releaseCapture();else y=c(p,e.MouseTracker.havePointerEvents?"pointerevent":f.type),n&&s(window.top)&&e.removeEvent(window.top,y.upName,y.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,y.moveName,y.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,y.upName,y.upHandler,!0);B(p,f,!1)}function m(p){return e.MouseTracker.havePointerEvents?p.pointerId:e.MouseTracker.mousePointerId}function b(p){return e.MouseTracker.havePointerEvents?p.pointerType||(e.Browser.vendor===e.BROWSERS.IE?"mouse":""):"mouse"}function x(p){return e.MouseTracker.havePointerEvents?p.isPrimary:!0}function P(p){return e.getMousePosition(p)}function S(p,f){return O(P(p),f)}function O(p,f){var y=e.getElementOffset(f);return p.minus(y)}function d(p,f){return new e.Point((p.x+f.x)/2,(p.y+f.y)/2)}function w(p,f){var y={originalEvent:f,eventType:"click",pointerType:"mouse",isEmulated:!1};R(p,y),y.preventDefault&&!y.defaultPrevented&&e.cancelEvent(f),y.stopPropagation&&e.stopEvent(f)}function H(p,f){var y={originalEvent:f,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};R(p,y),y.preventDefault&&!y.defaultPrevented&&e.cancelEvent(f),y.stopPropagation&&e.stopEvent(f)}function M(p,f){var y=null,_={originalEvent:f,eventType:"keydown",pointerType:"",isEmulated:!1};R(p,_),p.keyDownHandler&&!_.preventGesture&&!_.defaultPrevented&&(y={eventSource:p,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefault:_.preventDefault||_.defaultPrevented,userData:p.userData},p.keyDownHandler(y)),(y&&y.preventDefault||_.preventDefault&&!_.defaultPrevented)&&e.cancelEvent(f),_.stopPropagation&&e.stopEvent(f)}function I(p,f){var y=null,_={originalEvent:f,eventType:"keyup",pointerType:"",isEmulated:!1};R(p,_),p.keyUpHandler&&!_.preventGesture&&!_.defaultPrevented&&(y={eventSource:p,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefault:_.preventDefault||_.defaultPrevented,userData:p.userData},p.keyUpHandler(y)),(y&&y.preventDefault||_.preventDefault&&!_.defaultPrevented)&&e.cancelEvent(f),_.stopPropagation&&e.stopEvent(f)}function V(p,f){var y=null,_={originalEvent:f,eventType:"keypress",pointerType:"",isEmulated:!1};R(p,_),p.keyHandler&&!_.preventGesture&&!_.defaultPrevented&&(y={eventSource:p,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefault:_.preventDefault||_.defaultPrevented,userData:p.userData},p.keyHandler(y)),(y&&y.preventDefault||_.preventDefault&&!_.defaultPrevented)&&e.cancelEvent(f),_.stopPropagation&&e.stopEvent(f)}function q(p,f){var y={originalEvent:f,eventType:"focus",pointerType:"",isEmulated:!1};R(p,y),p.focusHandler&&!y.preventGesture&&p.focusHandler({eventSource:p,originalEvent:f,userData:p.userData})}function K(p,f){var y={originalEvent:f,eventType:"blur",pointerType:"",isEmulated:!1};R(p,y),p.blurHandler&&!y.preventGesture&&p.blurHandler({eventSource:p,originalEvent:f,userData:p.userData})}function j(p,f){var y=null,_={originalEvent:f,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};R(p,_),p.contextMenuHandler&&!_.preventGesture&&!_.defaultPrevented&&(y={eventSource:p,position:O(P(f),p.element),originalEvent:_.originalEvent,preventDefault:_.preventDefault||_.defaultPrevented,userData:p.userData},p.contextMenuHandler(y)),(y&&y.preventDefault||_.preventDefault&&!_.defaultPrevented)&&e.cancelEvent(f),_.stopPropagation&&e.stopEvent(f)}function oe(p,f){fe(p,f,f)}function te(p,f){var y={target:f.target||f.srcElement,type:"wheel",shiftKey:f.shiftKey||!1,clientX:f.clientX,clientY:f.clientY,pageX:f.pageX?f.pageX:f.clientX,pageY:f.pageY?f.pageY:f.clientY,deltaMode:f.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};e.MouseTracker.wheelEventName==="mousewheel"?y.deltaY=-f.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:y.deltaY=f.detail,fe(p,y,f)}function fe(p,f,y){var _=0,z,G=null;_=f.deltaY<0?1:-1,z={originalEvent:f,eventType:"wheel",pointerType:"mouse",isEmulated:f!==y},R(p,z),p.scrollHandler&&!z.preventGesture&&!z.defaultPrevented&&(G={eventSource:p,pointerType:"mouse",position:S(f,p.element),scroll:_,shift:f.shiftKey,isTouchEvent:!1,originalEvent:y,preventDefault:z.preventDefault||z.defaultPrevented,userData:p.userData},p.scrollHandler(G)),z.stopPropagation&&e.stopEvent(y),(G&&G.preventDefault||z.preventDefault&&!z.defaultPrevented)&&e.cancelEvent(y)}function ue(p,f){var y={id:e.MouseTracker.mousePointerId,type:"mouse"},_={originalEvent:f,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};R(p,_),f.target===p.element&&B(p,y,!1),_.stopPropagation&&e.stopEvent(f)}function _e(p,f){var y,_,z=f.changedTouches.length,G,ee=p.getActivePointersListByType("touch");y=e.now(),ee.getLength()>f.touches.length-z&&e.console.warn("Tracked touch contact count doesn't match event.touches.length");var ge={originalEvent:f,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(R(p,ge),_=0;_<z;_++)G={id:f.changedTouches[_].identifier,type:"touch",isPrimary:ee.getLength()===0,currentPos:P(f.changedTouches[_]),currentTime:y},A(p,ge,G),W(p,ge,G,0),B(p,G,!0);ge.preventDefault&&!ge.defaultPrevented&&e.cancelEvent(f),ge.stopPropagation&&e.stopEvent(f)}function le(p,f){var y,_,z=f.changedTouches.length,G;y=e.now();var ee={originalEvent:f,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(R(p,ee),_=0;_<z;_++)G={id:f.changedTouches[_].identifier,type:"touch",currentPos:P(f.changedTouches[_]),currentTime:y},Q(p,ee,G,0),B(p,G,!1),N(p,ee,G);ee.preventDefault&&!ee.defaultPrevented&&e.cancelEvent(f),ee.stopPropagation&&e.stopEvent(f)}function ae(p,f){var y,_,z=f.changedTouches.length,G;y=e.now();var ee={originalEvent:f,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(R(p,ee),_=0;_<z;_++)G={id:f.changedTouches[_].identifier,type:"touch",currentPos:P(f.changedTouches[_]),currentTime:y},J(p,ee,G);ee.preventDefault&&!ee.defaultPrevented&&e.cancelEvent(f),ee.stopPropagation&&e.stopEvent(f)}function ne(p,f){var y=f.changedTouches.length,_,z,G={originalEvent:f,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(R(p,G),_=0;_<y;_++)z={id:f.changedTouches[_].identifier,type:"touch"},he(p,G,z);G.stopPropagation&&e.stopEvent(f)}function Te(p,f){return e.eventIsCanceled(f)||f.preventDefault(),!1}function $(p,f){return e.eventIsCanceled(f)||f.preventDefault(),!1}function Me(p,f){var y={originalEvent:f,eventType:"gotpointercapture",pointerType:b(f),isEmulated:!1};R(p,y),f.target===p.element&&B(p,{id:f.pointerId,type:b(f)},!0),y.stopPropagation&&e.stopEvent(f)}function Ue(p,f){var y={originalEvent:f,eventType:"lostpointercapture",pointerType:b(f),isEmulated:!1};R(p,y),f.target===p.element&&B(p,{id:f.pointerId,type:b(f)},!1),y.stopPropagation&&e.stopEvent(f)}function Pt(p,f){var y={id:m(f),type:b(f),isPrimary:x(f),currentPos:P(f),currentTime:e.now()},_={originalEvent:f,eventType:"pointerenter",pointerType:y.type,isEmulated:!1};R(p,_),A(p,_,y)}function mt(p,f){var y={id:m(f),type:b(f),isPrimary:x(f),currentPos:P(f),currentTime:e.now()},_={originalEvent:f,eventType:"pointerleave",pointerType:y.type,isEmulated:!1};R(p,_),N(p,_,y)}function Vt(p,f){var y={id:m(f),type:b(f),isPrimary:x(f),currentPos:P(f),currentTime:e.now()},_={originalEvent:f,eventType:"pointerover",pointerType:y.type,isEmulated:!1};R(p,_),Y(p,_,y),_.preventDefault&&!_.defaultPrevented&&e.cancelEvent(f),_.stopPropagation&&e.stopEvent(f)}function We(p,f){var y={id:m(f),type:b(f),isPrimary:x(f),currentPos:P(f),currentTime:e.now()},_={originalEvent:f,eventType:"pointerout",pointerType:y.type,isEmulated:!1};R(p,_),Z(p,_,y),_.preventDefault&&!_.defaultPrevented&&e.cancelEvent(f),_.stopPropagation&&e.stopEvent(f)}function dt(p,f){var y={id:m(f),type:b(f),isPrimary:x(f),currentPos:P(f),currentTime:e.now()},_=e.MouseTracker.havePointerEvents&&y.type==="touch"&&e.Browser.vendor!==e.BROWSERS.IE,z={originalEvent:f,eventType:"pointerdown",pointerType:y.type,isEmulated:!1};R(p,z),W(p,z,y,f.button),z.preventDefault&&!z.defaultPrevented&&e.cancelEvent(f),z.stopPropagation&&e.stopEvent(f),z.shouldCapture&&(_?B(p,y,!0):h(p,y))}function St(p,f){vt(p,f)}function nt(p,f){var y=p.getActivePointersListByType(b(f));y.getById(f.pointerId)&&vt(p,f),e.stopEvent(f)}function vt(p,f){var y;y={id:m(f),type:b(f),isPrimary:x(f),currentPos:P(f),currentTime:e.now()};var _={originalEvent:f,eventType:"pointerup",pointerType:y.type,isEmulated:!1};R(p,_),Q(p,_,y,f.button),_.preventDefault&&!_.defaultPrevented&&e.cancelEvent(f),_.stopPropagation&&e.stopEvent(f),_.shouldReleaseCapture&&(f.target===p.element?g(p,y):B(p,y,!1))}function yt(p,f){C(p,f)}function E(p,f){var y=p.getActivePointersListByType(b(f));y.getById(f.pointerId)&&C(p,f),e.stopEvent(f)}function C(p,f){var y={id:m(f),type:b(f),isPrimary:x(f),currentPos:P(f),currentTime:e.now()},_={originalEvent:f,eventType:"pointermove",pointerType:y.type,isEmulated:!1};R(p,_),J(p,_,y),_.preventDefault&&!_.defaultPrevented&&e.cancelEvent(f),_.stopPropagation&&e.stopEvent(f)}function u(p,f){var y={id:f.pointerId,type:b(f)},_={originalEvent:f,eventType:"pointercancel",pointerType:y.type,isEmulated:!1};R(p,_),he(p,_,y),_.stopPropagation&&e.stopEvent(f)}function v(p,f){return f.speed=0,f.direction=0,f.contactPos=f.currentPos,f.contactTime=f.currentTime,f.lastPos=f.currentPos,f.lastTime=f.currentTime,p.add(f)}function T(p,f,y){var _,z=f.getById(y.id);return z?(z.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),g(p,z)),(f.type==="mouse"||f.type==="pen")&&f.contacts>0&&f.removeContact(),_=f.removeById(y.id)):_=f.getLength(),_}function L(p,f){switch(f.eventType){case"pointermove":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasGestureHandlers,f.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!1,f.stopPropagation=!1;break;case"pointerdown":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasGestureHandlers,f.stopPropagation=!1;break;case"pointerup":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasGestureHandlers,f.stopPropagation=!1;break;case"wheel":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasScrollHandler,f.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":f.isStoppable=!0,f.isCancelable=!1,f.preventDefault=!1,f.preventGesture=!1,f.stopPropagation=!1;break;case"click":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!!p.clickHandler,f.preventGesture=!1,f.stopPropagation=!1;break;case"dblclick":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!!p.dblClickHandler,f.preventGesture=!1,f.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:f.isStoppable=!1,f.isCancelable=!1,f.preventDefault=!1,f.preventGesture=!1,f.stopPropagation=!1;break}}function R(p,f){f.eventSource=p,f.eventPhase=f.originalEvent&&typeof f.originalEvent.eventPhase<"u"?f.originalEvent.eventPhase:0,f.defaultPrevented=e.eventIsCanceled(f.originalEvent),f.shouldCapture=!1,f.shouldReleaseCapture=!1,f.userData=p.userData,L(p,f),p.preProcessEventHandler&&p.preProcessEventHandler(f)}function B(p,f,y){var _=p.getActivePointersListByType(f.type),z=_.getById(f.id);z?y&&!z.captured?(z.captured=!0,_.captureCount++):!y&&z.captured&&(z.captured=!1,_.captureCount--,_.captureCount<0&&(_.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function A(p,f,y){var _=p.getActivePointersListByType(y.type),z;z=_.getById(y.id),z?(z.insideElement=!0,z.lastPos=z.currentPos,z.lastTime=z.currentTime,z.currentPos=y.currentPos,z.currentTime=y.currentTime,y=z):(y.captured=!1,y.insideElementPressed=!1,y.insideElement=!0,v(_,y)),p.enterHandler&&p.enterHandler({eventSource:p,pointerType:y.type,position:O(y.currentPos,p.element),buttons:_.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:_.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData})}function N(p,f,y){var _=p.getActivePointersListByType(y.type),z,G;z=_.getById(y.id),z?(z.captured?(z.insideElement=!1,z.lastPos=z.currentPos,z.lastTime=z.currentTime,z.currentPos=y.currentPos,z.currentTime=y.currentTime):T(p,_,z),y=z):(y.captured=!1,y.insideElementPressed=!1),(p.leaveHandler||p.exitHandler)&&(G={eventSource:p,pointerType:y.type,position:y.currentPos&&O(y.currentPos,p.element),buttons:_.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:_.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData},p.leaveHandler&&p.leaveHandler(G),p.exitHandler&&p.exitHandler(G))}function Y(p,f,y){var _,z;_=p.getActivePointersListByType(y.type),z=_.getById(y.id),z?y=z:(y.captured=!1,y.insideElementPressed=!1),p.overHandler&&p.overHandler({eventSource:p,pointerType:y.type,position:O(y.currentPos,p.element),buttons:_.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:_.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData})}function Z(p,f,y){var _,z;_=p.getActivePointersListByType(y.type),z=_.getById(y.id),z?y=z:(y.captured=!1,y.insideElementPressed=!1),p.outHandler&&p.outHandler({eventSource:p,pointerType:y.type,position:y.currentPos&&O(y.currentPos,p.element),buttons:_.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:_.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData})}function W(p,f,y,_){var z=i[p.hash],G=p.getActivePointersListByType(y.type),ee;if(typeof f.originalEvent.buttons<"u"?G.buttons=f.originalEvent.buttons:_===0?G.buttons|=1:_===1?G.buttons|=4:_===2?G.buttons|=2:_===3?G.buttons|=8:_===4?G.buttons|=16:_===5&&(G.buttons|=32),_!==0){f.shouldCapture=!1,f.shouldReleaseCapture=!1,p.nonPrimaryPressHandler&&!f.preventGesture&&!f.defaultPrevented&&(f.preventDefault=!0,p.nonPrimaryPressHandler({eventSource:p,pointerType:y.type,position:O(y.currentPos,p.element),button:_,buttons:G.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}));return}if(ee=G.getById(y.id),ee)ee.insideElementPressed=!0,ee.insideElement=!0,ee.originalTarget=f.originalEvent.target,ee.contactPos=y.currentPos,ee.contactTime=y.currentTime,ee.lastPos=ee.currentPos,ee.lastTime=ee.currentTime,ee.currentPos=y.currentPos,ee.currentTime=y.currentTime,y=ee;else{e.console.warn("pointerdown event on untracked pointer"),y.captured=!1,y.insideElementPressed=!0,y.insideElement=!0,y.originalTarget=f.originalEvent.target,v(G,y);return}G.addContact(),!f.preventGesture&&!f.defaultPrevented?(f.shouldCapture=!0,f.shouldReleaseCapture=!1,f.preventDefault=!0,(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(p,y),G.contacts===1?p.pressHandler&&!f.preventGesture&&p.pressHandler({eventSource:p,pointerType:y.type,position:O(y.contactPos,p.element),buttons:G.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}):G.contacts===2&&p.pinchHandler&&y.type==="touch"&&(z.pinchGPoints=G.asArray(),z.lastPinchDist=z.currentPinchDist=z.pinchGPoints[0].currentPos.distanceTo(z.pinchGPoints[1].currentPos),z.lastPinchCenter=z.currentPinchCenter=d(z.pinchGPoints[0].currentPos,z.pinchGPoints[1].currentPos))):(f.shouldCapture=!1,f.shouldReleaseCapture=!1)}function Q(p,f,y,_){var z=i[p.hash],G=p.getActivePointersListByType(y.type),ee,ge,se,Ze=!1,Oe;if(typeof f.originalEvent.buttons<"u"?G.buttons=f.originalEvent.buttons:_===0?G.buttons^=-2:_===1?G.buttons^=-5:_===2?G.buttons^=-3:_===3?G.buttons^=-9:_===4?G.buttons^=-17:_===5&&(G.buttons^=-33),f.shouldCapture=!1,_!==0){f.shouldReleaseCapture=!1,p.nonPrimaryReleaseHandler&&!f.preventGesture&&!f.defaultPrevented&&(f.preventDefault=!0,p.nonPrimaryReleaseHandler({eventSource:p,pointerType:y.type,position:O(y.currentPos,p.element),button:_,buttons:G.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}));return}se=G.getById(y.id),se?(G.removeContact(),se.captured&&(Ze=!0),se.lastPos=se.currentPos,se.lastTime=se.currentTime,se.currentPos=y.currentPos,se.currentTime=y.currentTime,se.insideElement||T(p,G,se),ee=se.currentPos,ge=se.currentTime):(e.console.warn("updatePointerUp(): pointerup on untracked gPoint"),y.captured=!1,y.insideElementPressed=!1,y.insideElement=!0,v(G,y),se=y),!f.preventGesture&&!f.defaultPrevented&&(Ze?(f.shouldReleaseCapture=!0,f.preventDefault=!0,(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(p,se),G.contacts===0?(p.releaseHandler&&p.releaseHandler({eventSource:p,pointerType:se.type,position:O(ee,p.element),buttons:G.buttons,insideElementPressed:se.insideElementPressed,insideElementReleased:se.insideElement,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),p.dragEndHandler&&z.sentDragEvent&&p.dragEndHandler({eventSource:p,pointerType:se.type,position:O(se.currentPos,p.element),speed:se.speed,direction:se.direction,shift:f.originalEvent.shiftKey,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),z.sentDragEvent=!1,(p.clickHandler||p.dblClickHandler)&&se.insideElement&&(Oe=ge-se.contactTime<=p.clickTimeThreshold&&se.contactPos.distanceTo(ee)<=p.clickDistThreshold,p.clickHandler&&p.clickHandler({eventSource:p,pointerType:se.type,position:O(se.currentPos,p.element),quick:Oe,shift:f.originalEvent.shiftKey,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,originalTarget:se.originalTarget,userData:p.userData}),p.dblClickHandler&&Oe&&(G.clicks++,G.clicks===1?(z.lastClickPos=ee,z.dblClickTimeOut=setTimeout(function(){G.clicks=0},p.dblClickTimeThreshold)):G.clicks===2&&(clearTimeout(z.dblClickTimeOut),G.clicks=0,z.lastClickPos.distanceTo(ee)<=p.dblClickDistThreshold&&p.dblClickHandler({eventSource:p,pointerType:se.type,position:O(se.currentPos,p.element),shift:f.originalEvent.shiftKey,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),z.lastClickPos=null)))):G.contacts===2&&p.pinchHandler&&se.type==="touch"&&(z.pinchGPoints=G.asArray(),z.lastPinchDist=z.currentPinchDist=z.pinchGPoints[0].currentPos.distanceTo(z.pinchGPoints[1].currentPos),z.lastPinchCenter=z.currentPinchCenter=d(z.pinchGPoints[0].currentPos,z.pinchGPoints[1].currentPos))):(f.shouldReleaseCapture=!1,p.releaseHandler&&(p.releaseHandler({eventSource:p,pointerType:se.type,position:O(ee,p.element),buttons:G.buttons,insideElementPressed:se.insideElementPressed,insideElementReleased:se.insideElement,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),f.preventDefault=!0)))}function J(p,f,y){var _=i[p.hash],z=p.getActivePointersListByType(y.type),G,ee,ge;if(typeof f.originalEvent.buttons<"u"&&(z.buttons=f.originalEvent.buttons),G=z.getById(y.id),G)G.lastPos=G.currentPos,G.lastTime=G.currentTime,G.currentPos=y.currentPos,G.currentTime=y.currentTime;else return;f.shouldCapture=!1,f.shouldReleaseCapture=!1,p.stopHandler&&y.type==="mouse"&&(clearTimeout(p.stopTimeOut),p.stopTimeOut=setTimeout(function(){ye(p,f.originalEvent,y.type)},p.stopDelay)),z.contacts===0?p.moveHandler&&p.moveHandler({eventSource:p,pointerType:y.type,position:O(y.currentPos,p.element),buttons:z.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}):z.contacts===1?(p.moveHandler&&(G=z.asArray()[0],p.moveHandler({eventSource:p,pointerType:G.type,position:O(G.currentPos,p.element),buttons:z.buttons,isTouchEvent:G.type==="touch",originalEvent:f.originalEvent,userData:p.userData})),p.dragHandler&&!f.preventGesture&&!f.defaultPrevented&&(G=z.asArray()[0],ge=G.currentPos.minus(G.lastPos),p.dragHandler({eventSource:p,pointerType:G.type,position:O(G.currentPos,p.element),buttons:z.buttons,delta:ge,speed:G.speed,direction:G.direction,shift:f.originalEvent.shiftKey,isTouchEvent:G.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),f.preventDefault=!0,_.sentDragEvent=!0)):z.contacts===2&&(p.moveHandler&&(ee=z.asArray(),p.moveHandler({eventSource:p,pointerType:ee[0].type,position:O(d(ee[0].currentPos,ee[1].currentPos),p.element),buttons:z.buttons,isTouchEvent:ee[0].type==="touch",originalEvent:f.originalEvent,userData:p.userData})),p.pinchHandler&&y.type==="touch"&&!f.preventGesture&&!f.defaultPrevented&&(ge=_.pinchGPoints[0].currentPos.distanceTo(_.pinchGPoints[1].currentPos),ge!==_.currentPinchDist&&(_.lastPinchDist=_.currentPinchDist,_.currentPinchDist=ge,_.lastPinchCenter=_.currentPinchCenter,_.currentPinchCenter=d(_.pinchGPoints[0].currentPos,_.pinchGPoints[1].currentPos),p.pinchHandler({eventSource:p,pointerType:"touch",gesturePoints:_.pinchGPoints,lastCenter:O(_.lastPinchCenter,p.element),center:O(_.currentPinchCenter,p.element),lastDistance:_.lastPinchDist,distance:_.currentPinchDist,shift:f.originalEvent.shiftKey,originalEvent:f.originalEvent,userData:p.userData}),f.preventDefault=!0)))}function he(p,f,y){var _=p.getActivePointersListByType(y.type),z;z=_.getById(y.id),z&&T(p,_,z)}function ye(p,f,y){p.stopHandler&&p.stopHandler({eventSource:p,pointerType:y,position:S(f,p.element),buttons:p.getActivePointersListByType(y).buttons,isTouchEvent:y==="touch",originalEvent:f,userData:p.userData})}}(r),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(i,n,s){var l=i.parentNode;typeof n=="number"&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=typeof n.attachToViewer>"u"?!0:n.attachToViewer,this.autoFade=typeof n.autoFade>"u"?!0:n.autoFade,this.element=i,this.anchor=n.anchor,this.container=s,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof n.top=="number"?n.top+"px":n.top,this.wrapper.style.left=typeof n.left=="number"?n.left+"px":n.left,this.wrapper.style.height=typeof n.height=="number"?n.height+"px":n.height,this.wrapper.style.width=typeof n.width=="number"?n.width+"px":n.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),n.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):l.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){this.element[e.SIGNAL]&&e.Browser.vendor===e.BROWSERS.IE?e.setElementOpacity(this.element,i,!0):e.setElementOpacity(this.wrapper,i,!0)}}}(r),function(e){e.ControlDock=function(n){var s=["topleft","topright","bottomright","bottomleft"],l,o;for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(Math.random()*1e6),container:e.makeNeutralElement("div"),controls:[]},n),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),o=0;o<s.length;o++)l=s[o],this.controls[l]=e.makeNeutralElement("div"),this.controls[l].style.position="absolute",l.match("left")&&(this.controls[l].style.left="0px"),l.match("right")&&(this.controls[l].style.right="0px"),l.match("top")&&(this.controls[l].style.top="0px"),l.match("bottom")&&(this.controls[l].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(n,s){n=e.getElement(n);var l=null;if(!(i(this,n)>=0)){switch(s.anchor){case e.ControlAnchor.TOP_RIGHT:l=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:l=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:l=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:l=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:l=this.container,n.style.margin="0px",n.style.padding="0px";break;default:case e.ControlAnchor.NONE:l=this.container,n.style.margin="0px",n.style.padding="0px";break}this.controls.push(new e.Control(n,s,l)),n.style.display="inline-block"}},removeControl:function(n){n=e.getElement(n);var s=i(this,n);return s>=0&&(this.controls[s].destroy(),this.controls.splice(s,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var n;for(n=this.controls.length-1;n>=0;n--)if(this.controls[n].isVisible())return!0;return!1},setControlsEnabled:function(n){var s;for(s=this.controls.length-1;s>=0;s--)this.controls[s].setVisible(n);return this}};function i(n,s){var l=n.controls,o;for(o=l.length-1;o>=0;o--)if(l[o].element===s)return o;return-1}}(r),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(r),function(e){var i={},n=1;e.Viewer=function(u){var v=arguments,T=this,L;if(e.isPlainObject(u)||(u={id:v[0],xmlPath:v.length>1?v[1]:void 0,prefixUrl:v.length>2?v[2]:void 0,controls:v.length>3?v[3]:void 0,overlays:v.length>4?v[4]:void 0}),u.config&&(e.extend(!0,u,u.config),delete u.config),e.extend(!0,this,{id:u.id,hash:u.hash||n++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,u),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof i[this.hash]<"u"&&e.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(R){var B=e.getString("Errors.OpenFailed",R.eventSource,R.message);T._showMessage(B)}),e.ControlDock.call(this,u),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(R){R.width="100%",R.height="100%",R.overflow="hidden",R.position="absolute",R.top="0px",R.left="0px"}(this.canvas.style),e.setElementTouchActionNone(this.canvas),u.tabIndex!==""&&(this.canvas.tabIndex=u.tabIndex===void 0?0:u.tabIndex),this.container.className="openseadragon-container",function(R){R.width="100%",R.height="100%",R.position="relative",R.overflow="hidden",R.left="0px",R.top="0px",R.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,S),keyDownHandler:e.delegate(this,O),keyHandler:e.delegate(this,d),clickHandler:e.delegate(this,w),dblClickHandler:e.delegate(this,H),dragHandler:e.delegate(this,M),dragEndHandler:e.delegate(this,I),enterHandler:e.delegate(this,V),leaveHandler:e.delegate(this,q),pressHandler:e.delegate(this,K),releaseHandler:e.delegate(this,j),nonPrimaryPressHandler:e.delegate(this,oe),nonPrimaryReleaseHandler:e.delegate(this,te),scrollHandler:e.delegate(this,ue),pinchHandler:e.delegate(this,fe)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,_e),leaveHandler:e.delegate(this,le)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=s(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(R){T.source=T.world.getItemAt(0).source,i[T.hash].forceRedraw=!0,T._updateRequestId||(T._updateRequestId=c(T,ae))}),this.world.addHandler("remove-item",function(R){T.world.getItemCount()?T.source=T.world.getItemAt(0).source:T.source=null,i[T.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(R){T.viewport&&T.viewport._setContentBounds(T.world.getHomeBounds(),T.world.getContentFactor())}),this.world.addHandler("item-index-change",function(R){T.source=T.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:u.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(L=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(L,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(L=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(L,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),L=0;L<this.customControls.length;L++)this.addControl(this.customControls[L].id,{anchor:this.customControls[L].anchor});e.requestAnimationFrame(function(){g(T)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(u){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(u)},openTileSource:function(u){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(u)},open:function(u,v){var T=this;if(this.close(),!u)return this;if(this.sequenceMode&&e.isArray(u))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof v<"u"&&!isNaN(v)&&(this.initialPage=v),this.tileSources=u,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(e.isArray(u)||(u=[u]),!u.length)return this;this._opening=!0;for(var L=u.length,R=0,B=0,A,N=function(){if(R+B===L)if(R){(T._firstOpen||!T.preserveViewport)&&(T.viewport.goHome(!0),T.viewport.update()),T._firstOpen=!1;var W=u[0];if(W.tileSource&&(W=W.tileSource),T.overlays&&!T.preserveOverlays)for(var Q=0;Q<T.overlays.length;Q++)T.currentOverlays[Q]=o(T,T.overlays[Q]);T._drawOverlays(),T._opening=!1,T.raiseEvent("open",{source:W})}else T._opening=!1,T.raiseEvent("open-failed",A)},Y=function(W){(!e.isPlainObject(W)||!W.tileSource)&&(W={tileSource:W}),W.index!==void 0&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete W.index),W.collectionImmediately===void 0&&(W.collectionImmediately=!0);var Q=W.success;W.success=function(he){if(R++,W.tileSource.overlays)for(var ye=0;ye<W.tileSource.overlays.length;ye++)T.addOverlay(W.tileSource.overlays[ye]);Q&&Q(he),N()};var J=W.error;W.error=function(he){B++,A||(A=he),J&&J(he),N()},T.addTiledImage(W)},Z=0;Z<u.length;Z++)Y(u[Z]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(u){return this.innerTracker.setTracking(u),this.outerTracker.setTracking(u),this.raiseEvent("mouse-enabled",{enabled:u}),this},areControlsEnabled:function(){var u=this.controls.length,v;for(v=0;v<this.controls.length;v++)u=u&&this.controls[v].isVisible();return u},setControlsEnabled:function(u){return u?b(this):g(this),this.raiseEvent("controls-enabled",{enabled:u}),this},setDebugMode:function(u){for(var v=0;v<this.world.getItemCount();v++)this.world.getItemAt(v).debugMode=u;this.debugMode=u,this.forceRedraw()},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(u){var v=document.body,T=v.style,L=document.documentElement.style,R=this,B,A;if(u===this.isFullPage())return this;var N={fullPage:u,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",N),N.preventDefaultAction)return this;if(u){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=T.margin,this.docMargin=L.margin,T.margin="0",L.margin="0",this.bodyPadding=T.padding,this.docPadding=L.padding,T.padding="0",L.padding="0",this.bodyWidth=T.width,this.docWidth=L.width,T.width="100%",L.width="100%",this.bodyHeight=T.height,this.docHeight=L.height,T.height="100%",L.height="100%",this.bodyDisplay=T.display,T.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,B=v.childNodes.length,A=0;A<B;A++)this.previousBody.push(v.childNodes[0]),v.removeChild(v.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,v.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),v.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,e.delegate(this,_e)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,T.margin=this.bodyMargin,L.margin=this.docMargin,T.padding=this.bodyPadding,L.padding=this.docPadding,T.width=this.bodyWidth,L.width=this.docWidth,T.height=this.bodyHeight,L.height=this.docHeight,T.display=this.bodyDisplay,v.removeChild(this.element),B=this.previousBody.length,A=0;A<B;A++)v.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(v.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var Y=0,Z=function(){e.setPageScroll(R.pageScroll);var W=e.getPageScroll();Y++,Y<10&&(W.x!==R.pageScroll.x||W.y!==R.pageScroll.y)&&e.requestAnimationFrame(Z)};e.requestAnimationFrame(Z),i[this.hash].fullPage=!1,e.delegate(this,le)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:u}),this},setFullScreen:function(u){var v=this;if(!e.supportsFullScreen)return this.setFullPage(u);if(e.isFullScreen()===u)return this;var T={fullScreen:u,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",T),T.preventDefaultAction)return this;if(u){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var L=function(){var R=e.isFullScreen();R||(e.removeEvent(document,e.fullScreenEventName,L),e.removeEvent(document,e.fullScreenErrorEventName,L),v.setFullPage(!1),v.isFullPage()&&(v.element.style.width=v.fullPageStyleWidth,v.element.style.height=v.fullPageStyleHeight)),v.navigator&&v.viewport&&setTimeout(function(){v.navigator.update(v.viewport)}),v.raiseEvent("full-screen",{fullScreen:R})};e.addEvent(document,e.fullScreenEventName,L),e.addEvent(document,e.fullScreenErrorEventName,L),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},setVisible:function(u){return this.container.style.visibility=u?"":"hidden",this.raiseEvent("visible",{visible:u}),this},addTiledImage:function(u){e.console.assert(u,"[Viewer.addTiledImage] options is required"),e.console.assert(u.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!u.replace||u.index>-1&&u.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var v=this;u.replace&&(u.replaceItem=v.world.getItemAt(u.index)),this._hideMessage(),u.placeholderFillStyle===void 0&&(u.placeholderFillStyle=this.placeholderFillStyle),u.opacity===void 0&&(u.opacity=this.opacity),u.preload===void 0&&(u.preload=this.preload),u.compositeOperation===void 0&&(u.compositeOperation=this.compositeOperation),u.crossOriginPolicy===void 0&&(u.crossOriginPolicy=u.tileSource.crossOriginPolicy!==void 0?u.tileSource.crossOriginPolicy:this.crossOriginPolicy),u.ajaxWithCredentials===void 0&&(u.ajaxWithCredentials=this.ajaxWithCredentials),u.loadTilesWithAjax===void 0&&(u.loadTilesWithAjax=this.loadTilesWithAjax),u.ajaxHeaders===void 0||u.ajaxHeaders===null?u.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(u.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(u.ajaxHeaders=e.extend({},this.ajaxHeaders,u.ajaxHeaders));var T={options:u};function L(A){for(var N=0;N<v._loadQueue.length;N++)if(v._loadQueue[N]===T){v._loadQueue.splice(N,1);break}v._loadQueue.length===0&&R(T),v.raiseEvent("add-item-failed",A),u.error&&u.error(A)}function R(A){v.collectionMode&&(v.world.arrange({immediately:A.options.collectionImmediately,rows:v.collectionRows,columns:v.collectionColumns,layout:v.collectionLayout,tileSize:v.collectionTileSize,tileMargin:v.collectionTileMargin}),v.world.setAutoRefigureSizes(!0))}if(e.isArray(u.tileSource)){setTimeout(function(){L({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:u.tileSource,options:u})});return}this._loadQueue.push(T);function B(){for(var A,N,Y;v._loadQueue.length&&(A=v._loadQueue[0],!!A.tileSource);){if(v._loadQueue.splice(0,1),A.options.replace){var Z=v.world.getIndexOfItem(A.options.replaceItem);Z!==-1&&(A.options.index=Z),v.world.removeItem(A.options.replaceItem)}N=new e.TiledImage({viewer:v,source:A.tileSource,viewport:v.viewport,drawer:v.drawer,tileCache:v.tileCache,imageLoader:v.imageLoader,x:A.options.x,y:A.options.y,width:A.options.width,height:A.options.height,fitBounds:A.options.fitBounds,fitBoundsPlacement:A.options.fitBoundsPlacement,clip:A.options.clip,placeholderFillStyle:A.options.placeholderFillStyle,opacity:A.options.opacity,preload:A.options.preload,degrees:A.options.degrees,flipped:A.options.flipped,compositeOperation:A.options.compositeOperation,springStiffness:v.springStiffness,animationTime:v.animationTime,minZoomImageRatio:v.minZoomImageRatio,wrapHorizontal:v.wrapHorizontal,wrapVertical:v.wrapVertical,immediateRender:v.immediateRender,blendTime:v.blendTime,alwaysBlend:v.alwaysBlend,minPixelRatio:v.minPixelRatio,smoothTileEdgesMinZoom:v.smoothTileEdgesMinZoom,iOSDevice:v.iOSDevice,crossOriginPolicy:A.options.crossOriginPolicy,ajaxWithCredentials:A.options.ajaxWithCredentials,loadTilesWithAjax:A.options.loadTilesWithAjax,ajaxHeaders:A.options.ajaxHeaders,debugMode:v.debugMode}),v.collectionMode&&v.world.setAutoRefigureSizes(!1),v.navigator&&(Y=e.extend({},A.options,{replace:!1,originalTiledImage:N,tileSource:A.tileSource}),v.navigator.addTiledImage(Y)),v.world.addItem(N,{index:A.options.index}),v._loadQueue.length===0&&R(A),v.world.getItemCount()===1&&!v.preserveViewport&&v.viewport.goHome(!0),A.options.success&&A.options.success({item:N})}}l(this,u.tileSource,u,function(A){T.tileSource=A,B()},function(A){A.options=u,L(A),B()})},addSimpleImage:function(u){e.console.assert(u,"[Viewer.addSimpleImage] options is required"),e.console.assert(u.url,"[Viewer.addSimpleImage] options.url is required");var v=e.extend({},u,{tileSource:{type:"image",url:u.url}});delete v.url,this.addTiledImage(v)},addLayer:function(u){var v=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var T=e.extend({},u,{success:function(L){v.raiseEvent("add-layer",{options:u,drawer:L.item})},error:function(L){v.raiseEvent("add-layer-failed",L)}});return this.addTiledImage(T),this},getLayerAtLevel:function(u){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(u)},getLevelOfLayer:function(u){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(u)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(u,v){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(u,v)},removeLayer:function(u){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(u)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var u=e.delegate(this,x),v=e.delegate(this,P),T=e.delegate(this,this.goToNextPage),L=e.delegate(this,this.goToPreviousPage),R=this.navImages,B=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(B=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:$(this.prefixUrl,R.previous.REST),srcGroup:$(this.prefixUrl,R.previous.GROUP),srcHover:$(this.prefixUrl,R.previous.HOVER),srcDown:$(this.prefixUrl,R.previous.DOWN),onRelease:L,onFocus:u,onBlur:v}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:$(this.prefixUrl,R.next.REST),srcGroup:$(this.prefixUrl,R.next.GROUP),srcHover:$(this.prefixUrl,R.next.HOVER),srcDown:$(this.prefixUrl,R.next.DOWN),onRelease:T,onFocus:u,onBlur:v}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),B&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var u=e.delegate(this,Me),v=e.delegate(this,Pt),T=e.delegate(this,We),L=e.delegate(this,Ue),R=e.delegate(this,dt),B=e.delegate(this,nt),A=e.delegate(this,vt),N=e.delegate(this,yt),Y=e.delegate(this,E),Z=e.delegate(this,C),W=e.delegate(this,x),Q=e.delegate(this,P),J=this.navImages,he=[],ye=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(ye=!1),this.showZoomControl&&(he.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:$(this.prefixUrl,J.zoomIn.REST),srcGroup:$(this.prefixUrl,J.zoomIn.GROUP),srcHover:$(this.prefixUrl,J.zoomIn.HOVER),srcDown:$(this.prefixUrl,J.zoomIn.DOWN),onPress:u,onRelease:v,onClick:T,onEnter:u,onExit:v,onFocus:W,onBlur:Q})),he.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:$(this.prefixUrl,J.zoomOut.REST),srcGroup:$(this.prefixUrl,J.zoomOut.GROUP),srcHover:$(this.prefixUrl,J.zoomOut.HOVER),srcDown:$(this.prefixUrl,J.zoomOut.DOWN),onPress:L,onRelease:v,onClick:R,onEnter:L,onExit:v,onFocus:W,onBlur:Q}))),this.showHomeControl&&he.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:$(this.prefixUrl,J.home.REST),srcGroup:$(this.prefixUrl,J.home.GROUP),srcHover:$(this.prefixUrl,J.home.HOVER),srcDown:$(this.prefixUrl,J.home.DOWN),onRelease:B,onFocus:W,onBlur:Q})),this.showFullPageControl&&he.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:$(this.prefixUrl,J.fullpage.REST),srcGroup:$(this.prefixUrl,J.fullpage.GROUP),srcHover:$(this.prefixUrl,J.fullpage.HOVER),srcDown:$(this.prefixUrl,J.fullpage.DOWN),onRelease:A,onFocus:W,onBlur:Q})),this.showRotationControl&&(he.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:$(this.prefixUrl,J.rotateleft.REST),srcGroup:$(this.prefixUrl,J.rotateleft.GROUP),srcHover:$(this.prefixUrl,J.rotateleft.HOVER),srcDown:$(this.prefixUrl,J.rotateleft.DOWN),onRelease:N,onFocus:W,onBlur:Q})),he.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:$(this.prefixUrl,J.rotateright.REST),srcGroup:$(this.prefixUrl,J.rotateright.GROUP),srcHover:$(this.prefixUrl,J.rotateright.HOVER),srcDown:$(this.prefixUrl,J.rotateright.DOWN),onRelease:Y,onFocus:W,onBlur:Q}))),this.showFlipControl&&he.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:$(this.prefixUrl,J.flip.REST),srcGroup:$(this.prefixUrl,J.flip.GROUP),srcHover:$(this.prefixUrl,J.flip.HOVER),srcDown:$(this.prefixUrl,J.flip.DOWN),onRelease:Z,onFocus:W,onBlur:Q})),ye?(this.buttonGroup=new e.ButtonGroup({buttons:he,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,St)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=he),this},currentPage:function(){return this._sequenceIndex},goToPage:function(u){return this.tileSources&&u>=0&&u<this.tileSources.length&&(this._sequenceIndex=u,this._updateSequenceButtons(u),this.open(this.tileSources[u]),this.referenceStrip&&this.referenceStrip.setFocus(u),this.raiseEvent("page",{page:u})),this},addOverlay:function(u,v,T,L){var R;if(e.isPlainObject(u)?R=u:R={element:u,location:v,placement:T,onDraw:L},u=e.getElement(R.element),a(this.currentOverlays,u)>=0)return this;var B=o(this,R);return this.currentOverlays.push(B),B.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:u,location:R.location,placement:R.placement}),this},updateOverlay:function(u,v,T){var L;return u=e.getElement(u),L=a(this.currentOverlays,u),L>=0&&(this.currentOverlays[L].update(v,T),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:u,location:v,placement:T})),this},removeOverlay:function(u){var v;return u=e.getElement(u),v=a(this.currentOverlays,u),v>=0&&(this.currentOverlays[v].destroy(),this.currentOverlays.splice(v,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:u})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(u){var v;return u=e.getElement(u),v=a(this.currentOverlays,u),v>=0?this.currentOverlays[v]:null},_updateSequenceButtons:function(u){this.nextButton&&(!this.tileSources||this.tileSources.length-1===u?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(u>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(u){this._hideMessage();var v=e.makeNeutralElement("div");v.appendChild(document.createTextNode(u)),this.messageDiv=e.makeCenteredNode(v),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var u=this.messageDiv;u&&(u.parentNode.removeChild(u),delete this.messageDiv)},gestureSettingsByDeviceType:function(u){switch(u){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var u,v=this.currentOverlays.length;for(u=0;u<v;u++)this.currentOverlays[u].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var u=e.pixelDensityRatio,v=e.getCurrentPixelDensityRatio();u!==v&&(e.pixelDensityRatio=v,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var u=this._sequenceIndex-1;this.navPrevNextWrap&&u<0&&(u+=this.tileSources.length),this.goToPage(u)},goToNextPage:function(){var u=this._sequenceIndex+1;this.navPrevNextWrap&&u>=this.tileSources.length&&(u=0),this.goToPage(u)}});function s(u){return u=e.getElement(u),new e.Point(u.clientWidth===0?1:u.clientWidth,u.clientHeight===0?1:u.clientHeight)}function l(u,v,T,L,R){var B=u;if(e.type(v)==="string"){if(v.match(/^\s*<.*>\s*$/))v=e.parseXml(v);else if(v.match(/^\s*[{[].*[}\]]\s*$/))try{var A=e.parseJSON(v);v=A}catch{}}function N(Y,Z){Y.ready?L(Y):(Y.addHandler("ready",function(){L(Y)}),Y.addHandler("open-failed",function(W){R({message:W.message,source:Z})}))}setTimeout(function(){if(e.type(v)==="string")v=new e.TileSource({url:v,crossOriginPolicy:T.crossOriginPolicy!==void 0?T.crossOriginPolicy:u.crossOriginPolicy,ajaxWithCredentials:u.ajaxWithCredentials,ajaxHeaders:T.ajaxHeaders?T.ajaxHeaders:u.ajaxHeaders,useCanvas:u.useCanvas,success:function(Q){L(Q.tileSource)}}),v.addHandler("open-failed",function(Q){R(Q)});else if(e.isPlainObject(v)||v.nodeType)if(v.crossOriginPolicy===void 0&&(T.crossOriginPolicy!==void 0||u.crossOriginPolicy!==void 0)&&(v.crossOriginPolicy=T.crossOriginPolicy!==void 0?T.crossOriginPolicy:u.crossOriginPolicy),v.ajaxWithCredentials===void 0&&(v.ajaxWithCredentials=u.ajaxWithCredentials),v.useCanvas===void 0&&(v.useCanvas=u.useCanvas),e.isFunction(v.getTileUrl)){var Y=new e.TileSource(v);Y.getTileUrl=v.getTileUrl,L(Y)}else{var Z=e.TileSource.determineType(B,v);if(!Z){R({message:"Unable to load TileSource",source:v});return}var W=Z.prototype.configure.apply(B,[v]);N(new Z(W),v)}else N(v,v)})}function o(u,v){if(v instanceof e.Overlay)return v;var T=null;if(v.element)T=e.getElement(v.element);else{var L=v.id?v.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);T=e.getElement(v.id),T||(T=document.createElement("a"),T.href="#/overlay/"+L),T.id=L,e.addClass(T,v.className?v.className:"openseadragon-overlay")}var R=v.location,B=v.width,A=v.height;if(!R){var N=v.x,Y=v.y;if(v.px!==void 0){var Z=u.viewport.imageToViewportRectangle(new e.Rect(v.px,v.py,B||0,A||0));N=Z.x,Y=Z.y,B=B!==void 0?Z.width:void 0,A=A!==void 0?Z.height:void 0}R=new e.Point(N,Y)}var W=v.placement;return W&&e.type(W)==="string"&&(W=e.Placement[v.placement.toUpperCase()]),new e.Overlay({element:T,location:R,placement:W,onDraw:v.onDraw,checkResize:v.checkResize,width:B,height:A,rotationMode:v.rotationMode})}function a(u,v){var T;for(T=u.length-1;T>=0;T--)if(u[T].element===v)return T;return-1}function c(u,v){return e.requestAnimationFrame(function(){v(u)})}function h(u){e.requestAnimationFrame(function(){m(u)})}function g(u){u.autoHideControls&&(u.controlsShouldFade=!0,u.controlsFadeBeginTime=e.now()+u.controlsFadeDelay,window.setTimeout(function(){h(u)},u.controlsFadeDelay))}function m(u){var v,T,L,R;if(u.controlsShouldFade){for(v=e.now(),T=v-u.controlsFadeBeginTime,L=1-T/u.controlsFadeLength,L=Math.min(1,L),L=Math.max(0,L),R=u.controls.length-1;R>=0;R--)u.controls[R].autoFade&&u.controls[R].setOpacity(L);L>0&&h(u)}}function b(u){var v;for(u.controlsShouldFade=!1,v=u.controls.length-1;v>=0;v--)u.controls[v].setOpacity(1)}function x(){b(this)}function P(){g(this)}function S(u){var v={tracker:u.eventSource,position:u.position,originalEvent:u.originalEvent,preventDefault:u.preventDefault};this.raiseEvent("canvas-contextmenu",v),u.preventDefault=v.preventDefault}function O(u){var v={originalEvent:u.originalEvent,preventDefaultAction:!1,preventVerticalPan:u.preventVerticalPan,preventHorizontalPan:u.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),!v.preventDefaultAction&&!u.ctrl&&!u.alt&&!u.meta)switch(u.keyCode){case 38:v.preventVerticalPan||(u.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 40:v.preventVerticalPan||(u.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 37:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 39:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),u.preventDefault=!0;break;default:u.preventDefault=!1;break}else u.preventDefault=!1}function d(u){var v={originalEvent:u.originalEvent,preventDefaultAction:!1,preventVerticalPan:u.preventVerticalPan,preventHorizontalPan:u.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),!v.preventDefaultAction&&!u.ctrl&&!u.alt&&!u.meta)switch(u.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 119:case 87:v.preventVerticalPan||(u.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 115:case 83:v.preventVerticalPan||(u.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 97:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 100:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 114:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 82:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),u.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:u.preventDefault=!1;break}else u.preventDefault=!1}function w(u){var v,T=document.activeElement===this.canvas;T||this.canvas.focus(),this.viewport.flipped&&(u.position.x=this.viewport.getContainerSize().x-u.position.x);var L={tracker:u.eventSource,position:u.position,quick:u.quick,shift:u.shift,originalEvent:u.originalEvent,originalTarget:u.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",L),!L.preventDefaultAction&&this.viewport&&u.quick&&(v=this.gestureSettingsByDeviceType(u.pointerType),v.clickToZoom&&(this.viewport.zoomBy(u.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(u.position,!0):null),this.viewport.applyConstraints()))}function H(u){var v,T={tracker:u.eventSource,position:u.position,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",T),!T.preventDefaultAction&&this.viewport&&(v=this.gestureSettingsByDeviceType(u.pointerType),v.dblClickToZoom&&(this.viewport.zoomBy(u.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(u.position,!0):null),this.viewport.applyConstraints()))}function M(u){var v,T={tracker:u.eventSource,pointerType:u.pointerType,position:u.position,delta:u.delta,speed:u.speed,direction:u.direction,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",T),v=this.gestureSettingsByDeviceType(u.pointerType),v.dragToPan&&!T.preventDefaultAction&&this.viewport){if(this.panHorizontal||(u.delta.x=0),this.panVertical||(u.delta.y=0),this.viewport.flipped&&(u.delta.x=-u.delta.x),this.constrainDuringPan){var L=this.viewport.deltaPointsFromPixels(u.delta.negate());this.viewport.centerSpringX.target.value+=L.x,this.viewport.centerSpringY.target.value+=L.y;var R=this.viewport.getBounds(),B=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=L.x,this.viewport.centerSpringY.target.value-=L.y,R.x!==B.x&&(u.delta.x=0),R.y!==B.y&&(u.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(u.delta.negate()),v.flickEnabled&&!this.constrainDuringPan)}}function I(u){var v={tracker:u.eventSource,pointerType:u.pointerType,position:u.position,speed:u.speed,direction:u.direction,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",v),!v.preventDefaultAction&&this.viewport){var T=this.gestureSettingsByDeviceType(u.pointerType);if(T.flickEnabled&&u.speed>=T.flickMinSpeed){var L=0;this.panHorizontal&&(L=T.flickMomentum*u.speed*Math.cos(u.direction));var R=0;this.panVertical&&(R=T.flickMomentum*u.speed*Math.sin(u.direction));var B=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),A=this.viewport.pointFromPixel(new e.Point(B.x-L,B.y-R));this.viewport.panTo(A,!1)}this.viewport.applyConstraints()}}function V(u){this.raiseEvent("canvas-enter",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,buttons:u.buttons,pointers:u.pointers,insideElementPressed:u.insideElementPressed,buttonDownAny:u.buttonDownAny,originalEvent:u.originalEvent})}function q(u){this.raiseEvent("canvas-exit",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,buttons:u.buttons,pointers:u.pointers,insideElementPressed:u.insideElementPressed,buttonDownAny:u.buttonDownAny,originalEvent:u.originalEvent})}function K(u){this.raiseEvent("canvas-press",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,insideElementPressed:u.insideElementPressed,insideElementReleased:u.insideElementReleased,originalEvent:u.originalEvent})}function j(u){this.raiseEvent("canvas-release",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,insideElementPressed:u.insideElementPressed,insideElementReleased:u.insideElementReleased,originalEvent:u.originalEvent})}function oe(u){this.raiseEvent("canvas-nonprimary-press",{tracker:u.eventSource,position:u.position,pointerType:u.pointerType,button:u.button,buttons:u.buttons,originalEvent:u.originalEvent})}function te(u){this.raiseEvent("canvas-nonprimary-release",{tracker:u.eventSource,position:u.position,pointerType:u.pointerType,button:u.button,buttons:u.buttons,originalEvent:u.originalEvent})}function fe(u){var v,T,L,R,B={tracker:u.eventSource,pointerType:u.pointerType,gesturePoints:u.gesturePoints,lastCenter:u.lastCenter,center:u.center,lastDistance:u.lastDistance,distance:u.distance,shift:u.shift,originalEvent:u.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",B),this.viewport&&(v=this.gestureSettingsByDeviceType(u.pointerType),v.pinchToZoom&&(!B.preventDefaultPanAction||!B.preventDefaultZoomAction)&&(T=this.viewport.pointFromPixel(u.center,!0),B.preventDefaultZoomAction||this.viewport.zoomBy(u.distance/u.lastDistance,T,!0),v.zoomToRefPoint&&!B.preventDefaultPanAction&&(L=this.viewport.pointFromPixel(u.lastCenter,!0),R=L.minus(T),this.panHorizontal||(R.x=0),this.panVertical||(R.y=0),this.viewport.panBy(R,!0)),this.viewport.applyConstraints()),v.pinchRotate&&!B.preventDefaultRotateAction)){var A=Math.atan2(u.gesturePoints[0].currentPos.y-u.gesturePoints[1].currentPos.y,u.gesturePoints[0].currentPos.x-u.gesturePoints[1].currentPos.x),N=Math.atan2(u.gesturePoints[0].lastPos.y-u.gesturePoints[1].lastPos.y,u.gesturePoints[0].lastPos.x-u.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(A-N)*(180/Math.PI))}}function ue(u){var v,T,L,R,B;R=e.now(),B=R-this._lastScrollTime,B>this.minScrollDeltaTime?(this._lastScrollTime=R,v={tracker:u.eventSource,position:u.position,scroll:u.scroll,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",v),!v.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(u.position.x=this.viewport.getContainerSize().x-u.position.x),T=this.gestureSettingsByDeviceType(u.pointerType),T.scrollToZoom&&(L=Math.pow(this.zoomPerScroll,u.scroll),this.viewport.zoomBy(L,T.zoomToRefPoint?this.viewport.pointFromPixel(u.position,!0):null),this.viewport.applyConstraints())),u.preventDefault=v.preventDefault):u.preventDefault=!0}function _e(u){i[this.hash].mouseInside=!0,b(this),this.raiseEvent("container-enter",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,buttons:u.buttons,pointers:u.pointers,insideElementPressed:u.insideElementPressed,buttonDownAny:u.buttonDownAny,originalEvent:u.originalEvent})}function le(u){u.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||g(this)),this.raiseEvent("container-exit",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,buttons:u.buttons,pointers:u.pointers,insideElementPressed:u.insideElementPressed,buttonDownAny:u.buttonDownAny,originalEvent:u.originalEvent})}function ae(u){ne(u),u.isOpen()?u._updateRequestId=c(u,ae):u._updateRequestId=!1}function ne(u){if(!(u._opening||!i[u.hash])){if(u.autoResize){var v=s(u.container),T=i[u.hash].prevContainerSize;if(!v.equals(T)){var L=u.viewport;if(u.preserveImageSizeOnResize){var R=T.x/v.x,B=L.getZoom()*R,A=L.getCenter();L.resize(v,!1),L.zoomTo(B,null,!0),L.panTo(A,!0)}else{var N=L.getBounds();L.resize(v,!0),L.fitBoundsWithConstraints(N,!0)}i[u.hash].prevContainerSize=v,i[u.hash].forceRedraw=!0}}var Y=u.viewport.update(),Z=u.world.update()||Y;Y&&u.raiseEvent("viewport-change"),u.referenceStrip&&(Z=u.referenceStrip.update(u.viewport)||Z),!i[u.hash].animating&&Z&&(u.raiseEvent("animation-start"),b(u)),(Z||i[u.hash].forceRedraw||u.world.needsDraw())&&(Te(u),u._drawOverlays(),u.navigator&&u.navigator.update(u.viewport),i[u.hash].forceRedraw=!1,Z&&u.raiseEvent("animation")),i[u.hash].animating&&!Z&&(u.raiseEvent("animation-finish"),i[u.hash].mouseInside||g(u)),i[u.hash].animating=Z}}function Te(u){u.imageLoader.clear(),u.drawer.clear(),u.world.draw(),u.raiseEvent("update-viewport",{})}function $(u,v){return u?u+v:v}function Me(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,mt(this)}function Ue(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,mt(this)}function Pt(){i[this.hash].zooming=!1}function mt(u){e.requestAnimationFrame(e.delegate(u,Vt))}function Vt(){var u,v,T;i[this.hash].zooming&&this.viewport&&(u=e.now(),v=u-i[this.hash].lastZoomTime,T=Math.pow(i[this.hash].zoomFactor,v/1e3),this.viewport.zoomBy(T),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=u,mt(this))}function We(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function dt(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function St(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function nt(){this.viewport&&this.viewport.goHome()}function vt(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function yt(){if(this.viewport){var u=this.viewport.getRotation();this.viewport.flipped?u=e.positiveModulo(u+this.rotationIncrement,360):u=e.positiveModulo(u-this.rotationIncrement,360),this.viewport.setRotation(u)}}function E(){if(this.viewport){var u=this.viewport.getRotation();this.viewport.flipped?u=e.positiveModulo(u-this.rotationIncrement,360):u=e.positiveModulo(u+this.rotationIncrement,360),this.viewport.setRotation(u)}}function C(){this.viewport.toggleFlip()}}(r),function(e){e.Navigator=function(c){var h=c.viewer,g=this,m,b;c.id?(this.element=document.getElementById(c.id),c.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(c.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),c.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:c.autoFade},c.position&&(c.position==="BOTTOM_RIGHT"?c.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:c.position==="BOTTOM_LEFT"?c.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:c.position==="TOP_RIGHT"?c.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:c.position==="TOP_LEFT"?c.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:c.position==="ABSOLUTE"&&(c.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,c.controlOptions.top=c.top,c.controlOptions.left=c.left,c.controlOptions.height=c.height,c.controlOptions.width=c.width))),this.element.id=c.id,this.element.className+=" navigator",c=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},c,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:c.autoResize,minZoomImageRatio:1,background:c.background,opacity:c.opacity,borderColor:c.borderColor,displayRegionColor:c.displayRegionColor}),c.minPixelRatio=this.minPixelRatio=h.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),c.controlOptions.anchor!==e.ControlAnchor.NONE&&function(S,O){S.margin="0px",S.border=O+"px solid "+c.borderColor,S.padding="0px",S.background=c.background,S.opacity=c.opacity,S.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(S,O){S.position="relative",S.top="0px",S.left="0px",S.fontSize="0px",S.overflow="hidden",S.border=O+"px solid "+c.displayRegionColor,S.margin="0px",S.padding="0px",S.background="transparent",S.float="left",S.cssFloat="left",S.styleFloat="left",S.zIndex=999999999,S.cursor="default"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),h.addControl(this.element,c.controlOptions),this._resizeWithViewer=c.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&c.controlOptions.anchor!==e.ControlAnchor.NONE,c.width&&c.height?(this.setWidth(c.width),this.setHeight(c.height)):this._resizeWithViewer&&(m=e.getElementSize(h.element),this.element.style.height=Math.round(m.y*c.sizeRatio)+"px",this.element.style.width=Math.round(m.x*c.sizeRatio)+"px",this.oldViewerSize=m,b=e.getElementSize(this.element),this.elementArea=b.x*b.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[c]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function x(S){o(g.displayRegionContainer,S),o(g.displayRegion,-S),g.viewport.setRotation(S)}if(c.navigatorRotate){var P=c.viewer.viewport?c.viewer.viewport.getRotation():c.viewer.degrees||0;x(P),c.viewer.addHandler("rotate",function(S){x(S.degrees)})}this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,n),clickHandler:e.delegate(this,i),releaseHandler:e.delegate(this,s),scrollHandler:e.delegate(this,l),preProcessEventHandler:function(S){S.eventType==="wheel"&&(S.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){g.viewport&&g.viewport.goHome(!0)}),h.world.addHandler("item-index-change",function(S){window.setTimeout(function(){var O=g.world.getItemAt(S.previousIndex);g.world.setItemIndex(O,S.newIndex)},1)}),h.world.addHandler("remove-item",function(S){var O=S.item,d=g._getMatchingItem(O);d&&g.world.removeItem(d)}),this.update(h.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var c=new e.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);c.equals(this.oldContainerSize)||(this.viewport.resize(c,!0),this.viewport.goHome(!0),this.oldContainerSize=c,this.drawer.clear(),this.world.draw())}},setWidth:function(c){this.width=c,this.element.style.width=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1},setHeight:function(c){this.height=c,this.element.style.height=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1},setFlip:function(c){return this.viewport.setFlip(c),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(c){a(this.displayRegion,c),a(this.canvas,c),a(this.element,c)},update:function(c){var h,g,m,b,x,P;if(h=e.getElementSize(this.viewer.element),this._resizeWithViewer&&h.x&&h.y&&!h.equals(this.oldViewerSize)&&(this.oldViewerSize=h,this.maintainSizeRatio||!this.elementArea?(g=h.x*this.sizeRatio,m=h.y*this.sizeRatio):(g=Math.sqrt(this.elementArea*(h.x/h.y)),m=this.elementArea/g),this.element.style.width=Math.round(g)+"px",this.element.style.height=Math.round(m)+"px",this.elementArea||(this.elementArea=g*m),this.updateSize()),c&&this.viewport){b=c.getBoundsNoRotate(!0),x=this.viewport.pixelFromPointNoRotate(b.getTopLeft(),!1),P=this.viewport.pixelFromPointNoRotate(b.getBottomRight(),!1).minus(this.totalBorderWidths);var S=this.displayRegion.style;S.display=this.world.getItemCount()?"block":"none",S.top=Math.round(x.y)+"px",S.left=Math.round(x.x)+"px";var O=Math.abs(x.x-P.x),d=Math.abs(x.y-P.y);S.width=Math.round(Math.max(O,0))+"px",S.height=Math.round(Math.max(d,0))+"px"}},addTiledImage:function(c){var h=this,g=c.originalTiledImage;delete c.original;var m=e.extend({},c,{success:function(b){var x=b.item;x._originalForNavigator=g,h._matchBounds(x,g,!0),h._matchOpacity(x,g),h._matchCompositeOperation(x,g);function P(){h._matchBounds(x,g)}function S(){h._matchOpacity(x,g)}function O(){h._matchCompositeOperation(x,g)}g.addHandler("bounds-change",P),g.addHandler("clip-change",P),g.addHandler("opacity-change",S),g.addHandler("composite-operation-change",O)}});return e.Viewer.prototype.addTiledImage.apply(this,[m])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(c){for(var h=this.world.getItemCount(),g,m=0;m<h;m++)if(g=this.world.getItemAt(m),g._originalForNavigator===c)return g;return null},_matchBounds:function(c,h,g){var m=h.getBoundsNoRotate();c.setPosition(m.getTopLeft(),g),c.setWidth(m.width,g),c.setRotation(h.getRotation(),g),c.setClip(h.getClip()),c.setFlip(h.getFlip())},_matchOpacity:function(c,h){c.setOpacity(h.opacity)},_matchCompositeOperation:function(c,h){c.setCompositeOperation(h.compositeOperation)}});function i(c){var h={tracker:c.eventSource,position:c.position,quick:c.quick,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",h),!h.preventDefaultAction&&c.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(c.position.x=this.viewport.getContainerSize().x-c.position.x);var g=this.viewport.pointFromPixel(c.position);this.panVertical?this.panHorizontal||(g.x=this.viewer.viewport.getCenter(!0).x):g.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(g),this.viewer.viewport.applyConstraints()}}function n(c){var h={tracker:c.eventSource,position:c.position,delta:c.delta,speed:c.speed,direction:c.direction,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",h),!h.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(c.delta.x=0),this.panVertical||(c.delta.y=0),this.viewer.viewport.flipped&&(c.delta.x=-c.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(c.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function s(c){c.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function l(c){var h={tracker:c.eventSource,position:c.position,scroll:c.scroll,shift:c.shift,originalEvent:c.originalEvent,preventDefault:c.preventDefault};this.viewer.raiseEvent("navigator-scroll",h),c.preventDefault=h.preventDefault}function o(c,h){a(c,"rotate("+h+"deg)")}function a(c,h){c.style.webkitTransform=h,c.style.mozTransform=h,c.style.msTransform=h,c.style.oTransform=h,c.style.transform=h}}(r),function(e){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(n){var s=n.split("."),l=null,o=arguments,a=i,c;for(c=0;c<s.length-1;c++)a=a[s[c]]||{};return l=a[s[c]],typeof l!="string"&&(e.console.log("Untranslated source string:",n),l=""),l.replace(/\{\d+\}/g,function(h){var g=parseInt(h.match(/\d+/),10)+1;return g<o.length?o[g]:""})},setString:function(n,s){var l=n.split("."),o=i,a;for(a=0;a<l.length-1;a++)o[l[a]]||(o[l[a]]={}),o=o[l[a]];o[l[a]]=s}})}(r),function(e){e.Point=function(i,n){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(i){return new e.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new e.Point(this.x-i.x,this.y-i.y)},times:function(i){return new e.Point(this.x*i,this.y*i)},divide:function(i){return new e.Point(this.x/i,this.y/i)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new e.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof e.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,n){n=n||new e.Point(0,0);var s,l;if(i%90===0){var o=e.positiveModulo(i,360);switch(o){case 0:s=1,l=0;break;case 90:s=0,l=1;break;case 180:s=-1,l=0;break;case 270:s=0,l=-1;break}}else{var a=i*Math.PI/180;s=Math.cos(a),l=Math.sin(a)}var c=s*(this.x-n.x)-l*(this.y-n.y)+n.x,h=l*(this.x-n.x)+s*(this.y-n.y)+n.y;return new e.Point(c,h)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(r),function(e){e.TileSource=function(n,s,l,o,a,c){var h=this,g=arguments,m,b;if(e.isPlainObject(n)?m=n:m={width:g[0],height:g[1],tileSize:g[2],tileOverlap:g[3],minLevel:g[4],maxLevel:g[5]},e.EventSource.call(this),e.extend(!0,this,m),!this.success){for(b=0;b<arguments.length;b++)if(e.isFunction(arguments[b])){this.success=arguments[b];break}}this.success&&this.addHandler("ready",function(x){h.success(x)}),e.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=m.width&&m.height?m.width/m.height:1,this.dimensions=new e.Point(m.width,m.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=m.tileOverlap?m.tileOverlap:0,this.minLevel=m.minLevel?m.minLevel:0,this.maxLevel=m.maxLevel!==void 0&&m.maxLevel!==null?m.maxLevel:m.width&&m.height?Math.ceil(Math.log(Math.max(m.width,m.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(n){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(n){return this._tileWidth?this._tileWidth:this.getTileSize(n)},getTileHeight:function(n){return this._tileHeight?this._tileHeight:this.getTileSize(n)},setMaxLevel:function(n){this.maxLevel=n,this._memoizeLevelScale()},getLevelScale:function(n){return this._memoizeLevelScale(),this.getLevelScale(n)},_memoizeLevelScale:function(){var n={},s;for(s=0;s<=this.maxLevel;s++)n[s]=1/Math.pow(2,this.maxLevel-s);this.getLevelScale=function(l){return n[l]}},getNumTiles:function(n){var s=this.getLevelScale(n),l=Math.ceil(s*this.dimensions.x/this.getTileWidth(n)),o=Math.ceil(s*this.dimensions.y/this.getTileHeight(n));return new e.Point(l,o)},getPixelRatio:function(n){var s=this.dimensions.times(this.getLevelScale(n)),l=1/s.x*e.pixelDensityRatio,o=1/s.y*e.pixelDensityRatio;return new e.Point(l,o)},getClosestLevel:function(){var n,s;for(n=this.minLevel+1;n<=this.maxLevel&&(s=this.getNumTiles(n),!(s.x>1||s.y>1));n++);return n-1},getTileAtPoint:function(n,s){var l=s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/this.aspectRatio;e.console.assert(l,"[TileSource.getTileAtPoint] must be called with a valid point.");var o=this.dimensions.x*this.getLevelScale(n),a=s.x*o,c=s.y*o,h=Math.floor(a/this.getTileWidth(n)),g=Math.floor(c/this.getTileHeight(n));s.x>=1&&(h=this.getNumTiles(n).x-1);var m=1e-15;return s.y>=1/this.aspectRatio-m&&(g=this.getNumTiles(n).y-1),new e.Point(h,g)},getTileBounds:function(n,s,l,o){var a=this.dimensions.times(this.getLevelScale(n)),c=this.getTileWidth(n),h=this.getTileHeight(n),g=s===0?0:c*s-this.tileOverlap,m=l===0?0:h*l-this.tileOverlap,b=c+(s===0?1:2)*this.tileOverlap,x=h+(l===0?1:2)*this.tileOverlap,P=1/a.x;return b=Math.min(b,a.x-g),x=Math.min(x,a.y-m),o?new e.Rect(0,0,b,x):new e.Rect(g*P,m*P,b*P,x*P)},getImageInfo:function(n){var s=this,l,o,a,c,h,g,m;n&&(h=n.split("/"),g=h[h.length-1],m=g.lastIndexOf("."),m>-1&&(h[h.length-1]=g.slice(0,m))),o=function(b){typeof b=="string"&&(b=e.parseXml(b));var x=e.TileSource.determineType(s,b,n);if(!x){s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:n});return}c=x.prototype.configure.apply(s,[b,n]),c.ajaxWithCredentials===void 0&&(c.ajaxWithCredentials=s.ajaxWithCredentials),a=new x(c),s.ready=!0,s.raiseEvent("ready",{tileSource:a})},n.match(/\.js$/)?(l=n.split("/").pop().replace(".js",""),e.jsonp({url:n,async:!1,callbackName:l,callback:o})):e.makeAjaxRequest({url:n,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(b){var x=i(b);o(x)},error:function(b,x){var P;try{P="HTTP "+b.status+" attempting to load TileSource"}catch{var S;typeof x>"u"||!x.toString?S="Unknown error":S=x.toString(),P=S+" attempting to load TileSource"}s.raiseEvent("open-failed",{message:P,source:n})}})},supports:function(n,s){return!1},configure:function(n,s){throw new Error("Method not implemented.")},getTileUrl:function(n,s,l){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(n,s,l){return{}},tileExists:function(n,s,l){var o=this.getNumTiles(n);return n>=this.minLevel&&n<=this.maxLevel&&s>=0&&l>=0&&s<o.x&&l<o.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype);function i(n){var s=n.responseText,l=n.status,o,a;if(n){if(n.status!==200&&n.status!==0)throw l=n.status,o=l===404?"Not Found":n.statusText,new Error(e.getString("Errors.Status",l,o))}else throw new Error(e.getString("Errors.Security"));if(s.match(/\s*<.*/))try{a=n.responseXML&&n.responseXML.documentElement?n.responseXML:e.parseXml(s)}catch{a=n.responseText}else if(s.match(/\s*[{[].*/))try{a=e.parseJSON(s)}catch{a=s}else a=s;return a}e.TileSource.determineType=function(n,s,l){var o;for(o in r)if(o.match(/.+TileSource$/)&&e.isFunction(r[o])&&e.isFunction(r[o].prototype.supports)&&r[o].prototype.supports.call(n,s,l))return r[o];return e.console.error("No TileSource was able to open %s %s",l,s),null}}(r),function(e){e.DziTileSource=function(s,l,o,a,c,h,g,m,b){var x,P,S,O;if(e.isPlainObject(s)?O=s:O={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=O.tilesUrl,this.fileFormat=O.fileFormat,this.displayRects=O.displayRects,this.displayRects)for(x=this.displayRects.length-1;x>=0;x--)for(P=this.displayRects[x],S=P.minLevel;S<=P.maxLevel;S++)this._levelRects[S]||(this._levelRects[S]=[]),this._levelRects[S].push(P);e.TileSource.apply(this,[O])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(s,l){var o;return s.Image?o=s.Image.xmlns:s.documentElement&&(s.documentElement.localName==="Image"||s.documentElement.tagName==="Image")&&(o=s.documentElement.namespaceURI),o=(o||"").toLowerCase(),o.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||o.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(s,l){var o;return e.isPlainObject(s)?o=n(this,s):o=i(this,s),l&&!o.tilesUrl&&(o.tilesUrl=l.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),l.search(/\.(dzi|xml|js)\?/)!==-1?o.queryParams=l.match(/\?.*/):o.queryParams=""),o},getTileUrl:function(s,l,o){return[this.tilesUrl,s,"/",l,"_",o,".",this.fileFormat,this.queryParams].join("")},tileExists:function(s,l,o){var a=this._levelRects[s],c,h,g,m,b,x,P;if(this.minLevel&&s<this.minLevel||this.maxLevel&&s>this.maxLevel)return!1;if(!a||!a.length)return!0;for(P=a.length-1;P>=0;P--)if(c=a[P],!(s<c.minLevel||s>c.maxLevel)&&(h=this.getLevelScale(s),g=c.x*h,m=c.y*h,b=g+c.width*h,x=m+c.height*h,g=Math.floor(g/this._tileWidth),m=Math.floor(m/this._tileWidth),b=Math.ceil(b/this._tileWidth),x=Math.ceil(x/this._tileWidth),g<=l&&l<b&&m<=o&&o<x))return!0;return!1}});function i(s,l){if(!l||!l.documentElement)throw new Error(e.getString("Errors.Xml"));var o=l.documentElement,a=o.localName||o.tagName,c=l.documentElement.namespaceURI,h=null,g=[],m,b,x,P,S;if(a==="Image")try{if(P=o.getElementsByTagName("Size")[0],P===void 0&&(P=o.getElementsByTagNameNS(c,"Size")[0]),h={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:o.getAttribute("Url"),Format:o.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(o.getAttribute("Overlap"),10),TileSize:parseInt(o.getAttribute("TileSize"),10),Size:{Height:parseInt(P.getAttribute("Height"),10),Width:parseInt(P.getAttribute("Width"),10)}}},!e.imageFormatSupported(h.Image.Format))throw new Error(e.getString("Errors.ImageFormat",h.Image.Format.toUpperCase()));for(m=o.getElementsByTagName("DisplayRect"),m===void 0&&(m=o.getElementsByTagNameNS(c,"DisplayRect")[0]),S=0;S<m.length;S++)b=m[S],x=b.getElementsByTagName("Rect")[0],x===void 0&&(x=b.getElementsByTagNameNS(c,"Rect")[0]),g.push({Rect:{X:parseInt(x.getAttribute("X"),10),Y:parseInt(x.getAttribute("Y"),10),Width:parseInt(x.getAttribute("Width"),10),Height:parseInt(x.getAttribute("Height"),10),MinLevel:parseInt(b.getAttribute("MinLevel"),10),MaxLevel:parseInt(b.getAttribute("MaxLevel"),10)}});return g.length&&(h.Image.DisplayRect=g),n(s,h)}catch(w){throw w instanceof Error?w:new Error(e.getString("Errors.Dzi"))}else{if(a==="Collection")throw new Error(e.getString("Errors.Dzc"));if(a==="Error"){var O=o.getElementsByTagName("Message")[0],d=O.firstChild.nodeValue;throw new Error(d)}}throw new Error(e.getString("Errors.Dzi"))}function n(s,l){var o=l.Image,a=o.Url,c=o.Format,h=o.Size,g=o.DisplayRect||[],m=parseInt(h.Width,10),b=parseInt(h.Height,10),x=parseInt(o.TileSize,10),P=parseInt(o.Overlap,10),S=[],O,d;for(d=0;d<g.length;d++)O=g[d].Rect,S.push(new e.DisplayRect(parseInt(O.X,10),parseInt(O.Y,10),parseInt(O.Width,10),parseInt(O.Height,10),parseInt(O.MinLevel,10),parseInt(O.MaxLevel,10)));return e.extend(!0,{width:m,height:b,tileSize:x,tileOverlap:P,minLevel:null,maxLevel:null,tilesUrl:a,fileFormat:c,displayRects:S},l)}}(r),function(e){e.IIIFTileSource=function(o){if(e.extend(!0,this,o),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(o.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=o.version,this.tile_width&&this.tile_height)o.tileWidth=this.tile_width,o.tileHeight=this.tile_height;else if(this.tile_width)o.tileSize=this.tile_width;else if(this.tile_height)o.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)o.tileWidth=this.tiles[0].width,o.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var a=0;a<this.tiles.length;a++)for(var c=0;c<this.tiles[a].scaleFactors.length;c++){var h=this.tiles[a].scaleFactors[c];this.scale_factors.push(h),o.tileSizePerScaleFactor[h]={width:this.tiles[a].width,height:this.tiles[a].height||this.tiles[a].width}}}else if(i(o)){for(var g=Math.min(this.height,this.width),m=[256,512,1024],b=[],x=0;x<m.length;x++)m[x]<=g&&b.push(m[x]);b.length>0?o.tileSize=Math.max.apply(null,b):o.tileSize=g}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,o.levels=n(this),e.extend(!0,o,{width:o.levels[o.levels.length-1].width,height:o.levels[o.levels.length-1].height,tileSize:Math.max(o.height,o.width),tileOverlap:0,minLevel:0,maxLevel:o.levels.length-1}),this.levels=o.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!o.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)o.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var P=Math.max.apply(null,this.scale_factors);o.maxLevel=Math.round(Math.log(P)*Math.LOG2E)}e.TileSource.apply(this,[o])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(o,a){return o.protocol&&o.protocol==="http://iiif.io/api/image"||o["@context"]&&(o["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||o["@context"]==="http://iiif.io/api/image/1/context.json")||o.profile&&o.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||o.identifier&&o.width&&o.height?!0:!!(o.documentElement&&o.documentElement.tagName==="info"&&o.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(o,a){if(e.isPlainObject(o)){if(!o["@context"])o["@context"]="http://iiif.io/api/image/1.0/context.json",o["@id"]=a.replace("/info.json",""),o.version=1;else{var h=o["@context"];if(Array.isArray(h)){for(var g=0;g<h.length;g++)if(typeof h[g]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(h[g])||h[g]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){h=h[g];break}}switch(h){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":o.version=1;break;case"http://iiif.io/api/image/2/context.json":o.version=2;break;case"http://iiif.io/api/image/3/context.json":o.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!o["@id"]&&o.id&&(o["@id"]=o.id),o.preferredFormats){for(var m=0;m<o.preferredFormats.length;m++)if(r.imageFormatSupported(o.preferredFormats[m])){o.tileFormat=o.preferredFormats[m];break}}return o}else{var c=s(o);return c["@context"]="http://iiif.io/api/image/1.0/context.json",c["@id"]=a.replace("/info.xml",""),c.version=1,c}},getTileWidth:function(o){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,o);var a=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].width:this._tileWidth},getTileHeight:function(o){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,o);var a=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].height:this._tileHeight},getLevelScale:function(o){if(this.emulateLegacyImagePyramid){var a=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(a=this.levels[o].width/this.levels[this.maxLevel].width),a}return e.TileSource.prototype.getLevelScale.call(this,o)},getNumTiles:function(o){if(this.emulateLegacyImagePyramid){var a=this.getLevelScale(o);return a?new e.Point(1,1):new e.Point(0,0)}return e.TileSource.prototype.getNumTiles.call(this,o)},getTileAtPoint:function(o,a){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,o,a)},getTileUrl:function(o,a,c){if(this.emulateLegacyImagePyramid){var h=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(h=this.levels[o].url),h}var g="0",m=Math.pow(.5,this.maxLevel-o),b=Math.ceil(this.width*m),x=Math.ceil(this.height*m),P,S,O,d,w,H,M,I,V,q,K,j,oe,te;return P=this.getTileWidth(o),S=this.getTileHeight(o),O=Math.ceil(P/m),d=Math.ceil(S/m),this.version===1?oe="native."+this.tileFormat:oe="default."+this.tileFormat,b<P&&x<S?(this.version===2&&b===this.width?q="full":this.version===3&&b===this.width&&x===this.height?q="max":this.version===3?q=b+","+x:q=b+",",w="full"):(H=a*O,M=c*d,I=Math.min(O,this.width-H),V=Math.min(d,this.height-M),a===0&&c===0&&I===this.width&&V===this.height?w="full":w=[H,M,I,V].join(","),K=Math.ceil(I*m),j=Math.ceil(V*m),this.version===2&&K===this.width?q="full":this.version===3&&K===this.width&&j===this.height?q="max":this.version===3?q=K+","+j:q=K+","),te=[this["@id"],w,q,g,oe].join("/"),te},__testonly__:{canBeTiled:i,constructLevels:n}});function i(o){var a=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],c=Array.isArray(o.profile)?o.profile[0]:o.profile,h=a.indexOf(c)!==-1,g=!1;return o.version===2&&o.profile.length>1&&o.profile[1].supports&&(g=o.profile[1].supports.indexOf("sizeByW")!==-1),o.version===3&&o.extraFeatures&&(g=o.extraFeatures.indexOf("sizeByWh")!==-1),!h||g}function n(o){for(var a=[],c=0;c<o.sizes.length;c++)a.push({url:o["@id"]+"/full/"+o.sizes[c].width+","+(o.version===3?o.sizes[c].height:"")+"/0/default."+o.tileFormat,width:o.sizes[c].width,height:o.sizes[c].height});return a.sort(function(h,g){return h.width-g.width})}function s(o){if(!o||!o.documentElement)throw new Error(e.getString("Errors.Xml"));var a=o.documentElement,c=a.tagName,h=null;if(c==="info")try{return h={},l(a,h),h}catch(g){throw g instanceof Error?g:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function l(o,a,c){var h,g;if(o.nodeType===3&&c)g=o.nodeValue.trim(),g.match(/^\d*$/)&&(g=Number(g)),a[c]?(e.isArray(a[c])||(a[c]=[a[c]]),a[c].push(g)):a[c]=g;else if(o.nodeType===1)for(h=0;h<o.childNodes.length;h++)l(o.childNodes[h],a,o.nodeName)}}(r),function(e){e.OsmTileSource=function(i,n,s,l,o){var a;e.isPlainObject(i)?a=i:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!a.width||!a.height)&&(a.width=65572864,a.height=65572864),a.tileSize||(a.tileSize=256,a.tileOverlap=0),a.tilesUrl||(a.tilesUrl="http://tile.openstreetmap.org/"),a.minLevel=8,e.TileSource.apply(this,[a])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="openstreetmaps"},configure:function(i,n){return i},getTileUrl:function(i,n,s){return this.tilesUrl+(i-8)+"/"+n+"/"+s+".png"}})}(r),function(e){e.TmsTileSource=function(i,n,s,l,o){var a;e.isPlainObject(i)?a=i:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var c=Math.ceil(a.width/256)*256,h=Math.ceil(a.height/256)*256,g;c>h?g=c/256:g=h/256,a.maxLevel=Math.ceil(Math.log(g)/Math.log(2))-1,a.tileSize=256,a.width=c,a.height=h,e.TileSource.apply(this,[a])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="tiledmapservice"},configure:function(i,n){return i},getTileUrl:function(i,n,s){var l=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+n+"/"+(l-s)+".png"}})}(r),function(e){e.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var n={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(n.x,10)>i.tileSize||parseInt(n.y,10)>i.tileSize;)n.x=Math.floor(n.x/2),n.y=Math.floor(n.y/2),i.imageSizes.push({x:n.x,y:n.y}),i.gridSize.push(this._getGridSize(n.x,n.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,r.TileSource.apply(this,[i])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(i,n,s){return{x:Math.ceil(i/s),y:Math.ceil(n/s)}},_calculateAbsoluteTileNumber:function(i,n,s){for(var l=0,o={},a=0;a<i;a++)o=this.gridSize[a],l+=o.x*o.y;return o=this.gridSize[i],l+=o.x*s+n,l},supports:function(i,n){return i.type&&i.type==="zoomifytileservice"},configure:function(i,n){return i},getTileUrl:function(i,n,s){var l=0,o=this._calculateAbsoluteTileNumber(i,n,s);return l=Math.floor(o/256),this.tilesUrl+"TileGroup"+l+"/"+i+"-"+n+"-"+s+"."+this.fileFormat}})}(r),function(e){e.LegacyTileSource=function(l){var o,a,c;e.isArray(l)&&(o={type:"legacy-image-pyramid",levels:l}),o.levels=i(o.levels),o.levels.length>0?(a=o.levels[o.levels.length-1].width,c=o.levels[o.levels.length-1].height):(a=0,c=0,e.console.error("No supported image formats found")),e.extend(!0,o,{width:a,height:c,tileSize:Math.max(c,a),tileOverlap:0,minLevel:0,maxLevel:o.levels.length>0?o.levels.length-1:0}),e.TileSource.apply(this,[o]),this.levels=o.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(l,o){return l.type&&l.type==="legacy-image-pyramid"||l.documentElement&&l.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(l,o){var a;return e.isPlainObject(l)?a=s(this,l):a=n(this,l),a},getLevelScale:function(l){var o=NaN;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(o=this.levels[l].width/this.levels[this.maxLevel].width),o},getNumTiles:function(l){var o=this.getLevelScale(l);return o?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(l,o,a){var c=null;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(c=this.levels[l].url),c}});function i(l){var o=[],a,c;for(c=0;c<l.length;c++)a=l[c],a.height&&a.width&&a.url?o.push({url:a.url,width:Number(a.width),height:Number(a.height)}):e.console.error("Unsupported image format: %s",a.url?a.url:"<no URL>");return o.sort(function(h,g){return h.height-g.height})}function n(l,o){if(!o||!o.documentElement)throw new Error(e.getString("Errors.Xml"));var a=o.documentElement,c=a.tagName,h=null,g=[],m,b;if(c==="image")try{for(h={type:a.getAttribute("type"),levels:[]},g=a.getElementsByTagName("level"),b=0;b<g.length;b++)m=g[b],h.levels.push({url:m.getAttribute("url"),width:parseInt(m.getAttribute("width"),10),height:parseInt(m.getAttribute("height"),10)});return s(l,h)}catch(x){throw x instanceof Error?x:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(c==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(c==="error")throw new Error("Error: "+o)}throw new Error("Unknown element "+c)}function s(l,o){return o.levels}}(r),function(e){e.ImageTileSource=function(i){i=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),e.TileSource.apply(this,[i])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="image"},configure:function(i,n){return i},getImageInfo:function(i){var n=this._image=new Image,s=this;this.crossOriginPolicy&&(n.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(n.useCredentials=this.ajaxWithCredentials),e.addEvent(n,"load",function(){s.width=n.naturalWidth,s.height=n.naturalHeight,s.aspectRatio=s.width/s.height,s.dimensions=new e.Point(s.width,s.height),s._tileWidth=s.width,s._tileHeight=s.height,s.tileOverlap=0,s.minLevel=0,s.levels=s._buildLevels(),s.maxLevel=s.levels.length-1,s.ready=!0,s.raiseEvent("ready",{tileSource:s})}),e.addEvent(n,"error",function(){s.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),n.src=i},getLevelScale:function(i){var n=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(n=this.levels[i].width/this.levels[this.maxLevel].width),n},getNumTiles:function(i){var n=this.getLevelScale(i);return n?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(i,n,s){var l=null;return i>=this.minLevel&&i<=this.maxLevel&&(l=this.levels[i].url),l},getContext2D:function(i,n,s){var l=null;return i>=this.minLevel&&i<=this.maxLevel&&(l=this.levels[i].context2D),l},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,i;var n=this._image.naturalWidth,s=this._image.naturalHeight,l=document.createElement("canvas"),o=l.getContext("2d");if(l.width=n,l.height=s,o.drawImage(this._image,0,0,n,s),i[0].context2D=o,delete this._image,e.isCanvasTainted(l))return i;for(;n>=2&&s>=2;){n=Math.floor(n/2),s=Math.floor(s/2);var a=document.createElement("canvas"),c=a.getContext("2d");a.width=n,a.height=s,c.drawImage(l,0,0,n,s),i.splice(0,0,{context2D:c,width:n,height:s}),l=a,o=c}return i},_freeupCanvasMemory:function(){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0}})}(r),function(e){e.TileSourceCollection=function(i,n,s,l){e.console.error("TileSourceCollection is deprecated; use World instead")}}(r),function(e){e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(c){var h=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},c),this.element=c.element||e.makeNeutralElement("div"),c.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor===e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(g){g.insideElementPressed?(o(h,e.ButtonState.DOWN),h.raiseEvent("enter",{originalEvent:g.originalEvent})):g.buttonDownAny||o(h,e.ButtonState.HOVER)},focusHandler:function(g){h.tracker.enterHandler(g),h.raiseEvent("focus",{originalEvent:g.originalEvent})},leaveHandler:function(g){a(h,e.ButtonState.GROUP),g.insideElementPressed&&h.raiseEvent("exit",{originalEvent:g.originalEvent})},blurHandler:function(g){h.tracker.leaveHandler(g),h.raiseEvent("blur",{originalEvent:g.originalEvent})},pressHandler:function(g){o(h,e.ButtonState.DOWN),h.raiseEvent("press",{originalEvent:g.originalEvent})},releaseHandler:function(g){g.insideElementPressed&&g.insideElementReleased?(a(h,e.ButtonState.HOVER),h.raiseEvent("release",{originalEvent:g.originalEvent})):g.insideElementPressed?a(h,e.ButtonState.GROUP):o(h,e.ButtonState.HOVER)},clickHandler:function(g){g.quick&&h.raiseEvent("click",{originalEvent:g.originalEvent})},keyHandler:function(g){g.keyCode===13?(h.raiseEvent("click",{originalEvent:g.originalEvent}),h.raiseEvent("release",{originalEvent:g.originalEvent}),g.preventDefault=!0):g.preventDefault=!1}}),a(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){o(this,e.ButtonState.GROUP)},notifyGroupExit:function(){a(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(c){e.requestAnimationFrame(function(){n(c)})}function n(c){var h,g,m;c.shouldFade&&(h=e.now(),g=h-c.fadeBeginTime,m=1-g/c.fadeLength,m=Math.min(1,m),m=Math.max(0,m),c.imgGroup&&e.setElementOpacity(c.imgGroup,m,!0),m>0&&i(c))}function s(c){c.shouldFade=!0,c.fadeBeginTime=e.now()+c.fadeDelay,window.setTimeout(function(){i(c)},c.fadeDelay)}function l(c){c.shouldFade=!1,c.imgGroup&&e.setElementOpacity(c.imgGroup,1,!0)}function o(c,h){c.element.disabled||(h>=e.ButtonState.GROUP&&c.currentState===e.ButtonState.REST&&(l(c),c.currentState=e.ButtonState.GROUP),h>=e.ButtonState.HOVER&&c.currentState===e.ButtonState.GROUP&&(c.imgHover&&(c.imgHover.style.visibility=""),c.currentState=e.ButtonState.HOVER),h>=e.ButtonState.DOWN&&c.currentState===e.ButtonState.HOVER&&(c.imgDown&&(c.imgDown.style.visibility=""),c.currentState=e.ButtonState.DOWN))}function a(c,h){c.element.disabled||(h<=e.ButtonState.HOVER&&c.currentState===e.ButtonState.DOWN&&(c.imgDown&&(c.imgDown.style.visibility="hidden"),c.currentState=e.ButtonState.HOVER),h<=e.ButtonState.GROUP&&c.currentState===e.ButtonState.HOVER&&(c.imgHover&&(c.imgHover.style.visibility="hidden"),c.currentState=e.ButtonState.GROUP),h<=e.ButtonState.REST&&c.currentState===e.ButtonState.GROUP&&(s(c),c.currentState=e.ButtonState.REST))}}(r),function(e){e.ButtonGroup=function(i){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var n=this.buttons.concat([]),s=this,l;if(this.element=i.element||e.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",l=0;l<n.length;l++)this.element.appendChild(n[l].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(o){var a;for(a=0;a<s.buttons.length;a++)s.buttons[a].notifyGroupEnter()},leaveHandler:function(o){var a;if(!o.insideElementPressed)for(a=0;a<s.buttons.length;a++)s.buttons[a].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}}(r),function(e){e.Rect=function(i,n,s,l,o){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0,this.width=typeof s=="number"?s:0,this.height=typeof l=="number"?l:0,this.degrees=typeof o=="number"?o:0,this.degrees=e.positiveModulo(this.degrees,360);var a,c;this.degrees>=270?(a=this.getTopRight(),this.x=a.x,this.y=a.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=270):this.degrees>=180?(a=this.getBottomRight(),this.x=a.x,this.y=a.y,this.degrees-=180):this.degrees>=90&&(a=this.getBottomLeft(),this.x=a.x,this.y=a.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=90)},e.Rect.fromSummits=function(i,n,s){var l=i.distanceTo(n),o=i.distanceTo(s),a=n.minus(i),c=Math.atan(a.y/a.x);return a.x<0?c+=Math.PI:a.y<0&&(c+=2*Math.PI),new e.Rect(i.x,i.y,l,o,c/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(i){return i instanceof e.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new e.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new e.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var n=this.getBoundingBox(),s=i.getBoundingBox(),l=Math.min(n.x,s.x),o=Math.min(n.y,s.y),a=Math.max(n.x+n.width,s.x+s.width),c=Math.max(n.y+n.height,s.y+s.height);return new e.Rect(l,o,a-l,c-o)},intersection:function(i){var n=1e-10,s=[],l=this.getTopLeft();i.containsPoint(l,n)&&s.push(l);var o=this.getTopRight();i.containsPoint(o,n)&&s.push(o);var a=this.getBottomLeft();i.containsPoint(a,n)&&s.push(a);var c=this.getBottomRight();i.containsPoint(c,n)&&s.push(c);var h=i.getTopLeft();this.containsPoint(h,n)&&s.push(h);var g=i.getTopRight();this.containsPoint(g,n)&&s.push(g);var m=i.getBottomLeft();this.containsPoint(m,n)&&s.push(m);var b=i.getBottomRight();this.containsPoint(b,n)&&s.push(b);for(var x=this._getSegments(),P=i._getSegments(),S=0;S<x.length;S++)for(var O=x[S],d=0;d<P.length;d++){var w=P[d],H=M(O[0],O[1],w[0],w[1]);H&&s.push(H)}function M(te,fe,ue,_e){var le=fe.minus(te),ae=_e.minus(ue),ne=-ae.x*le.y+le.x*ae.y;if(ne===0)return null;var Te=(le.x*(te.y-ue.y)-le.y*(te.x-ue.x))/ne,$=(ae.x*(te.y-ue.y)-ae.y*(te.x-ue.x))/ne;return-n<=Te&&Te<=1-n&&-n<=$&&$<=1-n?new e.Point(te.x+$*le.x,te.y+$*le.y):null}if(s.length===0)return null;for(var I=s[0].x,V=s[0].x,q=s[0].y,K=s[0].y,j=1;j<s.length;j++){var oe=s[j];oe.x<I&&(I=oe.x),oe.x>V&&(V=oe.x),oe.y<q&&(q=oe.y),oe.y>K&&(K=oe.y)}return new e.Rect(I,q,V-I,K-q)},_getSegments:function(){var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),l=this.getBottomRight();return[[i,n],[n,l],[l,s],[s,i]]},rotate:function(i,n){if(i=e.positiveModulo(i,360),i===0)return this.clone();n=n||this.getCenter();var s=this.getTopLeft().rotate(i,n),l=this.getTopRight().rotate(i,n),o=l.minus(s);o=o.apply(function(c){var h=1e-15;return Math.abs(c)<h?0:c});var a=Math.atan(o.y/o.x);return o.x<0?a+=Math.PI:o.y<0&&(a+=2*Math.PI),new e.Rect(s.x,s.y,this.width,this.height,a/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),l=this.getBottomRight(),o=Math.min(i.x,n.x,s.x,l.x),a=Math.max(i.x,n.x,s.x,l.x),c=Math.min(i.y,n.y,s.y,l.y),h=Math.max(i.y,n.y,s.y,l.y);return new e.Rect(o,c,a-o,h-c)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),n=Math.floor(i.x),s=Math.floor(i.y),l=Math.ceil(i.width+i.x-n),o=Math.ceil(i.height+i.y-s);return new e.Rect(n,s,l,o)},containsPoint:function(i,n){n=n||0;var s=this.getTopLeft(),l=this.getTopRight(),o=this.getBottomLeft(),a=l.minus(s),c=o.minus(s);return(i.x-s.x)*a.x+(i.y-s.y)*a.y>=-n&&(i.x-l.x)*a.x+(i.y-l.y)*a.y<=n&&(i.x-s.x)*c.x+(i.y-s.y)*c.y>=-n&&(i.x-o.x)*c.x+(i.y-o.y)*c.y<=n},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(r),function(e){var i={};e.ReferenceStrip=function(m){var b=this,x=m.viewer,P=e.getElementSize(x.element),S,O,d;for(m.id||(m.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=m.id,this.element.className="referencestrip"),m=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},m,{element:this.element}),e.extend(this,m),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,O=this.element.style,O.marginTop="0px",O.marginRight="0px",O.marginBottom="0px",O.marginLeft="0px",O.left="0px",O.bottom="0px",O.border="0px",O.background="#000",O.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=x,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,n),dragHandler:e.delegate(this,s),scrollHandler:e.delegate(this,l),enterHandler:e.delegate(this,a),leaveHandler:e.delegate(this,c),keyDownHandler:e.delegate(this,h),keyHandler:e.delegate(this,g),preProcessEventHandler:function(w){w.eventType==="wheel"&&(w.preventDefault=!0)}}),m.width&&m.height?(this.element.style.width=m.width+"px",this.element.style.height=m.height+"px",x.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):m.scroll==="horizontal"?(this.element.style.width=P.x*m.sizeRatio*x.tileSources.length+12*x.tileSources.length+"px",this.element.style.height=P.y*m.sizeRatio+"px",x.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=P.y*m.sizeRatio*x.tileSources.length+12*x.tileSources.length+"px",this.element.style.width=P.x*m.sizeRatio+"px",x.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=P.x*this.sizeRatio+8,this.panelHeight=P.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},d=0;d<x.tileSources.length;d++)S=e.makeNeutralElement("div"),S.id=this.element.id+"-"+d,S.style.width=b.panelWidth+"px",S.style.height=b.panelHeight+"px",S.style.display="inline",S.style.float="left",S.style.cssFloat="left",S.style.styleFloat="left",S.style.padding="2px",e.setElementTouchActionNone(S),e.setElementPointerEventsNone(S),this.element.appendChild(S),S.activePanel=!1,this.panels.push(S);o(this,this.scroll==="vertical"?P.y:P.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(m){var b=this.element.querySelector("#"+this.element.id+"-"+m),x=e.getElementSize(this.viewer.canvas),P=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),O=-Number(this.element.style.marginLeft.replace("px","")),d=-Number(this.element.style.marginTop.replace("px","")),w;this.currentSelected!==b&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=b,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(w=Number(m)*(this.panelWidth+3),w>O+x.x-this.panelWidth?(w=Math.min(w,P-x.x),this.element.style.marginLeft=-w+"px",o(this,x.x,-w)):w<O&&(w=Math.max(0,w-x.x/2),this.element.style.marginLeft=-w+"px",o(this,x.x,-w))):(w=Number(m)*(this.panelHeight+3),w>d+x.y-this.panelHeight?(w=Math.min(w,S-x.y),this.element.style.marginTop=-w+"px",o(this,x.y,-w)):w<d&&(w=Math.max(0,w-x.y/2),this.element.style.marginTop=-w+"px",o(this,x.y,-w))),this.currentPage=m,a.call(this,{eventSource:this.tracker}))},update:function(){return i[this.id].animating?(e.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var m in this.miniViewers)this.miniViewers[m].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function n(m){if(m.quick){var b;this.scroll==="horizontal"?b=Math.floor(m.position.x/this.panelWidth):b=Math.floor(m.position.y/this.panelHeight),this.viewer.goToPage(b)}this.element.focus()}function s(m){if(this.dragging=!0,this.element){var b=Number(this.element.style.marginLeft.replace("px","")),x=Number(this.element.style.marginTop.replace("px","")),P=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),O=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-m.delta.x>0?b>-(P-O.x)&&(this.element.style.marginLeft=b+m.delta.x*2+"px",o(this,O.x,b+m.delta.x*2)):-m.delta.x<0&&b<0&&(this.element.style.marginLeft=b+m.delta.x*2+"px",o(this,O.x,b+m.delta.x*2)):-m.delta.y>0?x>-(S-O.y)&&(this.element.style.marginTop=x+m.delta.y*2+"px",o(this,O.y,x+m.delta.y*2)):-m.delta.y<0&&x<0&&(this.element.style.marginTop=x+m.delta.y*2+"px",o(this,O.y,x+m.delta.y*2))}}function l(m){if(this.element){var b=Number(this.element.style.marginLeft.replace("px","")),x=Number(this.element.style.marginTop.replace("px","")),P=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),O=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?m.scroll>0?b>-(P-O.x)&&(this.element.style.marginLeft=b-m.scroll*60+"px",o(this,O.x,b-m.scroll*60)):m.scroll<0&&b<0&&(this.element.style.marginLeft=b-m.scroll*60+"px",o(this,O.x,b-m.scroll*60)):m.scroll<0?x>O.y-S&&(this.element.style.marginTop=x+m.scroll*60+"px",o(this,O.y,x+m.scroll*60)):m.scroll>0&&x<0&&(this.element.style.marginTop=x+m.scroll*60+"px",o(this,O.y,x+m.scroll*60)),m.preventDefault=!0}}function o(m,b,x){var P,S,O,d,w,H;for(m.scroll==="horizontal"?P=m.panelWidth:P=m.panelHeight,S=Math.ceil(b/P)+5,O=Math.ceil((Math.abs(x)+b)/P)+1,S=O-S,S=S<0?0:S,w=S;w<O&&w<m.panels.length;w++)if(H=m.panels[w],!H.activePanel){var M,I=m.viewer.tileSources[w];I.referenceStripThumbnailUrl?M={type:"image",url:I.referenceStripThumbnailUrl}:M=I,d=new e.Viewer({id:H.id,tileSources:[M],element:H,navigatorSizeRatio:m.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:m.viewer.loadTilesWithAjax,ajaxHeaders:m.viewer.ajaxHeaders,useCanvas:m.useCanvas}),e.setElementPointerEventsNone(d.canvas),e.setElementPointerEventsNone(d.container),d.innerTracker.setTracking(!1),d.outerTracker.setTracking(!1),m.miniViewers[H.id]=d,H.activePanel=!0}}function a(m){var b=m.eventSource.element;this.scroll==="horizontal"?b.style.marginBottom="0px":b.style.marginLeft="0px"}function c(m){var b=m.eventSource.element;this.scroll==="horizontal"?b.style.marginBottom="-"+e.getElementSize(b).y/2+"px":b.style.marginLeft="-"+e.getElementSize(b).x/2+"px"}function h(m){if(!m.ctrl&&!m.alt&&!m.meta)switch(m.keyCode){case 38:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 40:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 37:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 39:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;default:m.preventDefault=!1;break}else m.preventDefault=!1}function g(m){if(!m.ctrl&&!m.alt&&!m.meta)switch(m.keyCode){case 61:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 45:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 48:case 119:case 87:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 115:case 83:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 97:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 100:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;default:m.preventDefault=!1;break}else m.preventDefault=!1}}(r),function(e){e.DisplayRect=function(i,n,s,l,o,a){e.Rect.apply(this,[i,n,s,l]),this.minLevel=o,this.maxLevel=a},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(r),function(e){e.Spring=function(n){var s=arguments;typeof n!="object"&&(n={initial:s.length&&typeof s[0]=="number"?s[0]:void 0,springStiffness:s.length>1?s[1].springStiffness:5,animationTime:s.length>1?s[1].animationTime:1.5}),e.console.assert(typeof n.springStiffness=="number"&&n.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert(typeof n.animationTime=="number"&&n.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),n.exponential&&(this._exponential=!0,delete n.exponential),e.extend(!0,this,n),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(n){e.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=n,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(n){e.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=n,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(n){this.start.value+=n,this.target.value+=n,this._exponential&&(e.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(n){this._exponential=n,this._exponential&&(e.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=e.now();var n,s;this._exponential?(n=this.start._logValue,s=this.target._logValue):(n=this.start.value,s=this.target.value);var l=this.current.time>=this.target.time?s:n+(s-n)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),o=this.current.value;return this._exponential?this.current.value=Math.exp(l):this.current.value=l,o!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(n,s){return(1-Math.exp(n*-s))/(1-Math.exp(-n))}}(r),function(e){function i(s){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},s),this.image=null}i.prototype={errorMsg:null,start:function(){var s=this,l=this.abort;this.image=new Image,this.image.onload=function(){s.finish(!0)},this.image.onabort=this.image.onerror=function(){s.errorMsg="Image load aborted",s.finish(!1)},this.jobId=window.setTimeout(function(){s.errorMsg="Image load exceeded timeout ("+s.timeout+" ms)",s.finish(!1)},this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(o){var a;try{a=new window.Blob([o.response])}catch(m){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(m.name==="TypeError"&&c){var h=new c;h.append(o.response),a=h.getBlob()}}a.size===0&&(s.errorMsg="Empty image response.",s.finish(!1));var g=(window.URL||window.webkitURL).createObjectURL(a);s.image.src=g},error:function(o){s.errorMsg="Image load aborted - XHR error",s.finish(!1)}}),this.abort=function(){s.request.abort(),typeof l=="function"&&l()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(s){this.image.onload=this.image.onerror=this.image.onabort=null,s||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(s){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},s)},e.ImageLoader.prototype={addJob:function(s){var l=this,o=function(h){n(l,h,s.callback)},a={src:s.src,loadWithAjax:s.loadWithAjax,ajaxHeaders:s.loadWithAjax?s.ajaxHeaders:null,crossOriginPolicy:s.crossOriginPolicy,ajaxWithCredentials:s.ajaxWithCredentials,callback:o,abort:s.abort,timeout:this.timeout},c=new i(a);!this.jobLimit||this.jobsInProgress<this.jobLimit?(c.start(),this.jobsInProgress++):this.jobQueue.push(c)},clear:function(){for(var s=0;s<this.jobQueue.length;s++){var l=this.jobQueue[s];typeof l.abort=="function"&&l.abort()}this.jobQueue=[]}};function n(s,l,o){var a;s.jobsInProgress--,(!s.jobLimit||s.jobsInProgress<s.jobLimit)&&s.jobQueue.length>0&&(a=s.jobQueue.shift(),a.start(),s.jobsInProgress++),o(l.image,l.errorMsg,l.request)}}(r),function(e){e.Tile=function(i,n,s,l,o,a,c,h,g,m){this.level=i,this.x=n,this.y=s,this.bounds=l,this.sourceBounds=m,this.exists=o,this.url=a,this.context2D=c,this.loadWithAjax=h,this.ajaxHeaders=g,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(i){if(!this.cacheImageRecord){e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==i&&i.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),e.setElementOpacity(this.element,this.opacity)},drawCanvas:function(i,n,s,l){var o=this.position.times(e.pixelDensityRatio),a=this.size.times(e.pixelDensityRatio),c;if(!this.context2D&&!this.cacheImageRecord){e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(c=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!c){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}i.save(),i.globalAlpha=this.opacity,typeof s=="number"&&s!==1&&(o=o.times(s),a=a.times(s)),l instanceof e.Point&&(o=o.plus(l)),i.globalAlpha===1&&this._hasTransparencyChannel()&&i.clearRect(o.x,o.y,a.x,a.y),n({context:i,tile:this,rendered:c});var h,g;this.sourceBounds?(h=Math.min(this.sourceBounds.width,c.canvas.width),g=Math.min(this.sourceBounds.height,c.canvas.height)):(h=c.canvas.width,g=c.canvas.height),i.translate(o.x+a.x/2,0),this.flipped&&i.scale(-1,1),i.drawImage(c.canvas,0,0,h,g,-a.x/2,o.y,a.x,a.y),i.restore()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,n,s){var l=Math.max(1,Math.ceil((s.x-n.x)/2)),o=Math.max(1,Math.ceil((s.y-n.y)/2));return new e.Point(l,o).minus(this.position.times(e.pixelDensityRatio).times(i||1).apply(function(a){return a%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(r),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(i,n,s){var l;e.isPlainObject(i)?l=i:l={element:i,location:n,placement:s},this.element=l.element,this.style=l.element.style,this._init(l)},e.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?e.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,n){var s=e.Placement.properties[this.placement];s&&(s.isHorizontallyCentered?i.x-=n.x/2:s.isRight&&(i.x-=n.x),s.isVerticallyCentered?i.y-=n.y/2:s.isBottom&&(i.y-=n.y))},destroy:function(){var i=this.element,n=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(n.display="none",document.body.appendChild(i))),this.onDraw=null,n.top="",n.left="",n.position="",this.width!==null&&(n.width=""),this.height!==null&&(n.height="");var s=e.getCssPropertyWithVendorPrefix("transformOrigin"),l=e.getCssPropertyWithVendorPrefix("transform");s&&l&&(n[s]="",n[l]="")},drawHTML:function(i,n){var s=this.element;s.parentNode!==i&&(s.prevElementParent=s.parentNode,s.prevNextSibling=s.nextSibling,i.appendChild(s),this.style.position="absolute",this.size=e.getElementSize(s));var l=this._getOverlayPositionAndSize(n),o=l.position,a=this.size=l.size,c=l.rotate;if(this.onDraw)this.onDraw(o,a,this.element);else{var h=this.style;h.left=o.x+"px",h.top=o.y+"px",this.width!==null&&(h.width=a.x+"px"),this.height!==null&&(h.height=a.y+"px");var g=e.getCssPropertyWithVendorPrefix("transformOrigin"),m=e.getCssPropertyWithVendorPrefix("transform");g&&m&&(c?(h[g]=this._getTransformOrigin(),h[m]="rotate("+c+"deg)"):(h[g]="",h[m]="")),h.display="block"}},_getOverlayPositionAndSize:function(i){var n=i.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(i);this.adjust(n,s);var l=0;if(i.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var o=new e.Rect(n.x,n.y,s.x,s.y),a=this._getBoundingBox(o,i.degrees);n=a.getTopLeft(),s=a.getSize()}else l=i.degrees;return{position:n,size:s,rotate:l}},_getSizeInPixels:function(i){var n=this.size.x,s=this.size.y;if(this.width!==null||this.height!==null){var l=i.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);this.width!==null&&(n=l.x),this.height!==null&&(s=l.y)}if(this.checkResize&&(this.width===null||this.height===null)){var o=this.size=e.getElementSize(this.element);this.width===null&&(n=o.x),this.height===null&&(s=o.y)}return new e.Point(n,s)},_getBoundingBox:function(i,n){var s=this._getPlacementPoint(i);return i.rotate(n,s).getBoundingBox()},_getPlacementPoint:function(i){var n=new e.Point(i.x,i.y),s=e.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?n.x+=i.width/2:s.isRight&&(n.x+=i.width),s.isVerticallyCentered?n.y+=i.height/2:s.isBottom&&(n.y+=i.height)),n},_getTransformOrigin:function(){var i="",n=e.Placement.properties[this.placement];return n&&(n.isLeft?i="left":n.isRight&&(i="right"),n.isTop?i+=" top":n.isBottom&&(i+=" bottom")),i},update:function(i,n){var s=e.isPlainObject(i)?i:{location:i,placement:n};this._init({location:s.location||this.location,placement:s.placement!==void 0?s.placement:this.placement,onDraw:s.onDraw||this.onDraw,checkResize:s.checkResize||this.checkResize,width:s.width!==void 0?s.width:this.width,height:s.height!==void 0?s.height:this.height,rotationMode:s.rotationMode||this.rotationMode})},getBounds:function(i){e.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var n=this.width,s=this.height;if(n===null||s===null){var l=i.deltaPointsFromPixelsNoRotate(this.size,!0);n===null&&(n=l.x),s===null&&(s=l.y)}var o=this.location.clone();return this.adjust(o,new e.Point(n,s)),this._adjustBoundsForRotation(i,new e.Rect(o.x,o.y,n,s))},_adjustBoundsForRotation:function(i,n){if(!i||i.degrees===0||this.rotationMode===e.OverlayRotationMode.EXACT)return n;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return n;var s=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new e.Rect(s.position.x,s.position.y,s.size.x,s.size.y))}return n.rotate(-i.degrees,this._getPlacementPoint(n))}}}(r),function(e){e.Drawer=function(i){e.console.assert(i.viewer,"[Drawer] options.viewer is required");var n=arguments;if(e.isPlainObject(i)||(i={source:n[0],viewport:n[1],element:n[2]}),e.console.assert(i.viewport,"[Drawer] options.viewport is required"),e.console.assert(i.element,"[Drawer] options.element is required"),i.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor=typeof i.debugGridColor=="string"?[i.debugGridColor]:i.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,i.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=e.getElement(i.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var s=this._calculateCanvasSize();this.canvas.width=s.x,this.canvas.height=s.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(i,n,s,l){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,n,s,l),this},updateOverlay:function(i,n,s){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,n,s),this},removeOverlay:function(i){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var n=this.viewport.pixelFromPointNoRotate(i,!0);return new e.Point(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},clipWithPolygons:function(i,n){if(this.useCanvas){var s=this._getContext(n);s.beginPath(),i.forEach(function(l){l.forEach(function(o,a){s[a===0?"moveTo":"lineTo"](o.x,o.y)})}),s.clip()}},setOpacity:function(i){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var n=this.viewer.world,s=0;s<n.getItemCount();s++)n.getItemAt(s).setOpacity(i);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,n=0,s=0;s<i.getItemCount();s++){var l=i.getItemAt(s).getOpacity();l>n&&(n=l)}return n},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var i=this._calculateCanvasSize();if((this.canvas.width!==i.x||this.canvas.height!==i.y)&&(this.canvas.width=i.x,this.canvas.height=i.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var n=this._calculateSketchCanvasSize();this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(i,n){if(this.useCanvas){var s=this._getContext(i);if(n)s.clearRect(n.x,n.y,n.width,n.height);else{var l=s.canvas;s.clearRect(0,0,l.width,l.height)}}},viewportToDrawerRectangle:function(i){var n=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),s=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new e.Rect(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio,s.x*e.pixelDensityRatio,s.y*e.pixelDensityRatio)},drawTile:function(i,n,s,l,o){if(e.console.assert(i,"[Drawer.drawTile] tile is required"),e.console.assert(n,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var a=this._getContext(s);l=l||1,i.drawCanvas(a,n,l,o)}else i.drawHTML(this.canvas)},_getContext:function(i){var n=this.context;if(i){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var s=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=s.x,this.sketchCanvas.height=s.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var l=this;this.viewer.addHandler("rotate",function o(){if(l.viewport.getRotation()!==0){l.viewer.removeHandler("rotate",o);var a=l._calculateSketchCanvasSize();l.sketchCanvas.width=a.x,l.sketchCanvas.height=a.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}n=this.sketchContext}return n},saveContext:function(i){this.useCanvas&&this._getContext(i).save()},restoreContext:function(i){this.useCanvas&&this._getContext(i).restore()},setClip:function(i,n){if(this.useCanvas){var s=this._getContext(n);s.beginPath(),s.rect(i.x,i.y,i.width,i.height),s.clip()}},drawRectangle:function(i,n,s){if(this.useCanvas){var l=this._getContext(s);l.save(),l.fillStyle=n,l.fillRect(i.x,i.y,i.width,i.height),l.restore()}},blendSketch:function(i,n,s,l){var o=i;if(e.isPlainObject(o)||(o={opacity:i,scale:n,translate:s,compositeOperation:l}),!(!this.useCanvas||!this.sketchCanvas)){i=o.opacity,l=o.compositeOperation;var a=o.bounds;if(this.context.save(),this.context.globalAlpha=i,l&&(this.context.globalCompositeOperation=l),a)a.x<0&&(a.width+=a.x,a.x=0),a.x+a.width>this.canvas.width&&(a.width=this.canvas.width-a.x),a.y<0&&(a.height+=a.y,a.y=0),a.y+a.height>this.canvas.height&&(a.height=this.canvas.height-a.y),this.context.drawImage(this.sketchCanvas,a.x,a.y,a.width,a.height,a.x,a.y,a.width,a.height);else{n=o.scale||1,s=o.translate;var c=s instanceof e.Point?s:new e.Point(0,0),h=0,g=0;if(s){var m=this.sketchCanvas.width-this.canvas.width,b=this.sketchCanvas.height-this.canvas.height;h=Math.round(m/2),g=Math.round(b/2)}this.context.drawImage(this.sketchCanvas,c.x-h*n,c.y-g*n,(this.canvas.width+2*h)*n,(this.canvas.height+2*g)*n,-h,-g,this.canvas.width+2*h,this.canvas.height+2*g)}this.context.restore()}},drawDebugInfo:function(i,n,s,l){if(this.useCanvas){var o=this.viewer.world.getIndexOfItem(l)%this.debugGridColor.length,a=this.context;a.save(),a.lineWidth=2*e.pixelDensityRatio,a.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",a.strokeStyle=this.debugGridColor[o],a.fillStyle=this.debugGridColor[o],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),l.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:l.getRotation(!0),point:l.viewport.pixelFromPointNoRotate(l._getRotationPoint(!0),!0)}),l.viewport.degrees===0&&l.getRotation(!0)%360===0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip(),a.strokeRect(i.position.x*e.pixelDensityRatio,i.position.y*e.pixelDensityRatio,i.size.x*e.pixelDensityRatio,i.size.y*e.pixelDensityRatio);var c=(i.position.x+i.size.x/2)*e.pixelDensityRatio,h=(i.position.y+i.size.y/2)*e.pixelDensityRatio;a.translate(c,h),a.rotate(Math.PI/180*-this.viewport.degrees),a.translate(-c,-h),i.x===0&&i.y===0&&(a.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*e.pixelDensityRatio,(i.position.y-30)*e.pixelDensityRatio),a.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*e.pixelDensityRatio,(i.position.y-20)*e.pixelDensityRatio)),a.fillText("Level: "+i.level,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+20)*e.pixelDensityRatio),a.fillText("Column: "+i.x,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+30)*e.pixelDensityRatio),a.fillText("Row: "+i.y,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+40)*e.pixelDensityRatio),a.fillText("Order: "+s+" of "+n,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+50)*e.pixelDensityRatio),a.fillText("Size: "+i.size.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+60)*e.pixelDensityRatio),a.fillText("Position: "+i.position.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+70)*e.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),l.getRotation(!0)%360!==0&&this._restoreRotationChanges(),l.viewport.degrees===0&&l.getRotation(!0)%360===0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip(),a.restore()}},debugRect:function(i){if(this.useCanvas){var n=this.context;n.save(),n.lineWidth=2*e.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,i.width*e.pixelDensityRatio,i.height*e.pixelDensityRatio),n.restore()}},setImageSmoothingEnabled:function(i){this.useCanvas&&(this._imageSmoothingEnabled=i,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(i){i.msImageSmoothingEnabled=this._imageSmoothingEnabled,i.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var n=this._getContext(i).canvas;return new e.Point(n.width,n.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var n=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.save(),s.translate(n.x,n.y),this.viewer.viewport.flipped?(s.rotate(Math.PI/180*-i.degrees),s.scale(-1,1)):s.rotate(Math.PI/180*i.degrees),s.translate(-n.x,-n.y)},_flip:function(i){i=i||{};var n=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.translate(n.x,0),s.scale(-1,1),s.translate(-n.x,0)},_restoreRotationChanges:function(i){var n=this._getContext(i);n.restore()},_calculateCanvasSize:function(){var i=e.pixelDensityRatio,n=this.viewport.getContainerSize();return{x:Math.round(n.x*i),y:Math.round(n.y*i)}},_calculateSketchCanvasSize:function(){var i=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return i;var n=Math.ceil(Math.sqrt(i.x*i.x+i.y*i.y));return{x:n,y:n}}}}(r),function(e){e.Viewport=function(i){var n=arguments;n.length&&n[0]instanceof e.Point&&(i={containerSize:n[0],contentSize:n[1],config:n[2]}),i.config&&(e.extend(!0,i,i.config),delete i.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},i),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(i){return e.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(i instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,n){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,n)},_setContentBounds:function(i,n){e.console.assert(i,"[Viewport._setContentBounds] bounds is required"),e.console.assert(i instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(n),this._contentBounds=i.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(n),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:n,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),n;return this.homeFillsViewer?n=i>=1?i:1:n=i>=1?1:i,n/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),n=1/this.getHomeZoom(),s=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-s/2,n,s)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),n=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return n},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(i){e.console.assert(e.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation())},getBoundsNoRotate:function(i){var n=this.getCenter(i),s=1/this.getZoom(i),l=s/this.getAspectRatio();return new e.Rect(n.x-s/2,n.y-l/2,s,l)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var n=this.getBoundsNoRotate(i),s=this._containerInnerSize.x*this.getZoom(i);return n.x-=this._margins.left/s,n.y-=this._margins.top/s,n.width+=(this._margins.left+this._margins.right)/s,n.height+=(this._margins.top+this._margins.bottom)/s,n},getCenter:function(i){var n=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),l,o,a,c,h,g,m,b;return i?n:this.zoomPoint?(l=this.pixelFromPoint(this.zoomPoint,!0),o=this.getZoom(),a=1/o,c=a/this.getAspectRatio(),h=new e.Rect(n.x-a/2,n.y-c/2,a,c),g=this._pixelFromPoint(this.zoomPoint,h),m=g.minus(l),b=m.divide(this._containerInnerSize.x*o),s.plus(b)):s},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var n=new e.Rect(i.x,i.y,i.width,i.height);if(!this.wrapHorizontal){var s=this.visibilityRatio*n.width,l=n.x+n.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,a=this._contentBoundsNoRotate.x-l+s,c=o-n.x-s;s>this._contentBoundsNoRotate.width?n.x+=(a+c)/2:c<0?n.x+=c:a>0&&(n.x+=a)}if(!this.wrapVertical){var h=this.visibilityRatio*n.height,g=n.y+n.height,m=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,b=this._contentBoundsNoRotate.y-g+h,x=m-n.y-h;h>this._contentBoundsNoRotate.height?n.y+=(b+x)/2:x<0?n.y+=x:b>0&&(n.y+=b)}return n},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var n=this.getZoom(),s=this._applyZoomConstraints(n);n!==s&&this.zoomTo(s,this.zoomPoint,i);var l=this.getBoundsNoRotate(),o=this._applyBoundaryConstraints(l);return this._raiseConstraintsEvent(i),(l.x!==o.x||l.y!==o.y||i)&&this.fitBounds(o.rotate(-this.getRotation()),i),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,n){n=n||{};var s=n.immediately||!1,l=n.constraints||!1,o=this.getAspectRatio(),a=i.getCenter(),c=new e.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();c.getAspectRatio()>=o?c.height=c.width/o:c.width=c.height*o,c.x=a.x-c.width/2,c.y=a.y-c.height/2;var h=1/c.width;if(l){var g=c.getAspectRatio(),m=this._applyZoomConstraints(h);h!==m&&(h=m,c.width=1/h,c.x=a.x-c.width/2,c.height=c.width/g,c.y=a.y-c.height/2),c=this._applyBoundaryConstraints(c),a=c.getCenter(),this._raiseConstraintsEvent(s)}if(s)return this.panTo(a,!0),this.zoomTo(h,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var b=this.getBounds(),x=this.getZoom();if(x===0||Math.abs(h/x-1)<1e-8)return this.zoomTo(h,!0),this.panTo(a,s);c=c.rotate(-this.getRotation());var P=c.getTopLeft().times(h).minus(b.getTopLeft().times(x)).divide(h-x);return this.zoomTo(h,P,s)},fitBounds:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!1})},fitBoundsWithConstraints:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!0})},fitVertically:function(i){var n=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(n,i)},fitHorizontally:function(i){var n=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(n,i)},getConstrainedBounds:function(i){var n,s;return n=this.getBounds(i),s=this._applyBoundaryConstraints(n),s},panBy:function(i,n){var s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(i),n)},panTo:function(i,n){return n?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:n}),this},zoomBy:function(i,n,s){return this.zoomTo(this.zoomSpring.target.value*i,n,s)},zoomTo:function(i,n,s){var l=this;return this.zoomPoint=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,s?this._adjustCenterSpringsForZoomPoint(function(){l.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:n,immediately:s}),this},setRotation:function(i){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=e.positiveModulo(i,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i}),this)},getRotation:function(){return this.degrees},resize:function(i,n){var s=this.getBoundsNoRotate(),l=s,o;return this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),n&&(o=i.x/this.containerSize.x,l.width=s.width*o,l.height=l.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:n}),this.fitBounds(l,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var n=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,n},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var n=this.pixelFromPoint(this.zoomPoint,!0);i();var s=this.pixelFromPoint(this.zoomPoint,!0),l=s.minus(n),o=this.deltaPointsFromPixels(l,!0);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,n){return i.times(this._containerInnerSize.x*this.getZoom(n))},deltaPixelsFromPoints:function(i,n){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation()),n)},deltaPointsFromPixelsNoRotate:function(i,n){return i.divide(this._containerInnerSize.x*this.getZoom(n))},deltaPointsFromPixels:function(i,n){return this.deltaPointsFromPixelsNoRotate(i,n).rotate(-this.getRotation())},pixelFromPointNoRotate:function(i,n){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(n))},pixelFromPoint:function(i,n){return this._pixelFromPoint(i,this.getBoundsNoRotate(n))},_pixelFromPointNoRotate:function(i,n){return i.minus(n.getTopLeft()).times(this._containerInnerSize.x/n.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,n){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(),this.getCenter(!0)),n)},pointFromPixelNoRotate:function(i,n){var s=this.getBoundsNoRotate(n);return i.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/s.width).plus(s.getTopLeft())},pointFromPixel:function(i,n){return this.pointFromPixelNoRotate(i,n).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(i,n){var s=this._contentBoundsNoRotate.width;return new e.Point(i*this._contentSizeNoRotate.x/s,n*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(i,n){if(i instanceof e.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(s===1){var l=this.viewer.world.getItemAt(0);return l.viewportToImageCoordinates(i,n,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,n){var s=this._contentBoundsNoRotate.width;return new e.Point(i/this._contentSizeNoRotate.x*s,n/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(i,n){if(i instanceof e.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(s===1){var l=this.viewer.world.getItemAt(0);return l.imageToViewportCoordinates(i,n,!0)}}var o=this._imageToViewportDelta(i,n);return o.x+=this._contentBoundsNoRotate.x,o.y+=this._contentBoundsNoRotate.y,o},imageToViewportRectangle:function(i,n,s,l){var o=i;if(o instanceof e.Rect||(o=new e.Rect(i,n,s,l)),this.viewer){var a=this.viewer.world.getItemCount();if(a>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(a===1){var c=this.viewer.world.getItemAt(0);return c.imageToViewportRectangle(i,n,s,l,!0)}}var h=this.imageToViewportCoordinates(o.x,o.y),g=this._imageToViewportDelta(o.width,o.height);return new e.Rect(h.x,h.y,g.x,g.y,o.degrees)},viewportToImageRectangle:function(i,n,s,l){var o=i;if(o instanceof e.Rect||(o=new e.Rect(i,n,s,l)),this.viewer){var a=this.viewer.world.getItemCount();if(a>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(a===1){var c=this.viewer.world.getItemAt(0);return c.viewportToImageRectangle(i,n,s,l,!0)}}var h=this.viewportToImageCoordinates(o.x,o.y),g=this._viewportToImageDelta(o.width,o.height);return new e.Rect(h.x,h.y,g.x,g.y,o.degrees)},viewerElementToImageCoordinates:function(i){var n=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(n)},imageToViewerElementCoordinates:function(i){var n=this.imageToViewportCoordinates(i);return this.pixelFromPoint(n,!0)},windowToImageCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var n=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var n=this.imageToViewerElementCoordinates(i);return n.plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return e.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return e.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var n=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(n)},viewportToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var n=this.viewportToViewerElementCoordinates(i);return n.plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageZoom(i)}}var l=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,c=o/l*a;return i*c},imageToViewportZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportZoom(i)}}var l=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,c=l/o/a;return i*c},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)}}}(r),function(e){e.TiledImage=function(d){var w=this;e.console.assert(d.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(d.drawer,"[TiledImage] options.drawer is required"),e.console.assert(d.viewer,"[TiledImage] options.viewer is required"),e.console.assert(d.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(d.source,"[TiledImage] options.source is required"),e.console.assert(!d.clip||d.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=d.tileCache,delete d.tileCache,this._drawer=d.drawer,delete d.drawer,this._imageLoader=d.imageLoader,delete d.imageLoader,d.clip instanceof e.Rect&&(this._clip=d.clip.clone()),delete d.clip;var H=d.x||0;delete d.x;var M=d.y||0;delete d.y,this.normHeight=d.source.dimensions.y/d.source.dimensions.x,this.contentAspectX=d.source.dimensions.x/d.source.dimensions.y;var I=1;d.width?(I=d.width,delete d.width,d.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete d.height)):d.height&&(I=d.height/this.normHeight,delete d.height);var V=d.fitBounds;delete d.fitBounds;var q=d.fitBoundsPlacement||r.Placement.CENTER;delete d.fitBoundsPlacement;var K=d.degrees||0;delete d.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},d),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:H,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:M,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:I,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:K,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),V&&this.fitBounds(V,q,!0),this._drawingHandler=function(j){w.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:w},j))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(d){d!==this._fullyLoaded&&(this._fullyLoaded=d,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var d=this._xSpring.update(),w=this._ySpring.update(),H=this._scaleSpring.update(),M=this._degreesSpring.update();return d||w||H||M?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(d){return this.getBoundsNoRotate(d).rotate(this.getRotation(d),this._getRotationPoint(d))},getBoundsNoRotate:function(d){return d?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(d){var w=this.getBoundsNoRotate(d);if(this._clip){var H=d?this._worldWidthCurrent:this._worldWidthTarget,M=H/this.source.dimensions.x,I=this._clip.times(M);w=new e.Rect(w.x+I.x,w.y+I.y,I.width,I.height)}return w.rotate(this.getRotation(d),this._getRotationPoint(d))},getTileBounds:function(d,w,H){var M=this.source.getNumTiles(d),I=(M.x+w%M.x)%M.x,V=(M.y+H%M.y)%M.y,q=this.source.getTileBounds(d,I,V);return this.getFlip()&&(q.x=1-q.x-q.width),q.x+=(w-I)/M.x,q.y+=this._worldHeightCurrent/this._worldWidthCurrent*((H-V)/M.y),q},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var d=this.imageToWindowCoordinates(new e.Point(0,0)),w=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(w.x-d.x,w.y-d.y)},_viewportToImageDelta:function(d,w,H){var M=H?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(d*(this.source.dimensions.x/M),w*(this.source.dimensions.y*this.contentAspectX/M))},viewportToImageCoordinates:function(d,w,H){var M;return d instanceof e.Point?(H=w,M=d):M=new e.Point(d,w),M=M.rotate(-this.getRotation(H),this._getRotationPoint(H)),H?this._viewportToImageDelta(M.x-this._xSpring.current.value,M.y-this._ySpring.current.value):this._viewportToImageDelta(M.x-this._xSpring.target.value,M.y-this._ySpring.target.value)},_imageToViewportDelta:function(d,w,H){var M=H?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(d/this.source.dimensions.x*M,w/this.source.dimensions.y/this.contentAspectX*M)},imageToViewportCoordinates:function(d,w,H){d instanceof e.Point&&(H=w,w=d.y,d=d.x);var M=this._imageToViewportDelta(d,w);return H?(M.x+=this._xSpring.current.value,M.y+=this._ySpring.current.value):(M.x+=this._xSpring.target.value,M.y+=this._ySpring.target.value),M.rotate(this.getRotation(H),this._getRotationPoint(H))},imageToViewportRectangle:function(d,w,H,M,I){var V=d;V instanceof e.Rect?I=w:V=new e.Rect(d,w,H,M);var q=this.imageToViewportCoordinates(V.getTopLeft(),I),K=this._imageToViewportDelta(V.width,V.height,I);return new e.Rect(q.x,q.y,K.x,K.y,V.degrees+this.getRotation(I))},viewportToImageRectangle:function(d,w,H,M,I){var V=d;d instanceof e.Rect?I=w:V=new e.Rect(d,w,H,M);var q=this.viewportToImageCoordinates(V.getTopLeft(),I),K=this._viewportToImageDelta(V.width,V.height,I);return new e.Rect(q.x,q.y,K.x,K.y,V.degrees-this.getRotation(I))},viewerElementToImageCoordinates:function(d){var w=this.viewport.pointFromPixel(d,!0);return this.viewportToImageCoordinates(w)},imageToViewerElementCoordinates:function(d){var w=this.imageToViewportCoordinates(d);return this.viewport.pixelFromPoint(w,!0)},windowToImageCoordinates:function(d){var w=d.minus(r.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(w)},imageToWindowCoordinates:function(d){var w=this.imageToViewerElementCoordinates(d);return w.plus(r.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(d){var w=this._scaleSpring.current.value;return d=d.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((d.x-this._xSpring.current.value)/w,(d.y-this._ySpring.current.value)/w,d.width/w,d.height/w,d.degrees)},viewportToImageZoom:function(d){var w=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return w*d},imageToViewportZoom:function(d){var w=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return d/w},setPosition:function(d,w){var H=this._xSpring.target.value===d.x&&this._ySpring.target.value===d.y;if(w){if(H&&this._xSpring.current.value===d.x&&this._ySpring.current.value===d.y)return;this._xSpring.resetTo(d.x),this._ySpring.resetTo(d.y),this._needsDraw=!0}else{if(H)return;this._xSpring.springTo(d.x),this._ySpring.springTo(d.y),this._needsDraw=!0}H||this._raiseBoundsChange()},setWidth:function(d,w){this._setScale(d,w)},setHeight:function(d,w){this._setScale(d/this.normHeight,w)},setCroppingPolygons:function(d){var w=function(M){return M instanceof e.Point||typeof M.x=="number"&&typeof M.y=="number"},H=function(M){return M.map(function(I){try{if(w(I))return{x:I.x,y:I.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!e.isArray(d))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=d.map(function(M){return H(M)})}catch(M){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(M),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(d,w,H){w=w||e.Placement.CENTER;var M=e.Placement.properties[w],I=this.contentAspectX,V=0,q=0,K=1,j=1;if(this._clip&&(I=this._clip.getAspectRatio(),K=this._clip.width/this.source.dimensions.x,j=this._clip.height/this.source.dimensions.y,d.getAspectRatio()>I?(V=this._clip.x/this._clip.height*d.height,q=this._clip.y/this._clip.height*d.height):(V=this._clip.x/this._clip.width*d.width,q=this._clip.y/this._clip.width*d.width)),d.getAspectRatio()>I){var oe=d.height/j,te=0;M.isHorizontallyCentered?te=(d.width-d.height*I)/2:M.isRight&&(te=d.width-d.height*I),this.setPosition(new e.Point(d.x-V+te,d.y-q),H),this.setHeight(oe,H)}else{var fe=d.width/K,ue=0;M.isVerticallyCentered?ue=(d.height-d.width/I)/2:M.isBottom&&(ue=d.height-d.width/I),this.setPosition(new e.Point(d.x-V,d.y-q+ue),H),this.setWidth(fe,H)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(d){e.console.assert(!d||d instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),d instanceof e.Rect?this._clip=d.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(d){this.flipped=!!d,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(d){d!==this.opacity&&(this.opacity=d,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(d){this._preload=!!d,this._needsDraw=!0},getRotation:function(d){return d?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(d,w){this._degreesSpring.target.value===d&&this._degreesSpring.isAtTargetValue()||(w?this._degreesSpring.resetTo(d):this._degreesSpring.springTo(d),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(d){return this.getBoundsNoRotate(d).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(d){d!==this.compositeOperation&&(this.compositeOperation=d,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(d,w){var H=this._scaleSpring.target.value===d;if(w){if(H&&this._scaleSpring.current.value===d)return;this._scaleSpring.resetTo(d),this._updateForScale(),this._needsDraw=!0}else{if(H)return;this._scaleSpring.springTo(d),this._updateForScale(),this._needsDraw=!0}H||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var d=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),w=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,H=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(w/this.minPixelRatio)/Math.log(2))));return H=Math.max(H,this.source.minLevel||0),d=Math.min(d,H),{lowestLevel:d,highestLevel:H}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var d=this.lastDrawn.pop();d.beingDrawn=!1}var w=this.viewport,H=this._viewportToTiledImageRectangle(w.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var M=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(H=H.intersection(M),H===null)return}for(var I=this._getLevelsInterval(),V=I.lowestLevel,q=I.highestLevel,K=null,j=!1,oe=e.now(),te=q;te>=V;te--){var fe=!1,ue=w.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(te),!0).x*this._scaleSpring.current.value;if(te===V||!j&&ue>=this.minPixelRatio)fe=!0,j=!0;else if(!j)continue;var _e=w.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(te),!1).x*this._scaleSpring.current.value,le=w.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,ae=this.immediateRender?1:le,ne=Math.min(1,(ue-.5)/.5),Te=ae/Math.abs(ae-_e);if(K=i(this,j,fe,te,ne,Te,H,oe,K),g(this.coverage,te))break}S(this,this.lastDrawn),K&&!K.context2D?(l(this,K,oe),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(d,w,H){var M,I;this.wrapHorizontal?(M=e.positiveModulo(w.x,1),I=e.positiveModulo(H.x,1)):(M=Math.max(0,w.x),I=Math.min(1,H.x));var V,q,K=1/this.source.aspectRatio;this.wrapVertical?(V=e.positiveModulo(w.y,K),q=e.positiveModulo(H.y,K)):(V=Math.max(0,w.y),q=Math.min(K,H.y));var j=this.source.getTileAtPoint(d,new e.Point(M,V)),oe=this.source.getTileAtPoint(d,new e.Point(I,q)),te=this.source.getNumTiles(d);return this.wrapHorizontal&&(j.x+=te.x*Math.floor(w.x),oe.x+=te.x*Math.floor(H.x)),this.wrapVertical&&(j.y+=te.y*Math.floor(w.y/K),oe.y+=te.y*Math.floor(H.y/K)),{topLeft:j,bottomRight:oe}}});function i(d,w,H,M,I,V,q,K,j){var oe=q.getBoundingBox().getTopLeft(),te=q.getBoundingBox().getBottomRight();d.viewer&&d.viewer.raiseEvent("update-level",{tiledImage:d,havedrawn:w,level:M,opacity:I,visibility:V,drawArea:q,topleft:oe,bottomright:te,currenttime:K,best:j}),x(d.coverage,M),x(d.loadingCoverage,M);var fe=d._getCornerTiles(M,oe,te),ue=fe.topLeft,_e=fe.bottomRight,le=d.source.getNumTiles(M),ae=d.viewport.pixelFromPoint(d.viewport.getCenter());d.getFlip()&&(_e.x+=1,d.wrapHorizontal||(_e.x=Math.min(_e.x,le.x-1)));for(var ne=ue.x;ne<=_e.x;ne++)for(var Te=ue.y;Te<=_e.y;Te++){var $;if(d.getFlip()){var Me=(le.x+ne%le.x)%le.x;$=ne+le.x-Me-Me-1}else $=ne;q.intersection(d.getTileBounds(M,$,Te))!==null&&(j=n(d,H,w,$,Te,M,I,V,ae,le,K,j))}return j}function n(d,w,H,M,I,V,q,K,j,oe,te,fe){var ue=s(M,I,V,d,d.source,d.tilesMatrix,te,oe,d._worldWidthCurrent,d._worldHeightCurrent),_e=H;d.viewer&&d.viewer.raiseEvent("update-tile",{tiledImage:d,tile:ue}),b(d.coverage,V,M,I,!1);var le=ue.loaded||ue.loading||m(d.loadingCoverage,V,M,I);if(b(d.loadingCoverage,V,M,I,le),!ue.exists||(w&&!_e&&(m(d.coverage,V,M,I)?b(d.coverage,V,M,I,!0):_e=!0),!_e))return fe;if(c(ue,d.source.tileOverlap,d.viewport,j,K,d),!ue.loaded)if(ue.context2D)a(d,ue);else{var ae=d._tileCache.getImageRecord(ue.cacheKey);if(ae){var ne=ae.getImage();a(d,ue,ne)}}if(ue.loaded){var Te=h(d,ue,M,I,V,q,te);Te&&(d._needsDraw=!0)}else ue.loading?d._tilesLoading++:le||(fe=P(fe,ue));return fe}function s(d,w,H,M,I,V,q,K,j,oe){var te,fe,ue,_e,le,ae,ne,Te,$;return V[H]||(V[H]={}),V[H][d]||(V[H][d]={}),(!V[H][d][w]||!V[H][d][w].flipped!=!M.flipped)&&(te=(K.x+d%K.x)%K.x,fe=(K.y+w%K.y)%K.y,ue=M.getTileBounds(H,d,w),_e=I.getTileBounds(H,te,fe,!0),le=I.tileExists(H,te,fe),ae=I.getTileUrl(H,te,fe),M.loadTilesWithAjax?(ne=I.getTileAjaxHeaders(H,te,fe),e.isPlainObject(M.ajaxHeaders)&&(ne=e.extend({},M.ajaxHeaders,ne))):ne=null,Te=I.getContext2D?I.getContext2D(H,te,fe):void 0,$=new e.Tile(H,d,w,ue,le,ae,Te,M.loadTilesWithAjax,ne,_e),M.getFlip()?te===0&&($.isRightMost=!0):te===K.x-1&&($.isRightMost=!0),fe===K.y-1&&($.isBottomMost=!0),$.flipped=M.flipped,V[H][d][w]=$),$=V[H][d][w],$.lastTouchTime=q,$}function l(d,w,H){w.loading=!0,d._imageLoader.addJob({src:w.url,loadWithAjax:w.loadWithAjax,ajaxHeaders:w.ajaxHeaders,crossOriginPolicy:d.crossOriginPolicy,ajaxWithCredentials:d.ajaxWithCredentials,callback:function(M,I,V){o(d,w,H,M,I,V)},abort:function(){w.loading=!1}})}function o(d,w,H,M,I,V){if(!M){e.console.log("Tile %s failed to load: %s - error: %s",w,w.url,I),d.viewer.raiseEvent("tile-load-failed",{tile:w,tiledImage:d,time:H,message:I,tileRequest:V}),w.loading=!1,w.exists=!1;return}if(H<d.lastResetTime){e.console.log("Ignoring tile %s loaded before reset: %s",w,w.url),w.loading=!1;return}var q=function(){var K=d.source.getClosestLevel();a(d,w,M,K,V)};d._midDraw?window.setTimeout(q,1):q()}function a(d,w,H,M,I){var V=0;function q(){return V++,K}function K(){V--,V===0&&(w.loading=!1,w.loaded=!0,w.context2D||d._tileCache.cacheTile({image:H,tile:w,cutoff:M,tiledImage:d}),d._needsDraw=!0)}d.viewer.raiseEvent("tile-loaded",{tile:w,tiledImage:d,tileRequest:I,image:H,getCompletionCallback:q}),q()()}function c(d,w,H,M,I,V){var q=d.bounds.getTopLeft();q.x*=V._scaleSpring.current.value,q.y*=V._scaleSpring.current.value,q.x+=V._xSpring.current.value,q.y+=V._ySpring.current.value;var K=d.bounds.getSize();K.x*=V._scaleSpring.current.value,K.y*=V._scaleSpring.current.value;var j=H.pixelFromPointNoRotate(q,!0),oe=H.pixelFromPointNoRotate(q,!1),te=H.deltaPixelsFromPointsNoRotate(K,!0),fe=H.deltaPixelsFromPointsNoRotate(K,!1),ue=oe.plus(fe.divide(2)),_e=M.squaredDistanceTo(ue);w||(te=te.plus(new e.Point(1,1))),d.isRightMost&&V.wrapHorizontal&&(te.x+=.75),d.isBottomMost&&V.wrapVertical&&(te.y+=.75),d.position=j,d.size=te,d.squaredDistance=_e,d.visibility=I}function h(d,w,H,M,I,V,q){var K=1e3*d.blendTime,j,oe;if(w.blendStart||(w.blendStart=q),j=q-w.blendStart,oe=K?Math.min(1,j/K):1,d.alwaysBlend&&(oe*=V),w.opacity=oe,d.lastDrawn.push(w),oe===1)b(d.coverage,I,H,M,!0),d._hasOpaqueTile=!0;else if(j<K)return!0;return!1}function g(d,w,H,M){var I,V,q,K;if(!d[w])return!1;if(H===void 0||M===void 0){I=d[w];for(q in I)if(Object.prototype.hasOwnProperty.call(I,q)){V=I[q];for(K in V)if(Object.prototype.hasOwnProperty.call(V,K)&&!V[K])return!1}return!0}return d[w][H]===void 0||d[w][H][M]===void 0||d[w][H][M]===!0}function m(d,w,H,M){return H===void 0||M===void 0?g(d,w+1):g(d,w+1,2*H,2*M)&&g(d,w+1,2*H,2*M+1)&&g(d,w+1,2*H+1,2*M)&&g(d,w+1,2*H+1,2*M+1)}function b(d,w,H,M,I){if(!d[w]){e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",w);return}d[w][H]||(d[w][H]={}),d[w][H][M]=I}function x(d,w){d[w]={}}function P(d,w){return!d||w.visibility>d.visibility||w.visibility===d.visibility&&w.squaredDistance<d.squaredDistance?w:d}function S(d,w){if(!(d.opacity===0||w.length===0&&!d.placeholderFillStyle)){var H=w[0],M;H&&(M=d.opacity<1||d.compositeOperation&&d.compositeOperation!=="source-over"||!d._isBottomItem()&&H._hasTransparencyChannel());var I,V,q=d.viewport.getZoom(!0),K=d.viewportToImageZoom(q);w.length>1&&K>d.smoothTileEdgesMinZoom&&!d.iOSDevice&&d.getRotation(!0)%360===0&&e.supportsCanvas&&(M=!0,I=H.getScaleForEdgeSmoothing(),V=H.getTranslationForEdgeSmoothing(I,d._drawer.getCanvasSize(!1),d._drawer.getCanvasSize(!0)));var j;M&&(I||(j=d.viewport.viewportToViewerElementRectangle(d.getClippedBounds(!0)).getIntegerBoundingBox(),d._drawer.viewer.viewport.getFlip()&&(d.viewport.degrees!==0||d.getRotation(!0)%360!==0)&&(j.x=d._drawer.viewer.container.clientWidth-(j.x+j.width)),j=j.times(e.pixelDensityRatio)),d._drawer._clear(!0,j)),I||(d.viewport.degrees!==0&&d._drawer._offsetForRotation({degrees:d.viewport.degrees,useSketch:M}),d.getRotation(!0)%360!==0&&d._drawer._offsetForRotation({degrees:d.getRotation(!0),point:d.viewport.pixelFromPointNoRotate(d._getRotationPoint(!0),!0),useSketch:M}),d.viewport.degrees===0&&d.getRotation(!0)%360===0&&d._drawer.viewer.viewport.getFlip()&&d._drawer._flip());var oe=!1;if(d._clip){d._drawer.saveContext(M);var te=d.imageToViewportRectangle(d._clip,!0);te=te.rotate(-d.getRotation(!0),d._getRotationPoint(!0));var fe=d._drawer.viewportToDrawerRectangle(te);I&&(fe=fe.times(I)),V&&(fe=fe.translate(V)),d._drawer.setClip(fe,M),oe=!0}if(d._croppingPolygons){d._drawer.saveContext(M);try{var ue=d._croppingPolygons.map(function(ne){return ne.map(function(Te){var $=d.imageToViewportCoordinates(Te.x,Te.y,!0).rotate(-d.getRotation(!0),d._getRotationPoint(!0)),Me=d._drawer.viewportCoordToDrawerCoord($);return I&&(Me=Me.times(I)),Me})});d._drawer.clipWithPolygons(ue,M)}catch(ne){e.console.error(ne)}oe=!0}if(d.placeholderFillStyle&&d._hasOpaqueTile===!1){var _e=d._drawer.viewportToDrawerRectangle(d.getBounds(!0));I&&(_e=_e.times(I)),V&&(_e=_e.translate(V));var le=null;typeof d.placeholderFillStyle=="function"?le=d.placeholderFillStyle(d,d._drawer.context):le=d.placeholderFillStyle,d._drawer.drawRectangle(_e,le,M)}for(var ae=w.length-1;ae>=0;ae--)H=w[ae],d._drawer.drawTile(H,d._drawingHandler,M,I,V),H.beingDrawn=!0,d.viewer&&d.viewer.raiseEvent("tile-drawn",{tiledImage:d,tile:H});oe&&d._drawer.restoreContext(M),I||(d.getRotation(!0)%360!==0&&d._drawer._restoreRotationChanges(M),d.viewport.degrees!==0&&d._drawer._restoreRotationChanges(M)),M&&(I&&(d.viewport.degrees!==0&&d._drawer._offsetForRotation({degrees:d.viewport.degrees,useSketch:!1}),d.getRotation(!0)%360!==0&&d._drawer._offsetForRotation({degrees:d.getRotation(!0),point:d.viewport.pixelFromPointNoRotate(d._getRotationPoint(!0),!0),useSketch:!1})),d._drawer.blendSketch({opacity:d.opacity,scale:I,translate:V,compositeOperation:d.compositeOperation,bounds:j}),I&&(d.getRotation(!0)%360!==0&&d._drawer._restoreRotationChanges(!1),d.viewport.degrees!==0&&d._drawer._restoreRotationChanges(!1))),I||d.viewport.degrees===0&&d.getRotation(!0)%360===0&&d._drawer.viewer.viewport.getFlip()&&d._drawer._flip(),O(d,w)}}function O(d,w){if(d.debugMode)for(var H=w.length-1;H>=0;H--){var M=w[H];try{d._drawer.drawDebugInfo(M,w.length,H,d)}catch(I){e.console.error(I)}}}}(r),function(e){var i=function(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=s.tile,this.tiledImage=s.tiledImage},n=function(s){e.console.assert(s,"[ImageRecord] options is required"),e.console.assert(s.image,"[ImageRecord] options.image is required"),this._image=s.image,this._tiles=[]};n.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var s=document.createElement("canvas");s.width=this._image.width,s.height=this._image.height,this._renderedContext=s.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(s){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=s},addTile:function(s){e.console.assert(s,"[ImageRecord.addTile] tile is required"),this._tiles.push(s)},removeTile:function(s){for(var l=0;l<this._tiles.length;l++)if(this._tiles[l]===s){this._tiles.splice(l,1);return}e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",s)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(s){s=s||{},this._maxImageCacheCount=s.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var l=s.cutoff||0,o=this._tilesLoaded.length,a=this._imagesLoaded[s.tile.cacheKey];if(a||(e.console.assert(s.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),a=this._imagesLoaded[s.tile.cacheKey]=new n({image:s.image}),this._imagesLoadedCount++),a.addTile(s.tile),s.tile.cacheImageRecord=a,this._imagesLoadedCount>this._maxImageCacheCount){for(var c=null,h=-1,g=null,m,b,x,P,S,O,d=this._tilesLoaded.length-1;d>=0;d--)if(O=this._tilesLoaded[d],m=O.tile,!(m.level<=l||m.beingDrawn)){if(!c){c=m,h=d,g=O;continue}P=m.lastTouchTime,b=c.lastTouchTime,S=m.level,x=c.level,(P<b||P===b&&S>x)&&(c=m,h=d,g=O)}c&&h>=0&&(this._unloadTile(g),o=h)}this._tilesLoaded[o]=new i({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(s){e.console.assert(s,"[TileCache.clearTilesFor] tiledImage is required");for(var l,o=0;o<this._tilesLoaded.length;++o)l=this._tilesLoaded[o],l.tiledImage===s&&(this._unloadTile(l),this._tilesLoaded.splice(o,1),o--)},getImageRecord:function(s){return e.console.assert(s,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[s]},_unloadTile:function(s){e.console.assert(s,"[TileCache._unloadTile] tileRecord is required");var l=s.tile,o=s.tiledImage;l.unload(),l.cacheImageRecord=null;var a=this._imagesLoaded[l.cacheKey];a.removeTile(l),a.getTileCount()||(a.destroy(),delete this._imagesLoaded[l.cacheKey],this._imagesLoadedCount--),o.viewer.raiseEvent("tile-unloaded",{tile:l,tiledImage:o})}}}(r),function(e){e.World=function(i){var n=this;e.console.assert(i.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(s){n._autoRefigureSizes?n._figureSizes():n._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(i,n){if(e.console.assert(i,"[World.addItem] item is required"),e.console.assert(i instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),n=n||{},n.index!==void 0){var s=Math.max(0,Math.min(this._items.length,n.index));this._items.splice(s,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return e.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return e.console.assert(i,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,n){e.console.assert(i,"[World.setItemIndex] item is required"),e.console.assert(n!==void 0,"[World.setItemIndex] index is required");var s=this.getIndexOfItem(i);if(n>=this._items.length)throw new Error("Index bigger than number of layers.");n===s||s===-1||(this._items.splice(s,1),this._items.splice(n,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:s,newIndex:n}))},removeItem:function(i){e.console.assert(i,"[World.removeItem] item is required");var n=e.indexOf(this._items,i);n!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(n,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,n;for(n=0;n<this._items.length;n++)i=this._items[n],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var s=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,n=0;n<s.length;n++)i=s[n],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var i=!1,n=0;n<this._items.length;n++)i=this._items[n].update()||i;return i},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var n=i.immediately||!1,s=i.layout||e.DEFAULT_SETTINGS.collectionLayout,l=i.rows||e.DEFAULT_SETTINGS.collectionRows,o=i.columns||e.DEFAULT_SETTINGS.collectionColumns,a=i.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,c=i.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin,h=a+c,g;!i.rows&&o?g=o:g=Math.ceil(this._items.length/l);var m=0,b=0,x,P,S,O,d;this.setAutoRefigureSizes(!1);for(var w=0;w<this._items.length;w++)w&&w%g===0&&(s==="horizontal"?(b+=h,m=0):(m+=h,b=0)),x=this._items[w],P=x.getBounds(),P.width>P.height?S=a:S=a*(P.width/P.height),O=S*(P.height/P.width),d=new e.Point(m+(a-S)/2,b+(a-O)/2),x.setPosition(d,n),x.setWidth(S,n),s==="horizontal"?m+=h:b+=h;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,n=this._contentSize?this._contentSize.clone():null,s=this._contentFactor||0;if(!this._items.length)this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;else{var l=this._items[0],o=l.getBounds();this._contentFactor=l.getContentSize().x/o.width;for(var a=l.getClippedBounds().getBoundingBox(),c=a.x,h=a.y,g=a.x+a.width,m=a.y+a.height,b=1;b<this._items.length;b++)l=this._items[b],o=l.getBounds(),this._contentFactor=Math.max(this._contentFactor,l.getContentSize().x/o.width),a=l.getClippedBounds().getBoundingBox(),c=Math.min(c,a.x),h=Math.min(h,a.y),g=Math.max(g,a.x+a.width),m=Math.max(m,a.y+a.height);this._homeBounds=new e.Rect(c,h,g-c,m-h),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==s||!this._homeBounds.equals(i)||!this._contentSize.equals(n))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})}(r)})(dd);const fd=wn;function At(t,r){U.root[r||t.name.replace("bound ","")]=t}function Wn(t){return!!(t.altKey||t.ctrlKey||t.metaKey||["INPUT","SELECT","TEXTAREA"].includes(t.target.nodeName)&&t.target.type!=="range")}const pd=.01,gd={data(){return{filtersVisible:!1,loadingTimeout:null,options:U,tileSources:{},viewer:null,viewerState:{},zoomFactor:1.5,isLastPage:Or,customPageViewActive:Dr,isFirstPage:Mr}},computed:{filtersActive(){return Object.keys(U.filters).length>0},saturation(){const t=U.filters.saturate;return typeof t=="number"?t:1}},watch:{"options.pages":function(t,r){const e=t.length!==r.length;this.loadImageInfo(e)}},mounted(){this.loadImageInfo(),this.updateFilterStyle(),U.root.$el.addEventListener("keydown",this.onKeydown),U.root.$el.addEventListener("keypress",this.onKeypress)},beforeUnmount(){this.viewer&&this.viewer.destroy(),U.root.$el.removeEventListener("keydown",this.onKeydown),U.root.$el.removeEventListener("keypress",this.onKeypress)},methods:{closeFilters(){this.filtersVisible=!1},getId:Nt,goToNextPage:vn,goToPreviousPage:yn,initViewer(t){const r=[];let e=0,i,n=0;if(U.pages.forEach((s,l)=>{let o=1;s<1?(o=0,i=l>0?ct.value:1):i=s;const a=this.tileSources[i];if(!a)return;e||(e=a.width);const c=a.width/e;r.push({opacity:o,tileSource:a,width:c,x:n}),n+=c+pd}),this.viewer){this.viewer.addOnceHandler("open",()=>{if(this.viewerState.isReset||t)this.resetScan();else{if(this.viewer.viewport.applyConstraints(!0),!U.optionsResetOnPageChange)return;U.optionsResetOnPageChange.forEach(s=>{if(s==="filters")this.resetFilters();else if(s==="pan"){const l=this.viewer.viewport.getBounds();if(l.x<=0&&l.y<=0)return;const o=U.pages[0]?0:1;this.viewer.viewport.panTo({x:l.x>0?l.width/2+o:U.pan.x,y:l.y>0?l.height/2:U.pan.y}),Ce({pan:{}})}else s==="rotation"?(this.viewer.viewport.setRotation(0),Ce({rotation:null})):s==="zoom"&&(this.viewer.viewport.goHome(),Ce({zoom:null}))})}}),this.viewer.open(r);return}this.viewer=fd({animationTime:.4,element:this.$refs.image,immediateRender:!0,preload:!zt(),preserveImageSizeOnResize:!0,preserveViewport:!0,showNavigationControl:!1,showZoomControl:!1,tileSources:r,visibilityRatio:.2,...U.viewer}),this.viewer.innerTracker.keyHandler=null,this.viewer.gestureSettingsMouse.clickToZoom=!1,this.viewer.addHandler("animation-finish",()=>{if(this.viewerState.isReset){this.removeScanOptions();return}const s=this.viewer.viewport.getCenter();Ce({pan:{x:Math.round(s.x*1e3)/1e3,y:Math.round(s.y*1e3)/1e3},zoom:Math.round(this.viewer.viewport.getZoom()*1e3)/1e3})}),this.viewer.addHandler("canvas-click",()=>{document.body.click()}),this.viewer.addHandler("open",()=>{this.startLoadingWatch(),U.pan.x!==void 0||U.pan.y!==void 0||U.zoom?((U.pan.x!==void 0||U.pan.y!==void 0)&&this.viewer.viewport.panTo({x:U.pan.x,y:U.pan.y},!0),U.zoom&&this.viewer.viewport.zoomTo(U.zoom,null,!0)):this.viewer.viewport.goHome(),U.rotation!==null&&this.viewer.viewport.setRotation(U.rotation)}),this.viewer.addHandler("pan",this.updateViewerState),this.viewer.addHandler("resize",this.updateViewerState),this.viewer.addHandler("zoom",this.updateViewerState),this.viewer.addHandler("tile-load-failed",s=>{it(`Error loading image: ${s.message}`)}),At(this.resetScan),At(this.viewer,"viewer")},loadImageInfo(t=!1){this.stopLoadingWatch();const r=[];U.pages.forEach(e=>{if(e<1||this.tileSources[e])return;const{resource:i}=Ge.value[e-1].images[0];if(i.service){const n=i.service["@id"],s=`${n}${n.slice(-1)==="/"?"":"/"}info.json`;r.push(di(s).then(l=>({...l,page:e}),l=>{let o;l.response&&l.response.statusText?o=l.response.statusText:l.message&&(o=l.message),it(`Error loading info file for page ${e}${o?`: ${o}`:""}`)}))}else this.tileSources[e]={type:"image",url:i["@id"],width:i.width,height:i.height}}),r.length?Promise.all(r).then(e=>{e.forEach(i=>{i&&(this.tileSources[i.page]=i)}),this.initViewer(t)}):this.initViewer(t)},onKeydown(t){t.key==="Escape"&&(this.filtersVisible=!1),[45,48,96].indexOf(t.keyCode)>-1&&(t.shiftKey?this.resetScan(t):this.viewer.viewport.goHome())},onKeypress(t){if(!Wn(t))switch(t.key){case"r":case"R":this.rotateRight(t);break;case"i":this.filtersVisible=!this.filtersVisible,this.filtersVisible&&this.$nextTick(()=>{this.$refs.firstSlider.focus()});break;case"I":this.resetFilters();break;case"+":case"=":case"W":this.viewer.viewport.zoomBy(1.1),this.viewer.viewport.applyConstraints();break;case"-":case"_":case"S":this.viewer.viewport.zoomBy(.9),this.viewer.viewport.applyConstraints();break;case"w":this.viewer.innerTracker.keyDownHandler({keyCode:38});break;case"s":this.viewer.innerTracker.keyDownHandler({keyCode:40});break;case"a":this.viewer.innerTracker.keyDownHandler({keyCode:37});break;case"d":this.viewer.innerTracker.keyDownHandler({keyCode:39});break}},removeScanOptions(){Ce({pan:{},zoom:null})},resetFilters(){this.$refs.image.style.cssText="",Ce({filters:{}})},resetScan(t){t&&(this.viewer.viewport.setRotation(0),Ce({rotation:null}),this.filtersActive&&this.resetFilters()),this.viewer.viewport.goHome(),this.removeScanOptions()},rotateRight(t){const{viewport:r}=this.viewer,e=t&&t.shiftKey?0:(r.getRotation()+90)%360;r.setRotation(e),Ce({rotation:e||null})},setFilter(t,r){const e=r.target.valueAsNumber;e===1?delete U.filters[t]:U.filters[t]=e,Ce({filters:U.filters}),this.updateFilterStyle()},startLoadingWatch(){Es(0);for(let t=this.viewer.world.getItemCount()-1;t>=0;t-=1){const r=this.viewer.world.getItemAt(t);if(r&&r._tilesLoading){Es(1);break}}this.loadingTimeout=setTimeout(this.startLoadingWatch,200)},stopLoadingWatch(){clearTimeout(this.loadingTimeout)},updateFilterStyle(){if(!this.filtersActive)return;const t=[];Object.keys(U.filters).forEach(i=>{t.push(`${i}(${U.filters[i]})`)});const{image:r}=this.$refs,e=t.join(" ");r.style.cssText=`filter: ${e}`},updateViewerState(){const t=this.viewer.viewport.getZoom();this.viewerState.isMaxZoom=t>=this.viewer.viewport.getMaxZoom(),this.viewerState.isMinZoom=t<=this.viewer.viewport.getMinZoom();const r=this.viewer.viewport.getHomeBounds(),e=this.viewer.viewport.getBounds();this.viewerState.isReset=Math.abs(r.height-e.height)<1e-9&&Math.abs(r.width-e.width)<1e-9&&Math.abs(r.x-e.x)<1e-9&&Math.abs(r.y-e.y)<1e-9},translate:He,zoomIn(){this.viewer.viewport.zoomBy(this.zoomFactor)},zoomOut(){this.viewer.viewport.zoomBy(1/this.zoomFactor)}}},md={class:"tify-scan"},vd={class:"tify-sr-only"},yd=["title"],wd=["title"],_d={key:2,class:"tify-scan-buttons"},xd=["disabled","title"],Td=["disabled","title"],bd=["disabled","title"],Ed=["title"],Pd=["title","aria-controls","aria-expanded"],Sd=["id"],Cd={class:"tify-sr-only"},Rd=["value"],Hd=["value"],Ld=["value"],Dd=["disabled"],Md={ref:"image",class:"tify-scan-image"};function Od(t,r,e,i,n,s){const l=Ar,o=Fr,a=td,c=Xh,h=Wh,g=Bh,m=Dh,b=Ph,x=wh,P=fh,S=ah,O=Fn("click-outside");return D(),k("section",md,[F("h2",vd,X(s.translate("Scan")),1),!n.customPageViewActive&&!n.isFirstPage?(D(),k("button",{key:0,type:"button",class:"tify-scan-page-button -previous",title:s.translate("Previous page"),onClick:r[0]||(r[0]=(...d)=>s.goToPreviousPage&&s.goToPreviousPage(...d))},[ie(l)],8,yd)):re("",!0),!n.customPageViewActive&&!n.isLastPage?(D(),k("button",{key:1,type:"button",class:"tify-scan-page-button -next",title:s.translate("Next page"),onClick:r[1]||(r[1]=(...d)=>s.goToNextPage&&s.goToNextPage(...d))},[ie(o)],8,wd)):re("",!0),n.viewer?(D(),k("div",_d,[F("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isMaxZoom,title:s.translate("Zoom in"),onClick:r[2]||(r[2]=(...d)=>s.zoomIn&&s.zoomIn(...d))},[ie(a)],8,xd),F("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isReset,title:s.translate("Reset"),onClick:r[3]||(r[3]=d=>s.resetScan(!!d.shiftKey))},[ie(c)],8,Td),F("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isMinZoom,title:s.translate("Zoom out"),onClick:r[4]||(r[4]=(...d)=>s.zoomOut&&s.zoomOut(...d))},[ie(h)],8,bd),F("button",{type:"button",class:Ee(["tify-scan-button",{"-active":n.options.rotation}]),title:s.translate("Rotate"),onClick:r[5]||(r[5]=d=>s.rotateRight(d))},[ie(g)],10,Ed),Ne((D(),k("div",{class:Ee(["tify-scan-filters",{"-open":n.filtersVisible}])},[F("button",{type:"button",class:Ee(["tify-scan-button",{"-active":s.filtersActive}]),title:s.translate("Toggle image filters"),"aria-controls":s.getId("filters"),"aria-expanded":n.filtersVisible?"true":"false",onClick:r[6]||(r[6]=d=>n.filtersVisible=!n.filtersVisible)},[ie(m)],10,Pd),Ne(F("div",{id:s.getId("filters"),class:"tify-scan-filters-popup"},[F("h3",Cd,X(s.translate("Image filters")),1),F("p",null,[F("label",null,[ie(b),Pe(" "+X(s.translate("Brightness"))+" ",1),F("b",null,X(Math.round((n.options.filters.brightness||1)*100))+"Â %",1),F("input",{ref:"firstSlider",class:"tify-scan-range",max:"2",min:".5",step:".01",type:"range",value:n.options.filters.brightness||1,onInput:r[7]||(r[7]=d=>s.setFilter("brightness",d))},null,40,Rd)])]),F("p",null,[F("label",null,[ie(x),Pe(" "+X(s.translate("Contrast"))+" ",1),F("b",null,X(Math.round((n.options.filters.contrast||1)*100))+"Â %",1),F("input",{class:"tify-scan-range",max:"2",min:".5",step:".01",type:"range",value:n.options.filters.contrast||1,onInput:r[8]||(r[8]=d=>s.setFilter("contrast",d))},null,40,Hd)])]),F("p",null,[F("label",null,[ie(P),Pe(" "+X(s.translate("Saturation"))+" ",1),F("b",null,X(Math.round(s.saturation*100))+"Â %",1),F("input",{class:"tify-scan-range",max:"3",min:"0",step:".01",type:"range",value:s.saturation,onInput:r[9]||(r[9]=d=>s.setFilter("saturate",d))},null,40,Ld)])]),F("p",null,[F("button",{type:"button",class:"tify-scan-reset",disabled:!s.filtersActive,onClick:r[10]||(r[10]=(...d)=>s.resetFilters&&s.resetFilters(...d))},[ie(S),Pe(" "+X(s.translate("Reset")),1)],8,Dd)])],8,Sd),[[rt,n.filtersVisible]])],2)),[[O,s.closeFilters]])])):re("",!0),F("div",Md,null,512)])}const kd=ce(gd,[["render",Od]]),Fd={},Ad={class:"tify-icon",viewBox:"0 0 24 24"},Bd=F("path",{d:"M14,14H19V16H16V19H14V14M5,14H10V19H8V16H5V14M8,5H10V10H5V8H8V5M19,8V10H14V5H16V8H19Z"},null,-1),Id=[Bd];function zd(t,r){return D(),k("svg",Ad,Id)}const Nd=ce(Fd,[["render",zd]]),Vd={},Ud={class:"tify-icon",viewBox:"0 0 24 24"},Wd=F("path",{d:"M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z"},null,-1),jd=[Wd];function Gd(t,r){return D(),k("svg",Ud,jd)}const qd=ce(Vd,[["render",Gd]]),Zd={},Kd={class:"tify-icon",viewBox:"0 0 24 24"},Xd=F("path",{d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"},null,-1),Yd=[Xd];function Jd(t,r){return D(),k("svg",Kd,Yd)}const Qd=ce(Zd,[["render",Jd]]),$d={},ef={class:"tify-icon",viewBox:"0 0 24 24"},tf=F("path",{d:"M11 15H17V17H11V15M9 7H7V9H9V7M11 13H17V11H11V13M11 9H17V7H11V9M9 11H7V13H9V11M21 5V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3H19C20.1 3 21 3.9 21 5M19 5H5V19H19V5M9 15H7V17H9V15Z"},null,-1),nf=[tf];function sf(t,r){return D(),k("svg",ef,nf)}const rf=ce($d,[["render",sf]]),of={},af={class:"tify-icon",viewBox:"0 0 24 24"},lf=F("path",{d:"M13,5V11H14.17L12,13.17L9.83,11H11V5H13M15,3H9V9H5L12,16L19,9H15V3M19,18H5V20H19V18Z"},null,-1),cf=[lf];function uf(t,r){return D(),k("svg",af,cf)}const hf=ce(of,[["render",uf]]),df={},ff={class:"tify-icon",viewBox:"0 0 24 24"},pf=F("path",{d:"M13.5,4A1.5,1.5 0 0,0 12,5.5A1.5,1.5 0 0,0 13.5,7A1.5,1.5 0 0,0 15,5.5A1.5,1.5 0 0,0 13.5,4M13.14,8.77C11.95,8.87 8.7,11.46 8.7,11.46C8.5,11.61 8.56,11.6 8.72,11.88C8.88,12.15 8.86,12.17 9.05,12.04C9.25,11.91 9.58,11.7 10.13,11.36C12.25,10 10.47,13.14 9.56,18.43C9.2,21.05 11.56,19.7 12.17,19.3C12.77,18.91 14.38,17.8 14.54,17.69C14.76,17.54 14.6,17.42 14.43,17.17C14.31,17 14.19,17.12 14.19,17.12C13.54,17.55 12.35,18.45 12.19,17.88C12,17.31 13.22,13.4 13.89,10.71C14,10.07 14.3,8.67 13.14,8.77Z"},null,-1),gf=[pf];function mf(t,r){return D(),k("svg",ff,gf)}const vf=ce(df,[["render",mf]]),yf={},wf={class:"tify-icon",viewBox:"0 0 24 24"},_f=F("path",{d:"M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z"},null,-1),xf=[_f];function Tf(t,r){return D(),k("svg",wf,xf)}const bf=ce(yf,[["render",Tf]]),Ef={},Pf={class:"tify-icon",viewBox:"0 0 24 24"},Sf=F("path",{d:"M4,5H20V7H4V5M4,9H20V11H4V9M4,13H20V15H4V13M4,17H14V19H4V17Z"},null,-1),Cf=[Sf];function Rf(t,r){return D(),k("svg",Pf,Cf)}const Hf=ce(Ef,[["render",Rf]]),Lf={},Df={class:"tify-icon",viewBox:"0 0 24 24"},Mf=F("path",{d:"M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"},null,-1),Of=[Mf];function kf(t,r){return D(),k("svg",Df,Of)}const Ff=ce(Lf,[["render",kf]]),Af={},Bf={class:"tify-icon",viewBox:"0 0 24 24"},If=F("path",{d:"M12 16C13.1 16 14 16.9 14 18S13.1 20 12 20 10 19.1 10 18 10.9 16 12 16M12 10C13.1 10 14 10.9 14 12S13.1 14 12 14 10 13.1 10 12 10.9 10 12 10M12 4C13.1 4 14 4.9 14 6S13.1 8 12 8 10 7.1 10 6 10.9 4 12 4M6 16C7.1 16 8 16.9 8 18S7.1 20 6 20 4 19.1 4 18 4.9 16 6 16M6 10C7.1 10 8 10.9 8 12S7.1 14 6 14 4 13.1 4 12 4.9 10 6 10M6 4C7.1 4 8 4.9 8 6S7.1 8 6 8 4 7.1 4 6 4.9 4 6 4M18 16C19.1 16 20 16.9 20 18S19.1 20 18 20 16 19.1 16 18 16.9 16 18 16M18 10C19.1 10 20 10.9 20 12S19.1 14 18 14 16 13.1 16 12 16.9 10 18 10M18 4C19.1 4 20 4.9 20 6S19.1 8 18 8 16 7.1 16 6 16.9 4 18 4Z"},null,-1),zf=[If];function Nf(t,r){return D(),k("svg",Bf,zf)}const Vf=ce(Af,[["render",Nf]]),Uf={},Wf={class:"tify-icon",viewBox:"0 0 24 24"},jf=F("path",{d:"M5.59,7.41L10.18,12L5.59,16.59L7,18L13,12L7,6L5.59,7.41M16,6H18V18H16V6Z"},null,-1),Gf=[jf];function qf(t,r){return D(),k("svg",Wf,Gf)}const Zf=ce(Uf,[["render",qf]]),Kf={},Xf={class:"tify-icon",viewBox:"0 0 24 24"},Yf=F("path",{d:"M16,18H18V6H16M6,18L14.5,12L6,6V18Z"},null,-1),Jf=[Yf];function Qf(t,r){return D(),k("svg",Xf,Jf)}const $f=ce(Kf,[["render",Qf]]),ep={},tp={class:"tify-icon",viewBox:"0 0 24 24"},ip=F("path",{d:"M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"},null,-1),np=[ip];function sp(t,r){return D(),k("svg",tp,np)}const rp=ce(ep,[["render",sp]]),op={},ap={class:"tify-icon",viewBox:"0 0 24 24"},lp=F("path",{d:"M18.41,16.59L13.82,12L18.41,7.41L17,6L11,12L17,18L18.41,16.59M6,6H8V18H6V6Z"},null,-1),cp=[lp];function up(t,r){return D(),k("svg",ap,cp)}const hp=ce(op,[["render",up]]),dp={},fp={class:"tify-icon",viewBox:"0 0 24 24"},pp=F("path",{d:"M21,5C19.89,4.65 18.67,4.5 17.5,4.5C15.55,4.5 13.45,4.9 12,6C10.55,4.9 8.45,4.5 6.5,4.5C4.55,4.5 2.45,4.9 1,6V20.65C1,20.9 1.25,21.15 1.5,21.15C1.6,21.15 1.65,21.1 1.75,21.1C3.1,20.45 5.05,20 6.5,20C8.45,20 10.55,20.4 12,21.5C13.35,20.65 15.8,20 17.5,20C19.15,20 20.85,20.3 22.25,21.05C22.35,21.1 22.4,21.1 22.5,21.1C22.75,21.1 23,20.85 23,20.6V6C22.4,5.55 21.75,5.25 21,5M21,18.5C19.9,18.15 18.7,18 17.5,18C15.8,18 13.35,18.65 12,19.5V8C13.35,7.15 15.8,6.5 17.5,6.5C18.7,6.5 19.9,6.65 21,7V18.5Z"},null,-1),gp=[pp];function mp(t,r){return D(),k("svg",fp,gp)}const vp=ce(dp,[["render",mp]]),yp={},wp={class:"tify-icon",viewBox:"0 0 24 24"},_p=F("path",{d:"M16,5V11H21V5M10,11H15V5H10M16,18H21V12H16M10,18H15V12H10M4,18H9V12H4M4,11H9V5H4V11Z"},null,-1),xp=[_p];function Tp(t,r){return D(),k("svg",wp,xp)}const bp=ce(yp,[["render",Tp]]),Ep={data(){return{filter:"",filteredCanvases:[],highlightIndex:0,isOpen:!1,options:U}},computed:{canvases(){return me.sequences[0].canvases||[]},currentPageLabel(){const t=U.pages[0]||1,r=U.pages[0]?U.pages[0]-1:0,e=ke(this.canvases[r].label)[0];return hi(t,e)},currentPageTitleAttr(){const{pages:t}=U,r=t[0]===0&&t.length>1?1:t[0],e=He("Physical page"),i=He("Logical page");return`${e}: ${r}
${i}: ${ke(this.canvases[r-1].label)[0]}`}},watch:{filter(){this.updateFilteredCanvases(),this.$nextTick(()=>this.updateScroll())},isOpen(){this.isOpen&&(this.filter="",this.highlightIndex=U.pages[0]-1)}},mounted(){this.updateFilteredCanvases(),U.root.$el.addEventListener("keydown",this.onKeydown)},beforeUnmount(){U.root.$el.removeEventListener("keydown",this.onKeydown)},methods:{closeDropdown(){this.isOpen=!1},convertValueToArray:ke,getId:Nt,getPageLabel:hi,onKeydown(t){if(!Wn(t)){if(t.key==="Escape"){this.closeDropdown();return}t.key==="x"&&(this.toggleDropdown(),t.preventDefault())}},onKeyDownArrow(){this.highlightIndex<this.filteredCanvases.length-1&&(this.highlightIndex+=1,this.updateScroll())},onKeyUpArrow(){this.highlightIndex>0&&(this.highlightIndex-=1,this.updateScroll())},setPage(t){this.closeDropdown(),ut(t),zt()&&Ce({view:"scan"})},toggleDropdown(){this.isOpen=!this.isOpen,this.isOpen&&this.$nextTick(()=>{this.$refs.search.focus(),this.updateScroll()})},updateFilteredCanvases(){const t=[],r=this.filter.toLowerCase();let e=-1;this.canvases.forEach((i,n)=>{const l=ke(i.label)[0].toLowerCase().indexOf(r)>-1,o=(n+1).toFixed().indexOf(r)>-1;if(l||o){const a=i;a.page=n+1,a.page===U.pages[0]&&(e=t.length),t.push(a)}}),this.highlightIndex=e<0?0:e,this.filteredCanvases=t},updateScroll(){const{list:t}=this.$refs;if(t&&t.children[this.highlightIndex]){const{offsetTop:r}=t.children[this.highlightIndex];t.scrollTop=r-(t.offsetHeight/2-t.children[0].offsetHeight)}},translate:He}},Pp={class:"tify-page-select"},Sp=["title","aria-label","aria-controls","aria-expanded"],Cp=["id"],Rp={class:"tify-page-select-filter"},Hp=["aria-label"],Lp={ref:"list",class:"tify-page-select-list"},Dp=["onClick"];function Mp(t,r,e,i,n,s){const l=Fn("click-outside");return D(),k("div",Pp,[Ne((D(),k("button",{type:"button",class:"tify-page-select-button",title:s.currentPageTitleAttr,"aria-label":s.translate("Current page"),"aria-controls":s.getId("dropdown"),"aria-expanded":n.isOpen?"true":"false",onClick:r[0]||(r[0]=(...o)=>s.toggleDropdown&&s.toggleDropdown(...o))},[Pe(X(s.currentPageLabel),1)],8,Sp)),[[l,s.closeDropdown]]),Ne(F("div",{id:s.getId("dropdown"),key:"dropdown",class:"tify-page-select-dropdown",onClick:r[6]||(r[6]=Ot(()=>{},["stop"]))},[F("div",Rp,[Ne(F("input",{ref:"search","onUpdate:modelValue":r[1]||(r[1]=o=>n.filter=o),"aria-label":s.translate("Filter pages"),type:"text",class:"tify-page-select-input",onKeyup:r[2]||(r[2]=ii(o=>n.filteredCanvases[n.highlightIndex]&&s.setPage(n.filteredCanvases[n.highlightIndex].page),["enter"])),onKeydown:[r[3]||(r[3]=ii(Ot(o=>n.filter?n.filter="":s.closeDropdown(),["prevent"]),["esc"])),r[4]||(r[4]=ii(Ot(o=>s.onKeyUpArrow(),["prevent"]),["up"])),r[5]||(r[5]=ii(Ot(o=>s.onKeyDownArrow(),["prevent"]),["down"]))]},null,40,Hp),[[Sr,n.filter]])]),F("ol",Lp,[(D(!0),k(pe,null,Le(n.filteredCanvases,(o,a)=>(D(),k("li",{key:a,class:Ee({"-current":n.options.pages.indexOf(o.page)>-1,"-highlighted":n.highlightIndex===a})},[F("a",{href:"javascript:;",onClick:c=>s.setPage(o.page)},X(s.getPageLabel(o.page,s.convertValueToArray(o.label)[0])),9,Dp)],2))),128))],512)],8,Cp),[[rt,n.isOpen]])])}const Op=ce(Ep,[["render",Mp]]),kp={props:{fulltextEnabled:Boolean,tocEnabled:Boolean},data(){return{collection:Fe,controlsVisible:!1,customPageViewActive:Dr,fullscreenActive:!1,isFirstPage:Mr,isLastPage:Or,manifest:me,options:U,screen:U.root.$el.parentNode}},computed:{fullscreenSupported(){return document.fullscreenElement===null||document.webkitFullscreenElement===null},isLastSection(){const{pages:t}=U,r=t.length-1;return(t[r]?t[r]:t[r-1])>=this.sections[this.sections.length-1].firstPage},sections(){const t=[];return this.structures&&this.structures.forEach(r=>{if(!r.canvases){t.push({firstPage:1,lastPage:ct.value});return}const e=r.canvases[0],i=Ge.value.findIndex(l=>l["@id"]===e)+1,n=r.canvases[r.canvases.length-1],s=Ge.value.findIndex(l=>l["@id"]===n)+1;t.push({firstPage:i,lastPage:s})}),t},structures(){return me?me.structures:[]},title(){return ke((me||Fe||{}).label).join(`${String.fromCharCode(160)}Â· `).trim().replace(/(\S{1,10})\s+(\S{1,10})$/,`$1${String.fromCharCode(160)}$2`)}},created(){At(this.setView),At(this.toggleDoublePage),At(this.toggleFullscreen)},mounted(){U.root.$el.addEventListener("keydown",this.onKeyDown),["","moz","webkit"].forEach(r=>{document.addEventListener(`${r}fullscreenchange`,this.toggleFullscreenActive)})},beforeUnmount(){U.root.$el.removeEventListener("keydown",this.onKeyDown)},methods:{closeControlsPopup(){this.controlsVisible=!1},detectFullscreen(){let t;switch(null){case document.fullscreenElement:t=document.fullscreenElement;break;case document.webkitFullscreenElement:t=document.webkitFullscreenElement;break;default:t=!1}return t},getId:Nt,goToFirstPage:Ss,goToLastPage:Cs,goToNextPage:vn,goToPreviousPage:yn,goToNextSection(){const{pages:t}=U,r=t.length-1,e=t[r]?t[r]:t[r-1];let i=0;for(;e>=this.sections[i].firstPage||e&&e>=this.sections[i].firstPage;)i+=1;ut(this.sections[i].firstPage)},goToPreviousSection(){const{pages:t}=U,r=t[0]?t[0]:t[1];let e=this.sections.length-1;for(;r<=this.sections[e].firstPage||r&&r<=this.sections[e].firstPage;)e-=1;ut(this.sections[e].firstPage)},onKeyDown(t){if(Wn(t))return;if(t.key==="Escape"){this.controlsVisible=!1;return}switch(t.key){case"Backspace":this.$refs.switchViewSmall.offsetParent&&this.toggleView("scan");break;case"1":me&&this.fulltextEnabled&&this.toggleView("fulltext");break;case"2":me&&this.toggleView("thumbnails");break;case"3":me&&this.tocEnabled&&this.toggleView("toc");break;case"4":this.toggleView("info");break;case"5":me&&this.toggleView("export");break;case"6":Fe&&this.toggleView("collection");break;case"7":this.toggleView("help");break;case"b":me&&this.toggleDoublePage();break;case"f":this.toggleFullscreen();break}if(!me||this.customPageViewActive)return;const{pages:r}=U;switch(t.key){case"q":case",":r[0]>1&&yn();break;case"e":case".":this.isLastPage||vn();break;case"Q":r[0]>1&&Ss();break;case"E":this.isLastPage||Cs();break}},setView(t){Ce({view:t})},toggleControlsPopup(){this.controlsVisible=!this.controlsVisible},toggleDoublePage(t){const{pages:r}=U;let e;if(r.length>1&&t!==!0||t===!1)e=[r[0]<1?1:r[0]];else if(r[0]<2)e=[0,1];else if(r[0]%2>0)e=[r[0]-1,r[0]];else{const i=r[0]<ct.value?r[0]+1:0;e=[r[0],i]}return Ce({pages:e}),e},toggleFullscreen(t){return this.fullscreenActive&&t!==!0||t===!1?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),!1):(this.screen.requestFullscreen?this.screen.requestFullscreen():this.screen.mozRequestFullScreen?this.screen.mozRequestFullScreen():this.screen.webkitRequestFullscreen&&this.screen.webkitRequestFullscreen(),!0)},toggleFullscreenActive(){this.fullscreenActive=!this.fullscreenActive},toggleView(t){const r=t===U.view&&me&&!zt()?"":t;return Ce({view:r}),r},translate:He}},Fp={class:"tify-header"},Ap={class:"tify-header-column -title"},Bp=["title"],Ip={key:0,class:"tify-header-column -pagination"},zp={class:"tify-header-button-group -page-select"},Np=["title"],Vp={class:"tify-header-button-group -pagination"},Up=["disabled","title"],Wp=["disabled","title"],jp=["disabled","title"],Gp=["disabled","title"],qp=["disabled","title"],Zp=["disabled","title"],Kp={class:"tify-header-column -toggle"},Xp={ref:"switchViewSmall",class:"tify-header-button-group -toggle"},Yp=["aria-controls","aria-expanded","aria-label","title"],Jp=["id"],Qp={class:"tify-header-button-group -view"},$p=["aria-controls","aria-expanded"],eg=["aria-controls","aria-expanded"],tg=["aria-controls","aria-expanded"],ig=["aria-controls","aria-expanded"],ng=["aria-controls","aria-expanded"],sg=["aria-controls","aria-expanded"],rg=["aria-controls","aria-expanded"],og={key:0,class:"tify-header-button-group -view"},ag=["aria-controls","aria-expanded","title"],lg=["title"],cg=["title"],ug={key:1,class:"tify-header-button-group -popup"},hg=["disabled","title"],dg=["disabled","title"],fg=["disabled","title"],pg=["disabled","title"],gg=["disabled","title"],mg=["disabled","title"];function vg(t,r,e,i,n,s){const l=Op,o=bp,a=vp,c=hp,h=rp,g=Ar,m=Fr,b=$f,x=Zf,P=Vf,S=Ff,O=Hf,d=bf,w=vf,H=hf,M=rf,I=Qd,V=qd,q=Nd,K=Fn("click-outside");return D(),k("header",Fp,[F("div",Ap,[F("h1",{class:"tify-header-title",title:s.title},X(s.title),9,Bp)]),n.manifest["@id"]?(D(),k("div",Ip,[F("div",zp,[ie(l),F("button",{type:"button",class:Ee(["tify-header-button",{"-active":n.options.pages.length>1}]),title:s.translate("Toggle double-page"),onClick:r[0]||(r[0]=(...j)=>s.toggleDoublePage&&s.toggleDoublePage(...j))},[n.customPageViewActive?(D(),Be(o,{key:0})):(D(),Be(a,{key:1}))],10,Np)]),F("div",Vp,[F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("First page"),onClick:r[1]||(r[1]=(...j)=>s.goToFirstPage&&s.goToFirstPage(...j))},[ie(c)],8,Up),s.structures&&s.structures.length?(D(),k("button",{key:0,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous section"),onClick:r[2]||(r[2]=(...j)=>s.goToPreviousSection&&s.goToPreviousSection(...j))},[ie(h)],8,Wp)):re("",!0),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous page"),onClick:r[3]||(r[3]=(...j)=>s.goToPreviousPage&&s.goToPreviousPage(...j))},[ie(g)],8,jp),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Next page"),onClick:r[4]||(r[4]=(...j)=>s.goToNextPage&&s.goToNextPage(...j))},[ie(m)],8,Gp),s.structures&&s.structures.length?(D(),k("button",{key:1,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||s.isLastSection,title:s.translate("Next section"),onClick:r[5]||(r[5]=(...j)=>s.goToNextSection&&s.goToNextSection(...j))},[ie(b)],8,qp)):re("",!0),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Last page"),onClick:r[6]||(r[6]=(...j)=>s.goToLastPage&&s.goToLastPage(...j))},[ie(x)],8,Zp)])])):re("",!0),F("div",Kp,[F("div",Xp,[Ne((D(),k("button",{type:"button","aria-controls":s.getId("controls"),"aria-expanded":n.controlsVisible?"true":"false","aria-label":s.translate("View"),class:"tify-header-button",title:s.translate("View"),onClick:r[7]||(r[7]=(...j)=>s.toggleControlsPopup&&s.toggleControlsPopup(...j))},[ie(P)],8,Yp)),[[K,s.closeControlsPopup]])],512)]),F("div",{id:s.getId("controls"),class:Ee(["tify-header-column -controls",{"-visible":n.controlsVisible}])},[F("div",Qp,[n.manifest["@id"]?(D(),k("button",{key:0,type:"button",class:Ee(["tify-header-button -scan",{"-active":n.options.view==="scan"}]),"aria-controls":s.getId("scan"),"aria-expanded":n.options.view==="scan"?"true":"false",onClick:r[8]||(r[8]=j=>s.toggleView("scan"))},[ie(S),Pe(" "+X(s.translate("Scan")),1)],10,$p)):re("",!0),e.fulltextEnabled?(D(),k("button",{key:1,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="fulltext"}]),"aria-controls":s.getId("fulltext"),"aria-expanded":n.options.view==="fulltext"?"true":"false",onClick:r[9]||(r[9]=j=>s.toggleView("fulltext"))},[ie(O),Pe(" "+X(s.translate("Fulltext")),1)],10,eg)):re("",!0),n.manifest["@id"]?(D(),k("button",{key:2,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="thumbnails"}]),"aria-controls":s.getId("thumbnails"),"aria-expanded":n.options.view==="thumbnails"?"true":"false",onClick:r[10]||(r[10]=j=>s.toggleView("thumbnails"))},[ie(o),Pe(" "+X(s.translate("Pages")),1)],10,tg)):re("",!0),e.tocEnabled?(D(),k("button",{key:3,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="toc"}]),"aria-controls":s.getId("toc"),"aria-expanded":n.options.view==="toc"?"true":"false",onClick:r[11]||(r[11]=j=>s.toggleView("toc"))},[ie(d),Pe(" "+X(s.translate("Contents")),1)],10,ig)):re("",!0),F("button",{type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="info"}]),"aria-controls":s.getId("info"),"aria-expanded":n.options.view==="info"?"true":"false",onClick:r[12]||(r[12]=j=>s.toggleView("info"))},[ie(w),Pe(" "+X(s.translate("Info")),1)],10,ng),n.manifest["@id"]?(D(),k("button",{key:4,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="export"}]),"aria-controls":s.getId("export"),"aria-expanded":n.options.view==="export"?"true":"false",onClick:r[13]||(r[13]=j=>s.toggleView("export"))},[ie(H),Pe(" "+X(s.translate("Export")),1)],10,sg)):re("",!0),n.collection["@id"]?(D(),k("button",{key:5,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="collection"}]),"aria-controls":s.getId("collection"),"aria-expanded":n.options==="collection"?"true":"false",onClick:r[14]||(r[14]=j=>s.toggleView("collection"))},[ie(M),Pe(" "+X(s.translate("Collection")),1)],10,rg)):re("",!0)]),s.fullscreenSupported?(D(),k("div",og,[F("button",{type:"button",class:Ee(["tify-header-button -icon-only",{"-active":n.options.view==="help"}]),"aria-controls":s.getId("help"),"aria-expanded":n.options.view==="help"?"true":"false",title:s.translate("Help"),onClick:r[15]||(r[15]=j=>s.toggleView("help"))},[ie(I),Pe(" "+X(s.translate("Help")),1)],10,ag),n.fullscreenActive?(D(),k("button",{key:1,type:"button",class:"tify-header-button -icon-only",title:s.translate("Exit fullscreen"),onClick:r[17]||(r[17]=(...j)=>s.toggleFullscreen&&s.toggleFullscreen(...j))},[ie(q),Pe(" "+X(s.translate("Exit fullscreen")),1)],8,cg)):(D(),k("button",{key:0,type:"button",class:"tify-header-button -icon-only",title:s.translate("Fullscreen"),onClick:r[16]||(r[16]=(...j)=>s.toggleFullscreen&&s.toggleFullscreen(...j))},[ie(V),Pe(" "+X(s.translate("Fullscreen")),1)],8,lg))])):re("",!0),n.manifest["@id"]?(D(),k("div",ug,[F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("First page"),onClick:r[18]||(r[18]=(...j)=>s.goToFirstPage&&s.goToFirstPage(...j))},[ie(c)],8,hg),s.structures&&s.structures.length?(D(),k("button",{key:0,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous section"),onClick:r[19]||(r[19]=(...j)=>s.goToPreviousSection&&s.goToPreviousSection(...j))},[ie(h)],8,dg)):re("",!0),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous page"),onClick:r[20]||(r[20]=(...j)=>s.goToPreviousPage&&s.goToPreviousPage(...j))},[ie(g)],8,fg),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Next page"),onClick:r[21]||(r[21]=(...j)=>s.goToNextPage&&s.goToNextPage(...j))},[ie(m)],8,pg),s.structures&&s.structures.length?(D(),k("button",{key:1,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||s.isLastSection,title:s.translate("Next section"),onClick:r[22]||(r[22]=(...j)=>s.goToNextSection&&s.goToNextSection(...j))},[ie(b)],8,gg)):re("",!0),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Last page"),onClick:r[23]||(r[23]=(...j)=>s.goToLastPage&&s.goToLastPage(...j))},[ie(x)],8,mg)])):re("",!0)],10,Jp)])}const yg=ce(kp,[["render",vg]]);const wg={props:{ready:Boolean},data(){return{canvases:Ge,collection:Fe,manifest:me,error:Hi,loading:Xe,options:U,translationLoaded:!!dn}},computed:{hasOtherContent(){return Ge.value.some(t=>"otherContent"in t)},hasToc(){return me.structures&&me.structures.length>0}},methods:{getId:Nt,setError:it,translate:He}},_g={class:"tify",tabindex:"-1"},xg={key:1,class:"tify-main"},Tg=["aria-label"],bg={key:3,class:"tify-error"};function Eg(t,r,e,i,n,s){const l=yg,o=kd,a=th,c=Zu,h=Iu,g=Mu,m=iu,b=cc,x=Ml,P=Cr;return D(),k("article",_g,[e.ready&&(n.collection["@id"]||n.manifest["@id"])?(D(),Be(l,{key:0,"fulltext-enabled":s.hasOtherContent,"toc-enabled":s.hasToc},null,8,["fulltext-enabled","toc-enabled"])):re("",!0),e.ready?(D(),k("div",xg,[n.manifest["@id"]?(D(),k(pe,{key:0},[ie(o,{id:s.getId("scan")},null,8,["id"]),s.hasOtherContent?Ne((D(),Be(a,{key:0,id:s.getId("fulltext")},null,8,["id"])),[[rt,n.options.view==="fulltext"]]):re("",!0),Ne(ie(c,{id:s.getId("thumbnails")},null,8,["id"]),[[rt,n.options.view==="thumbnails"]]),s.hasToc?Ne((D(),Be(h,{key:1,id:s.getId("toc")},null,8,["id"])),[[rt,n.options.view==="toc"]]):re("",!0),Ne(ie(g,{id:s.getId("export")},null,8,["id"]),[[rt,n.options.view==="export"]])],64)):re("",!0),n.collection["@id"]||n.manifest["@id"]?Ne((D(),Be(m,{key:1,id:s.getId("info")},null,8,["id"])),[[rt,n.options.view==="info"]]):re("",!0),n.collection["@id"]?Ne((D(),Be(b,{key:2,id:s.getId("collection")},null,8,["id"])),[[rt,n.options.view==="collection"]]):re("",!0),Ne(ie(x,{id:s.getId("help")},null,8,["id"]),[[rt,n.options.view==="help"]])])):re("",!0),n.loading?(D(),k("div",{key:2,class:"tify-loading","aria-label":n.translationLoaded?s.translate("Loading"):"Loading"},null,8,Tg)):re("",!0),n.error?(D(),k("div",bg,[F("button",{type:"button",class:"tify-error-close",onClick:r[0]||(r[0]=S=>s.setError(""))},[ie(P)]),F("span",null,X(n.error),1)])):re("",!0)])}const Pg=ce(wg,[["render",Eg]]);window.Tify=function(r={}){const e={breakpoints:{tiny:359,small:719,medium:959,large:1199},childManifestAutoloaded:!0,childManifestUrl:null,container:null,filters:{},language:"en",manifestUrl:null,optionsResetOnPageChange:["pan"],pageLabelFormat:"P : L",pages:null,pan:{},rotation:null,translationsDirUrl:null,urlQueryKey:null,urlQueryParams:["childManifestUrl","filters","pages","pan","rotation","view","zoom"],view:"",viewer:{},zoom:null};if(this.options={...e,...r},!this.options.translationsDirUrl){const o=[...document.getElementsByTagName("script")].find(a=>a.src.includes("/tify"));if(o){const{src:a}=o;this.options.translationsDirUrl=`${a.substring(0,a.lastIndexOf("/"))}/translations`}}let i=null;this.ready=new Promise((l,o)=>{i={resolve:l,reject:o}});const n=this;this.app=ul({data(){return{collection:null,error:"",manifest:null,options:n.options,ready:!1,readyPromise:i,translation:null}},created(){this.options.root=this,Ce(n.options),At(Ps),At(ut)},mounted(){if(this.updateBreakpoint(),window.addEventListener("resize",this.updateBreakpoint),!this.options.manifestUrl){it('Missing option "manifestUrl"');return}Promise.all([Nn(this.options.manifestUrl,{}),Ps(this.options.language)]).then(()=>{this.$nextTick(()=>{this.ready=!0,this.readyPromise.resolve()})},l=>{this.readyPromise.reject(l)})},beforeUnmount(){clearTimeout(hn),window.removeEventListener("resize",this.updateBreakpoint),window.removeEventListener("popstate",gn)},methods:{updateBreakpoint(){Object.keys(this.options.breakpoints).forEach(l=>{this.$el.clientWidth<=this.options.breakpoints[l]?this.$el.classList.add(`-${l}`):this.$el.classList.remove(`-${l}`)}),this.$el.clientHeight<520?this.$el.classList.add("-short"):this.$el.classList.remove("-short")}},render(){return Ia(Pg,{ready:this.ready})}}),this.app.use(fl);let s=!1;this.mount=l=>{if(s)throw new Error("TIFY is already mounted");const o=typeof l=="string"?document.querySelector(l):l;if(!o)throw new Error("Container element not found");window.getComputedStyle(o).position==="static"&&(o.style.position="relative"),this.app.mount(o),s=!0},this.destroy=()=>{this.app.unmount()},this.options.container&&this.mount(this.options.container)};
